<!DOCTYPE html><html class="scroll-smooth" lang="zh-CN"> <head><meta charset="utf-8"><meta content="width=device-width, initial-scale=1.0" name="viewport"><title>用python+sklearn(机器学习)实现天气预测 • Eritque Arcus</title><link rel="icon" href="/favicon.png" type="image/png"><link href="/manifest.webmanifest" rel="manifest"><link href="https://ikuyo.dev/2020/12/13/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5/" rel="canonical"><meta content="用python+sklearn(机器学习)实现天气预测 • Eritque Arcus" name="title"><meta content="Eritque Arcus's blog" name="description"><meta content="Eritque Arcus" name="author"><meta content="article" property="og:type"><meta content="用python+sklearn(机器学习)实现天气预测" property="og:title"><meta content="Eritque Arcus's blog" property="og:description"><meta content="https://ikuyo.dev/2020/12/13/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5/" property="og:url"><meta content="Eritque Arcus" property="og:site_name"><meta content="zh_CN" property="og:locale"><meta content="1200" property="og:image:width"><meta content="630" property="og:image:height"><meta content="Eritque Arcus" property="article:author"><meta content="2020-12-14T04:30:02.000Z" property="article:published_time"><meta content="summary_large_image" property="twitter:card"><meta content="https://ikuyo.dev/2020/12/13/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5/" property="twitter:url"><meta content="用python+sklearn(机器学习)实现天气预测" property="twitter:title"><meta content="Eritque Arcus's blog" property="twitter:description"><link href="/sitemap-index.xml" rel="sitemap"><link href="/rss.xml" title="Blog" rel="alternate" type="application/rss+xml"><link href="/notes/rss.xml" title="Notes" rel="alternate" type="application/rss+xml"><link href="https://webmention.io/ikuyo.dev/webmention" rel="webmention"><meta content="Astro v5.14.4" name="generator"><link href="https://github.com/Nambers" rel="me"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="anonymous" data-unfont><link rel="preload" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?family=Major Mono Display&family=Space Grotesk&family=Noto Sans SC&family=LXGW WenKai Mono TC&display=swap" data-unfont><style>@font-face{font-family:Maple Mono;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/maple-mono-latin-400-normal.C5QbKxa2.woff2) format("woff2"),url(/_astro/maple-mono-latin-400-normal.BgUYpi45.woff) format("woff")}
</style>
<link rel="stylesheet" href="/_astro/_page_.Qxx8qG3y.css"><script type="module" src="/_astro/page.CwTOY3h6.js"></script></head> <body class="bg-global-bg text-global-text mx-auto flex min-h-screen max-w-7xl flex-col px-4 pt-16 text-sm font-normal antialiased sm:px-8"> <script>
	const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

	function getUserPref() {
		const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		return storedTheme || (lightModePref.matches ? "light" : "dark");
	}

	function setTheme(newTheme) {
		if (newTheme !== "light" && newTheme !== "dark") {
			return console.warn(
				`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
			);
		}

		const root = document.documentElement;

		// root already set to newTheme, exit early
		if (newTheme === root.getAttribute("data-theme")) {
			return;
		}

		root.setAttribute("data-theme", newTheme);

		if (typeof localStorage !== "undefined") {
			localStorage.setItem("theme", newTheme);
		}
	}

	// initial setup
	setTheme(getUserPref());

	// View Transitions hook to restore theme
	document.addEventListener("astro:after-swap", () => setTheme(getUserPref()));

	// listen for theme-change custom event, fired in src/components/ThemeToggle.astro
	document.addEventListener("theme-change", (e) => {
		setTheme(e.detail.theme);
	});

	// listen for prefers-color-scheme change.
	lightModePref.addEventListener("change", (e) => setTheme(e.matches ? "light" : "dark"));
</script> <a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">skip to content
</a> <header class="group relative mb-28 flex w-full items-center sm:ps-20" id="main-header"> <div class="flex w-full sm:flex-col"> <div class="flex w-full items-center sm:relative sm:inline-block"> <a aria-current="false" class="inline-flex items-center sm:relative sm:inline-block" href="/"> <img src="/avatar.png" alt="Avatar" class="me-3 h-16 w-16 rounded-full sm:absolute sm:-start-18 sm:me-0 sm:h-16 sm:w-16"> <span class="font-display text-accent ps-3 text-4xl font-bold tracking-wide whitespace-nowrap dark:drop-shadow-[0_0_2px_white] dark:drop-shadow-[0_0_4px_cyan] dark:drop-shadow-[0_0_8px_cyan] dark:drop-shadow-[0_0_16px_rgba(0,255,255,0.5)]"> Eritque Arcus </span> </a> </div> <nav aria-label="Main menu" class="bg-global-bg/85 absolute -inset-x-4 top-14 hidden w-full flex-col items-end gap-y-4 rounded-md py-4 shadow backdrop-blur-sm group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:rounded-none sm:bg-transparent sm:py-0 sm:ps-4 sm:shadow-none sm:backdrop-blur-none" id="navigation-menu"> <div class="text-accent sm:divide-accent sm:divide-x"> <a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/archive/"> Archive </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/about/"> About </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/math-notes/"> Notes </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/ctf-cheatsheet/"> CTF-QuickRef </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/music/"> Music </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="https://photos.ikuyo.dev"> Photos </a> </div> <div class="flex sm:ps-28"> <site-search class="ms-auto" id="search"> <button class="hover:text-accent flex h-9 w-9 cursor-pointer items-center justify-center rounded-md" aria-keyshortcuts="Control+K Meta+K" data-open-modal disabled> <svg aria-hidden="true" class="h-7 w-7" fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" stroke="none"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <span class="sr-only">Open Search</span> </button> <dialog aria-label="search" class="bg-global-bg h-full max-h-full w-full max-w-full border border-zinc-400 shadow-sm backdrop:backdrop-blur-sm open:flex sm:mx-auto sm:mt-16 sm:mb-auto sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md"> <div class="dialog-frame flex grow flex-col gap-4 p-6 pt-12 sm:pt-6"> <button class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700" data-close-modal>Close</button> <div class="search-container"> <div id="cactus__search"></div> </div> </div> </dialog> </site-search> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.rgeqRwRC.js"></script> <theme-toggle class="ms-2 sm:ms-4"> <button class="hover:text-accent relative h-9 w-9 cursor-pointer rounded-md p-2" type="button"> <span class="sr-only">Dark Theme</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0" fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100" fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path> <path d="M19 11h2m-1 -1v2"></path> </svg> </button> </theme-toggle> <script type="module" src="/_astro/ThemeToggle.astro_astro_type_script_index_0_lang.C1tldoqx.js"></script> </div> </nav> </div> <mobile-button class="mb-15"> <button aria-expanded="false" aria-haspopup="menu" class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button"> <span class="sr-only">Open main menu</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0" fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="text-accent absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100" class="text-accent" fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button> </mobile-button> </header> <script type="module" src="/_astro/Header.astro_astro_type_script_index_0_lang.DuSsDY4R.js"></script> <main id="main">  <article class="grow break-words" data-pagefind-body> <div id="blog-hero" class="mb-12"><h1 class="title"> 用python+sklearn(机器学习)实现天气预测 </h1> <div class="flex flex-wrap items-center gap-x-3 gap-y-2"> <p class="font-semibold"> <time datetime="2020-12-14T04:30:02.000Z" title="2020-12-14T04:30:02.000Z">13 December 2020</time> /  21 min read </p>  </div> <div class="mt-2"> <svg aria-hidden="true" class="inline-block h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:python" href="/tags/python/"><span class="sr-only">View more blogs with the tag&nbsp;</span>python </a>,  </span> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:sklearn" href="/tags/sklearn/"><span class="sr-only">View more blogs with the tag&nbsp;</span>sklearn </a> </span>  </div></div> <div class="grid grid-cols-[1fr_auto] gap-10 lg:flex-row lg:items-start"> <details open class="lg:sticky lg:top-12 lg:order-2 lg:-me-32 lg:basis-64"> <summary class="title hover:marker:text-accent cursor-pointer text-lg">Table of Contents</summary> <nav class="ms-4 lg:w-full"> <ol class="mt-4"> <li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#项目地址"><span aria-hidden="true" class="me-0.5">#</span>项目地址</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#系列教程"><span aria-hidden="true" class="me-0.5">#</span>系列教程</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#0流程介绍"><span aria-hidden="true" class="me-0.5">#</span>0.流程介绍</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#1-环境搭建"><span aria-hidden="true" class="me-0.5">#</span>1. 环境搭建</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#apython"><span aria-hidden="true" class="me-0.5">#</span>a.python</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#11-涉及到的机器学习相关库"><span aria-hidden="true" class="me-0.5">#</span>1.1 涉及到的机器学习相关库</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#111-sklearn"><span aria-hidden="true" class="me-0.5">#</span>1.1.1 sklearn</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#112-panda"><span aria-hidden="true" class="me-0.5">#</span>1.1.2 panda</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#113-seaborn"><span aria-hidden="true" class="me-0.5">#</span>1.1.3 seaborn</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#114-joblib"><span aria-hidden="true" class="me-0.5">#</span>1.1.4 joblib</a>  </li> </ol> </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#2寻找数据来源"><span aria-hidden="true" class="me-0.5">#</span>2.寻找数据来源</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#3分析数据源网址规则"><span aria-hidden="true" class="me-0.5">#</span>3.分析数据源网址规则</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#4分析页面规则"><span aria-hidden="true" class="me-0.5">#</span>4.分析页面规则</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#勘误表"><span aria-hidden="true" class="me-0.5">#</span>勘误表</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#5爬虫"><span aria-hidden="true" class="me-0.5">#</span>5.爬虫</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#51确认要被爬取的网页网址"><span aria-hidden="true" class="me-0.5">#</span>5.1确认要被爬取的网页网址</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#52-爬虫部分"><span aria-hidden="true" class="me-0.5">#</span>5.2 爬虫部分</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#53-网页内容匹配取出部分"><span aria-hidden="true" class="me-0.5">#</span>5.3 网页内容匹配取出部分</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#54写入csv文件格式化"><span aria-hidden="true" class="me-0.5">#</span>5.4写入csv文件格式化</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#56封装成类"><span aria-hidden="true" class="me-0.5">#</span>5.6封装成类</a>  </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#6数据预处理"><span aria-hidden="true" class="me-0.5">#</span>6.数据预处理</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#7建立模型"><span aria-hidden="true" class="me-0.5">#</span>7.建立模型</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#71准备"><span aria-hidden="true" class="me-0.5">#</span>7.1准备</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#711-引入所需要的头文件"><span aria-hidden="true" class="me-0.5">#</span>7.1.1 引入所需要的头文件</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#712-选择模型"><span aria-hidden="true" class="me-0.5">#</span>7.1.2 选择模型</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#713-选择评估方法"><span aria-hidden="true" class="me-0.5">#</span>7.1.3 选择评估方法</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#714-获取数据集"><span aria-hidden="true" class="me-0.5">#</span>7.1.4 获取数据集</a>  </li> </ol> </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#72建立模型"><span aria-hidden="true" class="me-0.5">#</span>7.2建立模型</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#73-获取模型评估结果"><span aria-hidden="true" class="me-0.5">#</span>7.3 获取模型评估结果</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#74-用joblib模块保存模型"><span aria-hidden="true" class="me-0.5">#</span>7.4 用joblib模块保存模型</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#75-封装"><span aria-hidden="true" class="me-0.5">#</span>7.5 封装</a>  </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#8-总控"><span aria-hidden="true" class="me-0.5">#</span>8 总控</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#81-代码"><span aria-hidden="true" class="me-0.5">#</span>8.1 代码</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#82-使用方法"><span aria-hidden="true" class="me-0.5">#</span>8.2 使用方法</a>  </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#9-最后效果"><span aria-hidden="true" class="me-0.5">#</span>9 最后效果</a>  </li> </ol> </nav> </details> <div class="prose max-w-none prose-base prose-code:font-normal prose-headings:font-semibold prose-headings:text-accent-2 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-gray-600 prose-headings:hover:before:text-accent sm:prose-headings:before:content-['#'] sm:prose-th:before:content-none">  <h2 id="项目地址"><a class="not-prose" href="#项目地址">项目地址</a></h2>
<p><a href="https://github.com/Nambers/PYWeatherReport" rel="noreferrer noopener" target="_blank">github项目:PYWeatherReport
</a></p>
<h2 id="系列教程"><a class="not-prose" href="#系列教程">系列教程</a></h2>
<blockquote>
<p>本文章为以下几篇的合集
<a href="https://blog.csdn.net/qq_40832960/article/details/109260388" rel="noreferrer noopener" target="_blank">机器学习参考篇: python+sklearn+kaggle机器学习</a>
<a href="https://blog.csdn.net/qq_40832960/article/details/111146467" rel="noreferrer noopener" target="_blank">用python+sklearn(机器学习)实现天气预报 准备</a>
<a href="https://blog.csdn.net/qq_40832960/article/details/111182425" rel="noreferrer noopener" target="_blank">用python+sklearn(机器学习)实现天气预报数据 数据</a>
<a href="https://blog.csdn.net/qq_40832960/article/details/111238926" rel="noreferrer noopener" target="_blank">用python+sklearn(机器学习)实现天气预报 模型和使用</a></p>
</blockquote>
<h2 id="0流程介绍"><a class="not-prose" href="#0流程介绍">0.流程介绍</a></h2>
<p>爬虫爬取<code>去年今日的半个月前到去年今日的下个半个月的每日天气数据</code>做训练集和训练验证集，爬取<code>现在半个月前到现在的每日天气数据</code>做预测数据集 -> 数据预处理 -> 训练模型和预测
机器学习过程可参考<a href="https://blog.csdn.net/qq_40832960/article/details/109260388" rel="noreferrer noopener" target="_blank">上面那篇</a></p>
<h2 id="1-环境搭建"><a class="not-prose" href="#1-环境搭建">1. 环境搭建</a></h2>
<h2 id="apython"><a class="not-prose" href="#apython">a.python</a></h2>
<p>如题，要使用python+sklearn做，所以肯定要搭建好python的环境，教程百度有很多，建议用python3.*</p>
<h3 id="11-涉及到的机器学习相关库"><a class="not-prose" href="#11-涉及到的机器学习相关库">1.1 涉及到的机器学习相关库</a></h3>
<p>安装命令:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.oaceo.css"><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:14ch"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">pip</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">install</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">库名</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="pip install 库名"><div></div></button></div></figure></div>
<h4 id="111-sklearn"><a class="not-prose" href="#111-sklearn">1.1.1 sklearn</a></h4>
<p>本教程运用的机器学习核心库</p>
<h4 id="112-panda"><a class="not-prose" href="#112-panda">1.1.2 panda</a></h4>
<p>读取csv相关</p>
<h4 id="113-seaborn"><a class="not-prose" href="#113-seaborn">1.1.3 seaborn</a></h4>
<p>数据可视化，生成图表如折线图等</p>
<h4 id="114-joblib"><a class="not-prose" href="#114-joblib">1.1.4 joblib</a></h4>
<p>保存和读取训练好的模型，<code>*.pkl</code>文件</p>
<h2 id="2寻找数据来源"><a class="not-prose" href="#2寻找数据来源">2.寻找数据来源</a></h2>
<p>做机器学习我们需要尽量多和准确的数据，本次实例从<a href="http://www.meteomanz.com" rel="noreferrer noopener" target="_blank">www.meteomanz.com</a>获取免费的天气数据</p>
<h2 id="3分析数据源网址规则"><a class="not-prose" href="#3分析数据源网址规则">3.分析数据源网址规则</a></h2>
<p>我们访问上一步的网站，可以发现有选择城市和时间的接口(PS:右上角的链接可以切换成英文
)
<img src="/images/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5.md-0.png" alt="网站">
接下来我们选择我们要做天气预报的城市和顺便一个时间点，如广州(PS:在选择框直接输入城市的前几个字符可以快速索引
)
<img src="/images/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5.md-1.png" alt="网站">
然后点按钮，我们会跳转到一个网页
<img src="/images/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5.md-2.png" alt="网页">
这个就是我们要取到的数据了的地址，不过时间不对，接下来解析这个网址的规则，如</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:91ch"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">http://www.meteomanz.com/sy2?l</span><span style="--0:#9ECBFF;--1:#032F62">=1</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;cou</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">2250</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;ind</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">59287</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;d1</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">13</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;m1</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">12</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;y1</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">2020</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;d2</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">13</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;m2</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">12</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;y2</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">2020</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=59287&#x26;d1=13&#x26;m1=12&#x26;y1=2020&#x26;d2=13&#x26;m2=12&#x26;y2=2020"><div></div></button></div></figure></div>
<p>这里面</p>
<ul>
<li><code>?</code>前的分别是<code>http://</code>网络协议,<code>www.meteomanz.com</code>域名，<code>/sy2</code>地址，我们主要关注<code>?</code>后的参数</li>
<li><code>l</code>是语言参数，l=1指英语</li>
<li><code>cou</code>和<code>ind</code>是地区和城市代码</li>
<li><code>d1</code>，<code>m1</code>，<code>y1</code>是时间段的开始年月日</li>
<li><code>d2</code>，<code>m2</code>，<code>y2</code>是时间段的结束年月日</li>
</ul>
<p>所以</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:91ch"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">http://www.meteomanz.com/sy2?l</span><span style="--0:#9ECBFF;--1:#032F62">=1</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;cou</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">2250</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;ind</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">59287</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;d1</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">02</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;m1</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">02</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;y1</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">2019</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;d2</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">13</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;m2</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">12</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;y2</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">2020</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=59287&#x26;d1=02&#x26;m1=02&#x26;y1=2019&#x26;d2=13&#x26;m2=12&#x26;y2=2020"><div></div></button></div></figure></div>
<p>指从2019/2/2到2020/12/13的广州的每日天气数据，不要忘记里面月和日是要补0的，但是进去就发现最多给30天的数据，所以我们以后并不会用到怎么多天的数据</p>
<h2 id="4分析页面规则"><a class="not-prose" href="#4分析页面规则">4.分析页面规则</a></h2>
<p>获取到网址规则后，分析页面规则用于爬虫匹配数据，按F12打开开发者工具
<img src="/images/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5.md-3.png" alt="DEV">
如图，我们可以发现rbody里面的第二个tr标签里面的每个td里是数据(PS:用右上角的左边第一个小按钮然后点击那些数据
)。
<img src="/images/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5.md-4.png" alt="在这里插入图片描述">
<img src="/images/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5.md-5.png" alt="在这里插入图片描述"></p>
<p>当我们知道了这些规则，接下来就可以写爬虫爬取符合条件的数据集了。</p>
<h2 id="勘误表"><a class="not-prose" href="#勘误表">勘误表</a></h2>
<ol>
<li>
<p>感谢”Gbilibili”的提醒，下面url代码生成片段应从</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:68ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 爬取数据链接</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">   </span></span><span style="--0:#E1E4E8;--1:#24292E">url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=59287&#x26;d1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">   </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_ago.day).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">   </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;m1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_ago.month).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">   </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;y1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_ago.month) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">   </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;d2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.day </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> years[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">]).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">   </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;m2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.month).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">   </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;y2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.year </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> years[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# 爬取数据链接   url = &#x22;http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=59287&#x26;d1=&#x22; +   str(week_ago.day).zfill(2) +   &#x22;&#x26;m1=&#x22; + str(week_ago.month).zfill(2) +   &#x22;&#x26;y1=&#x22; + str(week_ago.month) +   &#x22;&#x26;d2=&#x22; + str(week_pre.day - years[0]).zfill(2) +   &#x22;&#x26;m2=&#x22; + str(week_pre.month).zfill(2) +   &#x22;&#x26;y2=&#x22; + str(week_pre.year - years[1])"><div></div></button></div></figure></div>
<p>改成</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:65ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 爬取数据链接</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=59287&#x26;d1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_ago.day).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;m1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">( week_ago.month).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;y1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_ago.year </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> years[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">]) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;d2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.day).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;m2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.month).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;y2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.year </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> years[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# 爬取数据链接url = &#x22;http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=59287&#x26;d1=&#x22; +    str(week_ago.day).zfill(2) +    &#x22;&#x26;m1=&#x22; + str( week_ago.month).zfill(2) +    &#x22;&#x26;y1=&#x22; + str(week_ago.year - years[0]) +    &#x22;&#x26;d2=&#x22; + str(week_pre.day).zfill(2) +    &#x22;&#x26;m2=&#x22; + str(week_pre.month).zfill(2) +    &#x22;&#x26;y2=&#x22; + str(week_pre.year - years[1])"><div></div></button></div></figure></div>
</li>
<li>
<p>感谢@L-Zzxnn的提醒，代码已添加负温度支持，最新代码请以github上为准</p>
</li>
</ol>
<h2 id="5爬虫"><a class="not-prose" href="#5爬虫">5.爬虫</a></h2>
<p>爬虫这方面可以参考我之前的<a href="https://blog.csdn.net/qq_40832960/article/details/103854145" rel="noreferrer noopener" target="_blank">一篇文章</a></p>
<h3 id="51确认要被爬取的网页网址"><a class="not-prose" href="#51确认要被爬取的网页网址">5.1确认要被爬取的网页网址</a></h3>
<p>首先我们主要要爬取去年今日的半个月前到去年今日，而根据上一篇我们得出的网址规则，我们可以得到(PS:真正的链接里是没有换行的
)</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:51ch"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">http://www.meteomanz.com/sy2?l</span><span style="--0:#9ECBFF;--1:#032F62">=1</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;cou</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">2250</span><span style="--0:#E1E4E8;--1:#24292E">&#x26;ind</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">59287</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">&#x26;d1</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">去年今日的半个月前的日</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">&#x26;m1</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">去年今日的半个月前的月份</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">&#x26;y1</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">去年年份</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">&#x26;d2</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">今天的日期的日</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">&#x26;m2</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">今天的日期的月份</span></div></div><div class="ec-line"><div class="code"><span style="--0:#E1E4E8;--1:#24292E">&#x26;y2</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">今年年份</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=59287&#x26;d1=去年今日的半个月前的日&#x26;m1=去年今日的半个月前的月份&#x26;y1=去年年份&#x26;d2=今天的日期的日&#x26;m2=今天的日期的月份&#x26;y2=今年年份"><div></div></button></div></figure></div>
<p>而为什么是取去年和时间要半个月呢？因为去年的天气环境相比于前年或者更久之前是和我们现在的天气条件更相似的，可以减少误差，半个月而不是一个星期是因为使用多的数据量可以减少误差，不是一个月而是因为网站的限制，而且在实验中也会增加少量的误差。所以最终取用了去年和半个月的时间。<br>
如果我们是只测今天这一次上面的网址就可以人工填写，但是如果我们要做不用人工填就要用<code>datetime</code>这个python库<br>
如下:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:52ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> datetime </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 取现在日期</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">today </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span><span style="--0:#E1E4E8;--1:#24292E">.datetime.now()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 取b[0]天前日期</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">week_ago </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> (today </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span><span style="--0:#E1E4E8;--1:#24292E">.timedelta(</span><span style="--0:#FFAB70;--1:#AE4B07">days</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">b[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">])).date()</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"> </span><span style="--0:#99A0A6;--1:#616972"># b[1]天后</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E"> </span></span><span style="--0:#E1E4E8;--1:#24292E">week_pre </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> (today </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span><span style="--0:#E1E4E8;--1:#24292E">.timedelta(</span><span style="--0:#FFAB70;--1:#AE4B07">days</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">b[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])).date()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import datetime as DT# 取现在日期today = DT.datetime.now()# 取b[0]天前日期week_ago = (today - DT.timedelta(days=b[0])).date() # b[1]天后 week_pre = (today + DT.timedelta(days=b[1])).date()"><div></div></button></div></figure></div>
<p>我们传入<code>b = [-15 0]</code>，就可以获取上个半月的日期在<code>week_ago</code>里，今天的日期在<code>week_pre</code>里<br>
所以，可以用这一行构建需要的网址</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:65ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 爬取数据链接</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=59287&#x26;d1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_ago.day).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;m1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">( week_ago.month).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;y1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_ago.year </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> years[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">]) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;d2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.day).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;m2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.month).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;y2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.year </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> years[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# 爬取数据链接url = &#x22;http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=59287&#x26;d1=&#x22; +    str(week_ago.day).zfill(2) +    &#x22;&#x26;m1=&#x22; + str( week_ago.month).zfill(2) +    &#x22;&#x26;y1=&#x22; + str(week_ago.year - years[0]) +    &#x22;&#x26;d2=&#x22; + str(week_pre.day).zfill(2) +    &#x22;&#x26;m2=&#x22; + str(week_pre.month).zfill(2) +    &#x22;&#x26;y2=&#x22; + str(week_pre.year - years[1])"><div></div></button></div></figure></div>
<p>其中<code>.zfill(2)</code>是指填充2位，比如如果是1就返回01，如果是12就返回12
有了网址，接下来就是爬虫爬取网页然后分析网页元素取出里面的数据</p>
<h3 id="52-爬虫部分"><a class="not-prose" href="#52-爬虫部分">5.2 爬虫部分</a></h3>
<p>首先先写爬虫部分，这部分很简单，写了个<code>GetData</code> class</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">GetData.py</span></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:115ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># -*- coding: utf-8 -*-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Time: 2020/12/16</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Author: Eritque arcus</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 功能: 爬取数据</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> urllib3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">class</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">GetData</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">headers </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">""</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">__init__</span><span style="--0:#E1E4E8;--1:#24292E">(self, url, header</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">):</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">        </span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">:param url: 获取的网址</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">:param header: 请求头，默认已内置</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> url</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> header </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">            </span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.headers </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Connection'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'Keep-Alive'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Accept'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,'</span></div></div><div class="ec-line" style="--ecIndent:26ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">                          </span><span style="--0:#9ECBFF;--1:#032F62">'*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Accept-Language'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'zh-CN,zh;q=0.9,en;q=0.8'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Accept-Encoding'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'gzip, deflate'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'User-Agent'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, '</span></div></div><div class="ec-line" style="--ecIndent:30ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">                              </span><span style="--0:#9ECBFF;--1:#032F62">'like Gecko) Chrome/87.0.4280.66 Mobile Safari/537.36 '</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Host'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'www.meteomanz.com'</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">            </span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.headers </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> header</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Get</span><span style="--0:#E1E4E8;--1:#24292E">(self):</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">        </span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">:return: 网址对应的网页内容</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">http </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> urllib3.PoolManager()</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> http.request(</span><span style="--0:#9ECBFF;--1:#032F62">'GET'</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.url, </span><span style="--0:#FFAB70;--1:#AE4B07">headers</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.headers).data</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# -*- coding: utf-8 -*-# @Time: 2020/12/16# @Author: Eritque arcus# 功能: 爬取数据import urllib3class GetData:    url = &#x22;&#x22;    headers = &#x22;&#x22;    def __init__(self, url, header=&#x22;&#x22;):        &#x22;&#x22;&#x22;        :param url: 获取的网址        :param header: 请求头，默认已内置        &#x22;&#x22;&#x22;        self.url = url        if header == &#x22;&#x22;:            self.headers = {                &#x27;Connection&#x27;: &#x27;Keep-Alive&#x27;,                &#x27;Accept&#x27;: &#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,&#x27;                          &#x27;*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#x27;,                &#x27;Accept-Language&#x27;: &#x27;zh-CN,zh;q=0.9,en;q=0.8&#x27;,                &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;,                &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, &#x27;                              &#x27;like Gecko) Chrome/87.0.4280.66 Mobile Safari/537.36 &#x27;,                &#x27;Host&#x27;: &#x27;www.meteomanz.com&#x27;            }        else:            self.headers = header    def Get(self):        &#x22;&#x22;&#x22;        :return: 网址对应的网页内容        &#x22;&#x22;&#x22;        http = urllib3.PoolManager()        return http.request(&#x27;GET&#x27;, self.url, headers=self.headers).data"><div></div></button></div></figure></div>
<p>本处用了urllib3库和GET方式，其中headers是申请头，这部分可以在按F12调出开发者工具，在Network那一栏，点击任意一个事件，往下滑就有了，可以用我的也可以。请求头主要是http协议里的东西，想要了解可以自行搜索。</p>
<h3 id="53-网页内容匹配取出部分"><a class="not-prose" href="#53-网页内容匹配取出部分">5.3 网页内容匹配取出部分</a></h3>
<p>本处使用了<code>BeautifulSoup</code>库</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:97ch"><code><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">g </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> GetData(url).Get()</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># beautifulsoup解析网页</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">soup </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> BeautifulSoup(g, </span><span style="--0:#9ECBFF;--1:#032F62">"html5lib"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># 取&#x3C;tbody>内容</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">tb </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> soup.find(</span><span style="--0:#FFAB70;--1:#AE4B07">name</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"tbody"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># 取tr内容</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">past_tr </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> tb.find_all(</span><span style="--0:#FFAB70;--1:#AE4B07">name</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"tr"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> tr </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> past_tr:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972"># 取tr内每个td的内容</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">text </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> tr.find_all(</span><span style="--0:#FFAB70;--1:#AE4B07">name</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"td"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">flag </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">False</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(text)):</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].a.string</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">                    </span><span style="--0:#99A0A6;--1:#616972"># 网站bug，跨月请求的话会给每个月第0天的数据，但是里面是全空的因为日期不存在，比如 00/11/2020(日/月/年),所以要手动drop掉这个数据</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"00/"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> text[i]:</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                        </span></span><span style="--0:#E1E4E8;--1:#24292E">flag </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">True</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">elif</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">8</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">                    </span><span style="--0:#99A0A6;--1:#616972"># 把/8去掉，网页显示的格式问题</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].string.replace(</span><span style="--0:#9ECBFF;--1:#032F62">"/8"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">elif</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">5</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">                    </span><span style="--0:#99A0A6;--1:#616972"># 去掉Hpa单位</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].string.replace(</span><span style="--0:#9ECBFF;--1:#032F62">" Hpa"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">elif</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">6</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">                    </span><span style="--0:#99A0A6;--1:#616972"># 用正则去掉风力里括号内的内容</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> re.sub(</span><span style="--0:#F97583;--1:#BF3441">u</span><span style="--0:#9ECBFF;--1:#032F62">"[º(.*?|N|W|E|S)]"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">, text[i].string)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">                    </span><span style="--0:#99A0A6;--1:#616972"># 取每个元素的内容</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].string</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">                </span><span style="--0:#99A0A6;--1:#616972"># 丢失数据都取2(简陋做法)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">                </span><span style="--0:#99A0A6;--1:#616972"># 这么做 MAE=3.6021</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].replace(</span><span style="--0:#9ECBFF;--1:#032F62">"-"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"2"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].replace(</span><span style="--0:#9ECBFF;--1:#032F62">"Tr"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"2"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="        g = GetData(url).Get()        # beautifulsoup解析网页        soup = BeautifulSoup(g, &#x22;html5lib&#x22;)        # 取<tbody>内容        tb = soup.find(name=&#x22;tbody&#x22;)        # 取tr内容        past_tr = tb.find_all(name=&#x22;tr&#x22;)        for tr in past_tr:            # 取tr内每个td的内容            text = tr.find_all(name=&#x22;td&#x22;)            flag = False            for i in range(0, len(text)):                if i == 0:                    text[i] = text[i].a.string                    # 网站bug，跨月请求的话会给每个月第0天的数据，但是里面是全空的因为日期不存在，比如 00/11/2020(日/月/年),所以要手动drop掉这个数据                    if &#x22;00/&#x22; in text[i]:                        flag = True                elif i == 8:                    # 把/8去掉，网页显示的格式问题                    text[i] = text[i].string.replace(&#x22;/8&#x22;, &#x22;&#x22;)                elif i == 5:                    # 去掉Hpa单位                    text[i] = text[i].string.replace(&#x22; Hpa&#x22;, &#x22;&#x22;)                elif i == 6:                    # 用正则去掉风力里括号内的内容                    text[i] = re.sub(u&#x22;[º(.*?|N|W|E|S)]&#x22;, &#x22;&#x22;, text[i].string)                else:                    # 取每个元素的内容                    text[i] = text[i].string                # 丢失数据都取2(简陋做法)                # 这么做 MAE=3.6021                text[i] = text[i].replace(&#x22;-&#x22;, &#x22;2&#x22;)                text[i] = text[i].replace(&#x22;Tr&#x22;, &#x22;2&#x22;)"><div></div></button></div></figure></div>
<p>如果有什么不清楚的评论里答复。</p>
<h3 id="54写入csv文件格式化"><a class="not-prose" href="#54写入csv文件格式化">5.4写入csv文件格式化</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:50ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> csv</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 创建文件对象</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">f </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">open</span><span style="--0:#E1E4E8;--1:#24292E">(c, </span><span style="--0:#9ECBFF;--1:#032F62">'w'</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">encoding</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">'utf-8'</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">newline</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">''</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 基于文件对象构建 csv写入对象</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">csv_writer </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> csv.writer(f)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 写入内容,text数组</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">csv_writer.writerow(text)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 关闭文件</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">f.close()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    import csv    # 创建文件对象    f = open(c, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;, newline=&#x27;&#x27;)    # 基于文件对象构建 csv写入对象    csv_writer = csv.writer(f)    # 写入内容,text数组    csv_writer.writerow(text)    # 关闭文件    f.close()"><div></div></button></div></figure></div>
<h3 id="56封装成类"><a class="not-prose" href="#56封装成类">5.6封装成类</a></h3>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">Write.py</span></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:117ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># -*- coding: utf-8 -*-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Time: 2020/12/16</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Author: Eritque arcus</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @File: Write.py</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> re</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> bs4 </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> BeautifulSoup</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> GetData </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> GetData</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> datetime </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> csv</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">a</span><span style="--0:#E1E4E8;--1:#24292E">(t):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> t.replace(</span><span style="--0:#9ECBFF;--1:#032F62">" - "</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"0"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 功能: 写csv</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">write</span><span style="--0:#E1E4E8;--1:#24292E">(years, b, c):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param years: [开始日期距离现在的年份, 结束日期距离现在的年份]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param b: [开始日期距离现在日期的天数, 结束日期距离现在日期的天数]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param c: csv文件名</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:return: None</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 1. 创建文件对象</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">f </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">open</span><span style="--0:#E1E4E8;--1:#24292E">(c, </span><span style="--0:#9ECBFF;--1:#032F62">'w'</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">encoding</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">'utf-8'</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">newline</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">''</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 2. 基于文件对象构建 csv写入对象</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">csv_writer </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> csv.writer(f)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 3. 构建列表头</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># , "negAve", "negMax", "negMin"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">csv_writer.writerow([</span><span style="--0:#9ECBFF;--1:#032F62">"Time"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Ave_t"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Max_t"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Min_t"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Prec"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"SLpress"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Winddir"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Windsp"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Cloud"</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 取现在日期</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">today </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span><span style="--0:#E1E4E8;--1:#24292E">.datetime.now()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 取20天前日期</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">week_ago </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> (today </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span><span style="--0:#E1E4E8;--1:#24292E">.timedelta(</span><span style="--0:#FFAB70;--1:#AE4B07">days</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">b[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">])).date()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 20天后</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">week_pre </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> (today </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span><span style="--0:#E1E4E8;--1:#24292E">.timedelta(</span><span style="--0:#FFAB70;--1:#AE4B07">days</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">b[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])).date()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 城市id 广州59287 青岛 54857</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">id</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"59287"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 爬取数据链接</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">id</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;d1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_ago.day).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;m1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">week_ago.month).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;y1="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_ago.year </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> years[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">]) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;d2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.day).zfill(</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;m2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.month).zfill(</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"&#x26;y2="</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(week_pre.year </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> years[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 显示获取数据集的网址</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(url)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">g </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> GetData(url).Get()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># beautifulsoup解析网页</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">soup </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> BeautifulSoup(g, </span><span style="--0:#9ECBFF;--1:#032F62">"html5lib"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 取&#x3C;tbody>内容</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">tb </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> soup.find(</span><span style="--0:#FFAB70;--1:#AE4B07">name</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"tbody"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 取tr内容</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">past_tr </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> tb.find_all(</span><span style="--0:#FFAB70;--1:#AE4B07">name</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"tr"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> tr </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> past_tr:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># 取tr内每个td的内容</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">text </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> tr.find_all(</span><span style="--0:#FFAB70;--1:#AE4B07">name</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"td"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">flag </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">False</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">negA </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> negMax </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> negMin </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">False</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(text)):</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].a.string</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">                </span><span style="--0:#99A0A6;--1:#616972"># 网站bug，会给每个月第0天，比如 00/11/2020,所以要drop掉</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"00/"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> text[i]:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">flag </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">True</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">elif</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">8</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">                </span><span style="--0:#99A0A6;--1:#616972"># 把/8去掉，网页显示的格式</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].string.replace(</span><span style="--0:#9ECBFF;--1:#032F62">"/8"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">elif</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">5</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">                </span><span style="--0:#99A0A6;--1:#616972"># 去掉单位</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].string.replace(</span><span style="--0:#9ECBFF;--1:#032F62">" Hpa"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">elif</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">6</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">                </span><span style="--0:#99A0A6;--1:#616972"># 去掉风力里括号内的内容</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> re.sub(</span><span style="--0:#F97583;--1:#BF3441">u</span><span style="--0:#9ECBFF;--1:#032F62">"[º(.*?|N|W|E|S)]"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">, text[i].string)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">                </span><span style="--0:#99A0A6;--1:#616972"># 取每个元素的内容</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[i].string</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972"># 丢失数据都取2(简陋做法)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972"># 这么做 MAE=3.6021</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"2"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> text[i] </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"-"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> text[i]</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">text[i] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"2"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> text[i] </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"Tr"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> text[i]</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">text </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> text[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">:</span><span style="--0:#79B8FF;--1:#005CC5">9</span><span style="--0:#E1E4E8;--1:#24292E">]</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># ext += [str(int(negA)), str(int(negMax)), str(int(negMin))]</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># 4. 写入csv文件内容</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> flag:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">csv_writer.writerow(text)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 5. 关闭文件</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">f.close()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# -*- coding: utf-8 -*-# @Time: 2020/12/16# @Author: Eritque arcus# @File: Write.pyimport refrom bs4 import BeautifulSoupfrom GetData import GetDataimport datetime as DTimport csvdef a(t):    return t.replace(&#x22; - &#x22;, &#x22;0&#x22;)# 功能: 写csvdef write(years, b, c):    &#x22;&#x22;&#x22;    :param years: [开始日期距离现在的年份, 结束日期距离现在的年份]    :param b: [开始日期距离现在日期的天数, 结束日期距离现在日期的天数]    :param c: csv文件名    :return: None    &#x22;&#x22;&#x22;    # 1. 创建文件对象    f = open(c, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;, newline=&#x27;&#x27;)    # 2. 基于文件对象构建 csv写入对象    csv_writer = csv.writer(f)    # 3. 构建列表头    # , &#x22;negAve&#x22;, &#x22;negMax&#x22;, &#x22;negMin&#x22;    csv_writer.writerow([&#x22;Time&#x22;, &#x22;Ave_t&#x22;, &#x22;Max_t&#x22;, &#x22;Min_t&#x22;, &#x22;Prec&#x22;, &#x22;SLpress&#x22;, &#x22;Winddir&#x22;, &#x22;Windsp&#x22;, &#x22;Cloud&#x22;])    # 取现在日期    today = DT.datetime.now()    # 取20天前日期    week_ago = (today - DT.timedelta(days=b[0])).date()    # 20天后    week_pre = (today + DT.timedelta(days=b[1])).date()    # 城市id 广州59287 青岛 54857    id = &#x22;59287&#x22;    # 爬取数据链接    url = &#x22;http://www.meteomanz.com/sy2?l=1&#x26;cou=2250&#x26;ind=&#x22; + id + &#x22;&#x26;d1=&#x22; + str(week_ago.day).zfill(2) + &#x22;&#x26;m1=&#x22; + str(        week_ago.month).zfill(2) + &#x22;&#x26;y1=&#x22; + str(week_ago.year - years[0]) + &#x22;&#x26;d2=&#x22; + str(week_pre.day).zfill(        2) + &#x22;&#x26;m2=&#x22; + str(week_pre.month).zfill(2) + &#x22;&#x26;y2=&#x22; + str(week_pre.year - years[1])    # 显示获取数据集的网址    print(url)    g = GetData(url).Get()    # beautifulsoup解析网页    soup = BeautifulSoup(g, &#x22;html5lib&#x22;)    # 取<tbody>内容    tb = soup.find(name=&#x22;tbody&#x22;)    # 取tr内容    past_tr = tb.find_all(name=&#x22;tr&#x22;)    for tr in past_tr:        # 取tr内每个td的内容        text = tr.find_all(name=&#x22;td&#x22;)        flag = False        negA = negMax = negMin = False        for i in range(0, len(text)):            if i == 0:                text[i] = text[i].a.string                # 网站bug，会给每个月第0天，比如 00/11/2020,所以要drop掉                if &#x22;00/&#x22; in text[i]:                    flag = True            elif i == 8:                # 把/8去掉，网页显示的格式                text[i] = text[i].string.replace(&#x22;/8&#x22;, &#x22;&#x22;)            elif i == 5:                # 去掉单位                text[i] = text[i].string.replace(&#x22; Hpa&#x22;, &#x22;&#x22;)            elif i == 6:                # 去掉风力里括号内的内容                text[i] = re.sub(u&#x22;[º(.*?|N|W|E|S)]&#x22;, &#x22;&#x22;, text[i].string)            else:                # 取每个元素的内容                text[i] = text[i].string            # 丢失数据都取2(简陋做法)            # 这么做 MAE=3.6021            text[i] = &#x22;2&#x22; if text[i] == &#x22;-&#x22; else text[i]            text[i] = &#x22;2&#x22; if text[i] == &#x22;Tr&#x22; else text[i]        text = text[0:9]        # ext += [str(int(negA)), str(int(negMax)), str(int(negMin))]        # 4. 写入csv文件内容        if not flag:            csv_writer.writerow(text)    # 5. 关闭文件    f.close()"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">GetData.py</span></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:115ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># -*- coding: utf-8 -*-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Time: 2020/12/16</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Author: Eritque arcus</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @File: GetData.py</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 功能: 爬取数据</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> urllib3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">class</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">GetData</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">headers </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">""</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">__init__</span><span style="--0:#E1E4E8;--1:#24292E">(self, url, header</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">):</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">        </span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">:param url: 获取的网址</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">:param header: 请求头，默认已内置</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> url</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> header </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">            </span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.headers </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Connection'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'Keep-Alive'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Accept'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,'</span></div></div><div class="ec-line" style="--ecIndent:26ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">                          </span><span style="--0:#9ECBFF;--1:#032F62">'*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Accept-Language'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'zh-CN,zh;q=0.9,en;q=0.8'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Accept-Encoding'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'gzip, deflate'</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'User-Agent'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, '</span></div></div><div class="ec-line" style="--ecIndent:30ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">                              </span><span style="--0:#9ECBFF;--1:#032F62">'like Gecko) Chrome/87.0.4280.66 Mobile Safari/537.36 '</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">                </span><span style="--0:#9ECBFF;--1:#032F62">'Host'</span><span style="--0:#E1E4E8;--1:#24292E">: </span><span style="--0:#9ECBFF;--1:#032F62">'www.meteomanz.com'</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">            </span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.headers </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> header</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Get</span><span style="--0:#E1E4E8;--1:#24292E">(self):</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">        </span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">:return: 网址对应的网页内容</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">http </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> urllib3.PoolManager()</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> http.request(</span><span style="--0:#9ECBFF;--1:#032F62">'GET'</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.url, </span><span style="--0:#FFAB70;--1:#AE4B07">headers</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">self</span><span style="--0:#E1E4E8;--1:#24292E">.headers).data</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# -*- coding: utf-8 -*-# @Time: 2020/12/16# @Author: Eritque arcus# @File: GetData.py# 功能: 爬取数据import urllib3class GetData:    url = &#x22;&#x22;    headers = &#x22;&#x22;    def __init__(self, url, header=&#x22;&#x22;):        &#x22;&#x22;&#x22;        :param url: 获取的网址        :param header: 请求头，默认已内置        &#x22;&#x22;&#x22;        self.url = url        if header == &#x22;&#x22;:            self.headers = {                &#x27;Connection&#x27;: &#x27;Keep-Alive&#x27;,                &#x27;Accept&#x27;: &#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,&#x27;                          &#x27;*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#x27;,                &#x27;Accept-Language&#x27;: &#x27;zh-CN,zh;q=0.9,en;q=0.8&#x27;,                &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;,                &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, &#x27;                              &#x27;like Gecko) Chrome/87.0.4280.66 Mobile Safari/537.36 &#x27;,                &#x27;Host&#x27;: &#x27;www.meteomanz.com&#x27;            }        else:            self.headers = header    def Get(self):        &#x22;&#x22;&#x22;        :return: 网址对应的网页内容        &#x22;&#x22;&#x22;        http = urllib3.PoolManager()        return http.request(&#x27;GET&#x27;, self.url, headers=self.headers).data"><div></div></button></div></figure></div>
<p>到时候就可以直接用一行命令取得天气数据了，如下面是取去年今日的20天到去年今日的天气数据</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:53ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 用近几年的数据做训练集</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 如 [1,1], [20, 0]就是用2019年的今天的20天前到2019年的今天数据做训练集</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 写入csv</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">Write([</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">], [</span><span style="--0:#79B8FF;--1:#005CC5">20</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">], </span><span style="--0:#9ECBFF;--1:#032F62">"weather_train_train.csv"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    # 用近几年的数据做训练集    # 如 [1,1], [20, 0]就是用2019年的今天的20天前到2019年的今天数据做训练集    # 写入csv    Write([1, 1], [20, 0], &#x22;weather_train_train.csv&#x22;)"><div></div></button></div></figure></div>
<p>结果如下</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">weather_train_train.csv</span></figcaption><pre data-language="csv" class="wrap" style="--ecMaxLine:56ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">Time,</span><span style="--0:#F97583;--1:#BF3441">Ave_t,</span><span style="--0:#B392F0;--1:#6F42C1">Max_t,</span><span style="--0:#99A0A6;--1:#616972">Min_t,</span><span style="--0:#9ECBFF;--1:#032F62">Prec,</span><span style="--0:#FFAB70;--1:#AE4B07">SLpress,</span><span style="--0:#79B8FF;--1:#005CC5">Winddir,</span><span style="--0:#B392F0;--1:#6F42C1">Windsp,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">Cloud</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">07/12/2019,</span><span style="--0:#F97583;--1:#BF3441">14.8,</span><span style="--0:#B392F0;--1:#6F42C1">20.8,</span><span style="--0:#99A0A6;--1:#616972">8.8,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1026.3,</span><span style="--0:#79B8FF;--1:#005CC5">331,</span><span style="--0:#B392F0;--1:#6F42C1">11,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">06/12/2019,</span><span style="--0:#F97583;--1:#BF3441">15.2,</span><span style="--0:#B392F0;--1:#6F42C1">19.8,</span><span style="--0:#99A0A6;--1:#616972">10.7,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1026.6,</span><span style="--0:#79B8FF;--1:#005CC5">344,</span><span style="--0:#B392F0;--1:#6F42C1">15,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">05/12/2019,</span><span style="--0:#F97583;--1:#BF3441">14.5,</span><span style="--0:#B392F0;--1:#6F42C1">20.4,</span><span style="--0:#99A0A6;--1:#616972">8.6,</span><span style="--0:#9ECBFF;--1:#032F62">2,</span><span style="--0:#FFAB70;--1:#AE4B07">1026.2,</span><span style="--0:#79B8FF;--1:#005CC5">346,</span><span style="--0:#B392F0;--1:#6F42C1">13,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">8</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">04/12/2019,</span><span style="--0:#F97583;--1:#BF3441">13.8,</span><span style="--0:#B392F0;--1:#6F42C1">20.4,</span><span style="--0:#99A0A6;--1:#616972">7.1,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1024.7,</span><span style="--0:#79B8FF;--1:#005CC5">335,</span><span style="--0:#B392F0;--1:#6F42C1">16,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">03/12/2019,</span><span style="--0:#F97583;--1:#BF3441">13.0,</span><span style="--0:#B392F0;--1:#6F42C1">18.9,</span><span style="--0:#99A0A6;--1:#616972">7.1,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1024.8,</span><span style="--0:#79B8FF;--1:#005CC5">330,</span><span style="--0:#B392F0;--1:#6F42C1">10,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">02/12/2019,</span><span style="--0:#F97583;--1:#BF3441">18.2,</span><span style="--0:#B392F0;--1:#6F42C1">24.9,</span><span style="--0:#99A0A6;--1:#616972">11.5,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1024.8,</span><span style="--0:#79B8FF;--1:#005CC5">347,</span><span style="--0:#B392F0;--1:#6F42C1">18,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">01/12/2019,</span><span style="--0:#F97583;--1:#BF3441">18.1,</span><span style="--0:#B392F0;--1:#6F42C1">24.9,</span><span style="--0:#99A0A6;--1:#616972">11.4,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1020.9,</span><span style="--0:#79B8FF;--1:#005CC5">332,</span><span style="--0:#B392F0;--1:#6F42C1">16,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">30/11/2019,</span><span style="--0:#F97583;--1:#BF3441">17.5,</span><span style="--0:#B392F0;--1:#6F42C1">23.6,</span><span style="--0:#99A0A6;--1:#616972">11.4,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1020.5,</span><span style="--0:#79B8FF;--1:#005CC5">352,</span><span style="--0:#B392F0;--1:#6F42C1">8,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">29/11/2019,</span><span style="--0:#F97583;--1:#BF3441">15.8,</span><span style="--0:#B392F0;--1:#6F42C1">20.1,</span><span style="--0:#99A0A6;--1:#616972">11.5,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1023.6,</span><span style="--0:#79B8FF;--1:#005CC5">349,</span><span style="--0:#B392F0;--1:#6F42C1">11,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">4</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">28/11/2019,</span><span style="--0:#F97583;--1:#BF3441">20.4,</span><span style="--0:#B392F0;--1:#6F42C1">27.1,</span><span style="--0:#99A0A6;--1:#616972">13.8,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1024.5,</span><span style="--0:#79B8FF;--1:#005CC5">337,</span><span style="--0:#B392F0;--1:#6F42C1">19,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">27/11/2019,</span><span style="--0:#F97583;--1:#BF3441">21.9,</span><span style="--0:#B392F0;--1:#6F42C1">27.1,</span><span style="--0:#99A0A6;--1:#616972">16.6,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1021.3,</span><span style="--0:#79B8FF;--1:#005CC5">336,</span><span style="--0:#B392F0;--1:#6F42C1">12,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">26/11/2019,</span><span style="--0:#F97583;--1:#BF3441">22.2,</span><span style="--0:#B392F0;--1:#6F42C1">28.4,</span><span style="--0:#99A0A6;--1:#616972">16.1,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1021.1,</span><span style="--0:#79B8FF;--1:#005CC5">356,</span><span style="--0:#B392F0;--1:#6F42C1">6,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">6</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">25/11/2019,</span><span style="--0:#F97583;--1:#BF3441">22.2,</span><span style="--0:#B392F0;--1:#6F42C1">29.3,</span><span style="--0:#99A0A6;--1:#616972">15.2,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1020.8,</span><span style="--0:#79B8FF;--1:#005CC5">344,</span><span style="--0:#B392F0;--1:#6F42C1">13,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">24/11/2019,</span><span style="--0:#F97583;--1:#BF3441">21.4,</span><span style="--0:#B392F0;--1:#6F42C1">29.3,</span><span style="--0:#99A0A6;--1:#616972">13.6,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1018.5,</span><span style="--0:#79B8FF;--1:#005CC5">346,</span><span style="--0:#B392F0;--1:#6F42C1">5,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">23/11/2019,</span><span style="--0:#F97583;--1:#BF3441">20.7,</span><span style="--0:#B392F0;--1:#6F42C1">28.4,</span><span style="--0:#99A0A6;--1:#616972">13.0,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1017.2,</span><span style="--0:#79B8FF;--1:#005CC5">352,</span><span style="--0:#B392F0;--1:#6F42C1">5,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">22/11/2019,</span><span style="--0:#F97583;--1:#BF3441">19.6,</span><span style="--0:#B392F0;--1:#6F42C1">27.6,</span><span style="--0:#99A0A6;--1:#616972">11.6,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1017.3,</span><span style="--0:#79B8FF;--1:#005CC5">331,</span><span style="--0:#B392F0;--1:#6F42C1">6,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">21/11/2019,</span><span style="--0:#F97583;--1:#BF3441">18.4,</span><span style="--0:#B392F0;--1:#6F42C1">25.1,</span><span style="--0:#99A0A6;--1:#616972">11.6,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1019.1,</span><span style="--0:#79B8FF;--1:#005CC5">323,</span><span style="--0:#B392F0;--1:#6F42C1">9,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">20/11/2019,</span><span style="--0:#F97583;--1:#BF3441">18.3,</span><span style="--0:#B392F0;--1:#6F42C1">24.2,</span><span style="--0:#99A0A6;--1:#616972">12.4,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1020.3,</span><span style="--0:#79B8FF;--1:#005CC5">338,</span><span style="--0:#B392F0;--1:#6F42C1">7,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">19/11/2019,</span><span style="--0:#F97583;--1:#BF3441">19.1,</span><span style="--0:#B392F0;--1:#6F42C1">25.4,</span><span style="--0:#99A0A6;--1:#616972">12.8,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1020.5,</span><span style="--0:#79B8FF;--1:#005CC5">342,</span><span style="--0:#B392F0;--1:#6F42C1">11,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">18/11/2019,</span><span style="--0:#F97583;--1:#BF3441">22.2,</span><span style="--0:#B392F0;--1:#6F42C1">28.8,</span><span style="--0:#99A0A6;--1:#616972">15.7,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1018.8,</span><span style="--0:#79B8FF;--1:#005CC5">342,</span><span style="--0:#B392F0;--1:#6F42C1">17,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">17/11/2019,</span><span style="--0:#F97583;--1:#BF3441">22.2,</span><span style="--0:#B392F0;--1:#6F42C1">28.8,</span><span style="--0:#99A0A6;--1:#616972">15.7,</span><span style="--0:#9ECBFF;--1:#032F62">0.0,</span><span style="--0:#FFAB70;--1:#AE4B07">1015.2,</span><span style="--0:#79B8FF;--1:#005CC5">358,</span><span style="--0:#B392F0;--1:#6F42C1">7,</span><span style="--0:#E1E4E8;--0fw:bold;--1:#24292E;--1fw:bold">3</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Time,Ave_t,Max_t,Min_t,Prec,SLpress,Winddir,Windsp,Cloud07/12/2019,14.8,20.8,8.8,0.0,1026.3,331,11,006/12/2019,15.2,19.8,10.7,0.0,1026.6,344,15,005/12/2019,14.5,20.4,8.6,2,1026.2,346,13,804/12/2019,13.8,20.4,7.1,0.0,1024.7,335,16,203/12/2019,13.0,18.9,7.1,0.0,1024.8,330,10,002/12/2019,18.2,24.9,11.5,0.0,1024.8,347,18,301/12/2019,18.1,24.9,11.4,0.0,1020.9,332,16,130/11/2019,17.5,23.6,11.4,0.0,1020.5,352,8,329/11/2019,15.8,20.1,11.5,0.0,1023.6,349,11,428/11/2019,20.4,27.1,13.8,0.0,1024.5,337,19,327/11/2019,21.9,27.1,16.6,0.0,1021.3,336,12,026/11/2019,22.2,28.4,16.1,0.0,1021.1,356,6,625/11/2019,22.2,29.3,15.2,0.0,1020.8,344,13,324/11/2019,21.4,29.3,13.6,0.0,1018.5,346,5,023/11/2019,20.7,28.4,13.0,0.0,1017.2,352,5,122/11/2019,19.6,27.6,11.6,0.0,1017.3,331,6,021/11/2019,18.4,25.1,11.6,0.0,1019.1,323,9,120/11/2019,18.3,24.2,12.4,0.0,1020.3,338,7,019/11/2019,19.1,25.4,12.8,0.0,1020.5,342,11,018/11/2019,22.2,28.8,15.7,0.0,1018.8,342,17,017/11/2019,22.2,28.8,15.7,0.0,1015.2,358,7,3"><div></div></button></div></figure></div>
<h2 id="6数据预处理"><a class="not-prose" href="#6数据预处理">6.数据预处理</a></h2>
<p>如果在把上面的数据作为数据集训练，我们还需要做些数据的预处理，因为有些情况下我们得到的数据会有残缺，这种情况我们就要选择抛弃那一列或者用方差或其他什么的方法填充缺少的数据。</p>
<p>因为在我已经决定把数据里丢失的项全部取2了，所以下面我会列出可能的解决方法而不使用。</p>
<p>新建个<code>ProcessData.py</code>里建立<code>ProcessData</code>方法以获得数据</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">ProcessData.py</span></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:110ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># -*- coding: utf-8 -*-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Time: 2020/12/16</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Author: Eritque arcus</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @File: ProcessData.py</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> Write </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Write</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> pandas </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> pd</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> sklearn.model_selection </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> train_test_split</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> sklearn.impute </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> SimpleImputer</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> seaborn </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> sns</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> matplotlib.pyplot </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> plt</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 功能: 数据预处理</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">ProcessData</span><span style="--0:#E1E4E8;--1:#24292E">():</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:return:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">[X_train X训练数据集,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">X_valid X训练数据集的验证集,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">y_train Y训练数据集,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">y_valid Y训练数据集的验证集,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">imputed_X_test 预测数据集]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 用近几年的数据做训练集</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 如 [1,1], [20, 0]就是用2019年的今天的20天前到2019年的今天数据做训练集</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 写入csv</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">Write([</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">], [</span><span style="--0:#79B8FF;--1:#005CC5">20</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">], </span><span style="--0:#9ECBFF;--1:#032F62">"weather_train_train.csv"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">Write([</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">], [</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">20</span><span style="--0:#E1E4E8;--1:#24292E">], </span><span style="--0:#9ECBFF;--1:#032F62">"weather_train_valid.csv"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">Write([</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">], [</span><span style="--0:#79B8FF;--1:#005CC5">20</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">], </span><span style="--0:#9ECBFF;--1:#032F62">"weather_test.csv"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">X_test </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> pd.read_csv(</span><span style="--0:#9ECBFF;--1:#032F62">"weather_test.csv"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">index_col</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"Time"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">parse_dates</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">True</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 读取测试集和验证集</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">X </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> pd.read_csv(</span><span style="--0:#9ECBFF;--1:#032F62">"weather_train_train.csv"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">index_col</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"Time"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">parse_dates</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">True</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">y </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> pd.read_csv(</span><span style="--0:#9ECBFF;--1:#032F62">"weather_train_valid.csv"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">index_col</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"Time"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">parse_dates</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">True</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 把全部丢失的数据都drop，MAE=3.7又高了，所以去掉了</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># dxtcol = [col for col in X_test.columns</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#           if X_test[col].isnull().all()]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># dxcol = [col for col in X.columns</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#          if X[col].isnull().all()]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># dycol = [col for col in y.columns</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#          if y[col].isnull().all()]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># for a1 in [dxtcol, dxcol, dycol]:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#     for a2 in a1:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#         if a2 in X_test.columns:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#             X_test = X_test.drop(a2, axis=1)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#         if a2 in X.columns:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#             X = X.drop(a2, axis=1)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#         if a2 in y.columns:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#             y = y.drop(a2, axis=1)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 数据归一化和标准化，无法还原不用</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># scaler = preprocessing.StandardScaler()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># pars = [cols for cols in X.columns if cols != "Time"]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># for data in [X, y, X_test]:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#     for par in pars:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#         data[par] = scaler.fit_transform(data[par].values.reshape(-1, 1))</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#         # temp = scaler.fit(data[par].values.reshape(-1, 1))</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#         # data[par] = scaler.fit_transform(data[par].values.reshape(-1, 1), temp)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 填充缺少的数值用方差，不清楚效果如何</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">my_imputer </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> SimpleImputer()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">X_train, X_valid, y_train, y_valid </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> train_test_split(X, y, </span><span style="--0:#FFAB70;--1:#AE4B07">train_size</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">0.8</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">test_size</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">0.2</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">random_state</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">imputed_X_train </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> pd.DataFrame(my_imputer.fit_transform(X_train))</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">imputed_X_valid </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> pd.DataFrame(my_imputer.transform(X_valid))</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">imputed_X_train.columns </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> X_train.columns</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">imputed_X_valid.columns </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> X_valid.columns</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">imputed_y_train </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> pd.DataFrame(my_imputer.fit_transform(y_train))</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">imputed_y_valid </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> pd.DataFrame(my_imputer.transform(y_valid))</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">imputed_y_train.columns </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> y_train.columns</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">imputed_y_valid.columns </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> y_valid.columns</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">imputed_X_test </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> pd.DataFrame(my_imputer.fit_transform(X_test))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 画折线图</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># sns.lineplot(data=X)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># plt.show()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># sns.lineplot(data=y)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># plt.show()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># sns.lineplot(data=X_test)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># plt.show()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 返回分割后的数据集</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> [imputed_X_train, imputed_X_valid, imputed_y_train, imputed_y_valid, imputed_X_test]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# -*- coding: utf-8 -*-# @Time: 2020/12/16# @Author: Eritque arcus# @File: ProcessData.pyfrom Write import Writeimport pandas as pdfrom sklearn.model_selection import train_test_splitfrom sklearn.impute import SimpleImputerimport seaborn as snsimport matplotlib.pyplot as plt# 功能: 数据预处理def ProcessData():    &#x22;&#x22;&#x22;    :return:        [X_train X训练数据集,        X_valid X训练数据集的验证集,        y_train Y训练数据集,        y_valid Y训练数据集的验证集,        imputed_X_test 预测数据集]    &#x22;&#x22;&#x22;    # 用近几年的数据做训练集    # 如 [1,1], [20, 0]就是用2019年的今天的20天前到2019年的今天数据做训练集    # 写入csv    Write([1, 1], [20, 0], &#x22;weather_train_train.csv&#x22;)    Write([1, 1], [0, 20], &#x22;weather_train_valid.csv&#x22;)    Write([0, 0], [20, 0], &#x22;weather_test.csv&#x22;)    X_test = pd.read_csv(&#x22;weather_test.csv&#x22;, index_col=&#x22;Time&#x22;, parse_dates=True)    # 读取测试集和验证集    X = pd.read_csv(&#x22;weather_train_train.csv&#x22;, index_col=&#x22;Time&#x22;, parse_dates=True)    y = pd.read_csv(&#x22;weather_train_valid.csv&#x22;, index_col=&#x22;Time&#x22;, parse_dates=True)    # 把全部丢失的数据都drop，MAE=3.7又高了，所以去掉了    # dxtcol = [col for col in X_test.columns    #           if X_test[col].isnull().all()]    # dxcol = [col for col in X.columns    #          if X[col].isnull().all()]    # dycol = [col for col in y.columns    #          if y[col].isnull().all()]    # for a1 in [dxtcol, dxcol, dycol]:    #     for a2 in a1:    #         if a2 in X_test.columns:    #             X_test = X_test.drop(a2, axis=1)    #         if a2 in X.columns:    #             X = X.drop(a2, axis=1)    #         if a2 in y.columns:    #             y = y.drop(a2, axis=1)    # 数据归一化和标准化，无法还原不用    # scaler = preprocessing.StandardScaler()    # pars = [cols for cols in X.columns if cols != &#x22;Time&#x22;]    # for data in [X, y, X_test]:    #     for par in pars:    #         data[par] = scaler.fit_transform(data[par].values.reshape(-1, 1))    #         # temp = scaler.fit(data[par].values.reshape(-1, 1))    #         # data[par] = scaler.fit_transform(data[par].values.reshape(-1, 1), temp)    # 填充缺少的数值用方差，不清楚效果如何    my_imputer = SimpleImputer()    X_train, X_valid, y_train, y_valid = train_test_split(X, y, train_size=0.8, test_size=0.2, random_state=0)    imputed_X_train = pd.DataFrame(my_imputer.fit_transform(X_train))    imputed_X_valid = pd.DataFrame(my_imputer.transform(X_valid))    imputed_X_train.columns = X_train.columns    imputed_X_valid.columns = X_valid.columns    imputed_y_train = pd.DataFrame(my_imputer.fit_transform(y_train))    imputed_y_valid = pd.DataFrame(my_imputer.transform(y_valid))    imputed_y_train.columns = y_train.columns    imputed_y_valid.columns = y_valid.columns    imputed_X_test = pd.DataFrame(my_imputer.fit_transform(X_test))    # 画折线图    # sns.lineplot(data=X)    # plt.show()    # sns.lineplot(data=y)    # plt.show()    # sns.lineplot(data=X_test)    # plt.show()    # 返回分割后的数据集    return [imputed_X_train, imputed_X_valid, imputed_y_train, imputed_y_valid, imputed_X_test]"><div></div></button></div></figure></div>
<h2 id="7建立模型"><a class="not-prose" href="#7建立模型">7.建立模型</a></h2>
<h3 id="71准备"><a class="not-prose" href="#71准备">7.1准备</a></h3>
<h4 id="711-引入所需要的头文件"><a class="not-prose" href="#711-引入所需要的头文件">7.1.1 引入所需要的头文件</a></h4>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:60ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> sklearn.ensemble </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> RandomForestRegressor </span><span style="--0:#99A0A6;--1:#616972"># 随机树森林模型</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> joblib </span><span style="--0:#99A0A6;--1:#616972"># 保存模型为pkl</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> sklearn.metrics </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> mean_absolute_error </span><span style="--0:#99A0A6;--1:#616972"># MAE评估方法</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ProcessData </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> ProcessData </span><span style="--0:#99A0A6;--1:#616972"># 取数据</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="from sklearn.ensemble import RandomForestRegressor # 随机树森林模型import joblib # 保存模型为pklfrom sklearn.metrics import mean_absolute_error # MAE评估方法from ProcessData import ProcessData # 取数据"><div></div></button></div></figure></div>
<h4 id="712-选择模型"><a class="not-prose" href="#712-选择模型">7.1.2 选择模型</a></h4>
<p>首先我们先要从模型里选择一项适合这次场景的模型，比如从决策树，随机树森林，RGB模型等等中选择，本处选用的随机树森林也就是 <code>RandomForest</code></p>
<h4 id="713-选择评估方法"><a class="not-prose" href="#713-选择评估方法">7.1.3 选择评估方法</a></h4>
<p>目前有许多的模型准确率评估方法，本处使用的是MAE，也就是mean_absolute_error 平均错误数值，就每个预测的数值离正确数值错误数值的平均数</p>
<h4 id="714-获取数据集"><a class="not-prose" href="#714-获取数据集">7.1.4 获取数据集</a></h4>
<p>这次可以从<code>ProcessData()</code>获取到全部的被预处理后的数据，如</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:64ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 取到数据</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">[X_train, X_valid, y_train, y_valid, X_test] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> ProcessData()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    # 取到数据    [X_train, X_valid, y_train, y_valid, X_test] = ProcessData()"><div></div></button></div></figure></div>
<h3 id="72建立模型"><a class="not-prose" href="#72建立模型">7.2建立模型</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:92ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 用XGB模型，不过用有bug</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># modelX = XGBRegressor(n_estimators=1000, learning_rate=0.05, random_state=0, n_jobs=4)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># # model.fit(X_train_3, y_train_3)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># # model.fit(X_train_2, y_train_2)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># col = ["Ave_t", "Max_t", "Min_t", "Prec","SLpress", "Winddir", "Windsp", "Cloud"]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># modelX.fit(X_train, y_train,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#           early_stopping_rounds=5,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#           eval_set=[(X_valid, y_valid)],</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#           verbose=False)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 随机树森林模型</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">model </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> RandomForestRegressor(</span><span style="--0:#FFAB70;--1:#AE4B07">random_state</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">n_estimators</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">1001</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 训练模型</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">model.fit(X_train, y_train)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    # 用XGB模型，不过用有bug    # modelX = XGBRegressor(n_estimators=1000, learning_rate=0.05, random_state=0, n_jobs=4)    # # model.fit(X_train_3, y_train_3)    # # model.fit(X_train_2, y_train_2)    # col = [&#x22;Ave_t&#x22;, &#x22;Max_t&#x22;, &#x22;Min_t&#x22;, &#x22;Prec&#x22;,&#x22;SLpress&#x22;, &#x22;Winddir&#x22;, &#x22;Windsp&#x22;, &#x22;Cloud&#x22;]    # modelX.fit(X_train, y_train,    #           early_stopping_rounds=5,    #           eval_set=[(X_valid, y_valid)],    #           verbose=False)    # 随机树森林模型    model = RandomForestRegressor(random_state=0, n_estimators=1001)    # 训练模型    model.fit(X_train, y_train)"><div></div></button></div></figure></div>
<p>其中n_estimators是可自己选的，不过在多次调试后得到1001是MAE最优</p>
<h3 id="73-获取模型评估结果"><a class="not-prose" href="#73-获取模型评估结果">7.3 获取模型评估结果</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:47ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 用MAE评估</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">score </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> mean_absolute_error(y_valid, preds)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    # 用MAE评估    score = mean_absolute_error(y_valid, preds)"><div></div></button></div></figure></div>
<h3 id="74-用joblib模块保存模型"><a class="not-prose" href="#74-用joblib模块保存模型">7.4 用joblib模块保存模型</a></h3>
<p>保存后的模型便于传播即可多次使用，但当前环境下的需求不大但我还是写了</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:25ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 保存模型到本地</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">joblib.dump(model, a)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    # 保存模型到本地    joblib.dump(model, a)"><div></div></button></div></figure></div>
<h3 id="75-封装"><a class="not-prose" href="#75-封装">7.5 封装</a></h3>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">GetModel.py</span></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:92ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># -*- coding: utf-8 -*-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Time: 2020/12/16</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Author: Eritque arcus</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @File: GetModel.py</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> sklearn.ensemble </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> RandomForestRegressor</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> joblib</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> sklearn.metrics </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> mean_absolute_error</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ProcessData </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> ProcessData</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 训练并保存模型</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">GetModel</span><span style="--0:#E1E4E8;--1:#24292E">(a</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"Model.pkl"</span><span style="--0:#E1E4E8;--1:#24292E">):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param a: 模型文件名</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:return:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">[socre: MAE评估结果,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">X_test: 预测数据集]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 取到数据</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">[X_train, X_valid, y_train, y_valid, X_test] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> ProcessData()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 用XGB模型，不过用有bug</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># modelX = XGBRegressor(n_estimators=1000, learning_rate=0.05, random_state=0, n_jobs=4)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># # model.fit(X_train_3, y_train_3)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># # model.fit(X_train_2, y_train_2)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># col = ["Ave_t", "Max_t", "Min_t", "Prec","SLpress", "Winddir", "Windsp", "Cloud"]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># modelX.fit(X_train, y_train,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#           early_stopping_rounds=5,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#           eval_set=[(X_valid, y_valid)],</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">#           verbose=False)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 随机树森林模型</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">model </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> RandomForestRegressor(</span><span style="--0:#FFAB70;--1:#AE4B07">random_state</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">n_estimators</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">1001</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 训练模型</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">model.fit(X_train, y_train)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 预测模型，用上个星期的数据</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">preds </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> model.predict(X_valid)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 用MAE评估</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">score </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> mean_absolute_error(y_valid, preds)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 保存模型到本地</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">joblib.dump(model, a)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 返回MAE</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> [score, X_test]</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# -*- coding: utf-8 -*-# @Time: 2020/12/16# @Author: Eritque arcus# @File: GetModel.pyfrom sklearn.ensemble import RandomForestRegressorimport joblibfrom sklearn.metrics import mean_absolute_errorfrom ProcessData import ProcessData# 训练并保存模型def GetModel(a=&#x22;Model.pkl&#x22;):    &#x22;&#x22;&#x22;    :param a: 模型文件名    :return:        [socre: MAE评估结果,        X_test: 预测数据集]    &#x22;&#x22;&#x22;    # 取到数据    [X_train, X_valid, y_train, y_valid, X_test] = ProcessData()    # 用XGB模型，不过用有bug    # modelX = XGBRegressor(n_estimators=1000, learning_rate=0.05, random_state=0, n_jobs=4)    # # model.fit(X_train_3, y_train_3)    # # model.fit(X_train_2, y_train_2)    # col = [&#x22;Ave_t&#x22;, &#x22;Max_t&#x22;, &#x22;Min_t&#x22;, &#x22;Prec&#x22;,&#x22;SLpress&#x22;, &#x22;Winddir&#x22;, &#x22;Windsp&#x22;, &#x22;Cloud&#x22;]    # modelX.fit(X_train, y_train,    #           early_stopping_rounds=5,    #           eval_set=[(X_valid, y_valid)],    #           verbose=False)    # 随机树森林模型    model = RandomForestRegressor(random_state=0, n_estimators=1001)    # 训练模型    model.fit(X_train, y_train)    # 预测模型，用上个星期的数据    preds = model.predict(X_valid)    # 用MAE评估    score = mean_absolute_error(y_valid, preds)    # 保存模型到本地    joblib.dump(model, a)    # 返回MAE    return [score, X_test]"><div></div></button></div></figure></div>
<h2 id="8-总控"><a class="not-prose" href="#8-总控">8 总控</a></h2>
<h3 id="81-代码"><a class="not-prose" href="#81-代码">8.1 代码</a></h3>
<p>这几篇文章写了零零散散好几个类，所以要写个总文件也就是启动文件串起来，然后在控制台输出</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">main.py</span></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:69ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># -*- coding: utf-8 -*-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Time: 2020/12/16</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @Author: Eritque arcus</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># @File: Main.py</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> joblib</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> datetime </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> GetModel </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> GetModel</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> matplotlib.pyplot </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> plt</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 训练并保存模型并返回MAE</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">r </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> GetModel()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"MAE:"</span><span style="--0:#E1E4E8;--1:#24292E">, r[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 读取保存的模型</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">model </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> joblib.load(</span><span style="--0:#9ECBFF;--1:#032F62">'Model.pkl'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 最终预测结果</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">preds </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> model.predict(r[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 反归一化或标准化，不过出bug了，不用</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># for cols in range(0, len(preds)):</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#     preds[cols] = scaler.inverse_transform(preds[cols])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># sns.lineplot(data=preds)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># plt.show()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 打印结果到控制台</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"未来7天预测"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(preds)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">all_ave_t </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> []</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">all_high_t </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> []</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">all_low_t </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> []</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> a </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">7</span><span style="--0:#E1E4E8;--1:#24292E">):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">today </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span><span style="--0:#E1E4E8;--1:#24292E">.datetime.now()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">time </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> (today </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">DT</span><span style="--0:#E1E4E8;--1:#24292E">.timedelta(</span><span style="--0:#FFAB70;--1:#AE4B07">days</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">a)).date()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(time.year, </span><span style="--0:#9ECBFF;--1:#032F62">'/'</span><span style="--0:#E1E4E8;--1:#24292E">, time.month, </span><span style="--0:#9ECBFF;--1:#032F62">'/'</span><span style="--0:#E1E4E8;--1:#24292E">, time.day,</span></div></div><div class="ec-line" style="--ecIndent:10ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">          </span><span style="--0:#9ECBFF;--1:#032F62">': 平均气温'</span><span style="--0:#E1E4E8;--1:#24292E">,  preds[a][</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">],</span></div></div><div class="ec-line" style="--ecIndent:10ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">          </span><span style="--0:#9ECBFF;--1:#032F62">'最高气温'</span><span style="--0:#E1E4E8;--1:#24292E">, preds[a][</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">],</span></div></div><div class="ec-line" style="--ecIndent:10ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">          </span><span style="--0:#9ECBFF;--1:#032F62">'最低气温'</span><span style="--0:#E1E4E8;--1:#24292E">, preds[a][</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">],</span></div></div><div class="ec-line" style="--ecIndent:10ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">          </span><span style="--0:#9ECBFF;--1:#032F62">"降雨量"</span><span style="--0:#E1E4E8;--1:#24292E">, preds[a][</span><span style="--0:#79B8FF;--1:#005CC5">3</span><span style="--0:#E1E4E8;--1:#24292E">],</span></div></div><div class="ec-line" style="--ecIndent:10ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">          </span><span style="--0:#9ECBFF;--1:#032F62">"风力"</span><span style="--0:#E1E4E8;--1:#24292E">, preds[a][</span><span style="--0:#79B8FF;--1:#005CC5">4</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">all_ave_t.append(preds[a][</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">all_high_t.append(preds[a][</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">all_low_t.append(preds[a][</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">temp </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> {</span><span style="--0:#9ECBFF;--1:#032F62">"ave_t"</span><span style="--0:#E1E4E8;--1:#24292E">: all_ave_t, </span><span style="--0:#9ECBFF;--1:#032F62">"high_t"</span><span style="--0:#E1E4E8;--1:#24292E">: all_high_t, </span><span style="--0:#9ECBFF;--1:#032F62">"low_t"</span><span style="--0:#E1E4E8;--1:#24292E">: all_low_t}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 绘画折线图</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">plt.plot(</span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">7</span><span style="--0:#E1E4E8;--1:#24292E">), temp[</span><span style="--0:#9ECBFF;--1:#032F62">"ave_t"</span><span style="--0:#E1E4E8;--1:#24292E">], </span><span style="--0:#FFAB70;--1:#AE4B07">color</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"green"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">label</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"ave_t"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">plt.plot(</span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">7</span><span style="--0:#E1E4E8;--1:#24292E">), temp[</span><span style="--0:#9ECBFF;--1:#032F62">"high_t"</span><span style="--0:#E1E4E8;--1:#24292E">], </span><span style="--0:#FFAB70;--1:#AE4B07">color</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"red"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">label</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"high_t"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">plt.plot(</span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">7</span><span style="--0:#E1E4E8;--1:#24292E">), temp[</span><span style="--0:#9ECBFF;--1:#032F62">"low_t"</span><span style="--0:#E1E4E8;--1:#24292E">], </span><span style="--0:#FFAB70;--1:#AE4B07">color</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"blue"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">label</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"low_t"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">plt.legend()  </span><span style="--0:#99A0A6;--1:#616972"># 显示图例</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">plt.ylabel(</span><span style="--0:#9ECBFF;--1:#032F62">"Temperature(°C)"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">plt.xlabel(</span><span style="--0:#9ECBFF;--1:#032F62">"day"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 显示</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">plt.show()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# -*- coding: utf-8 -*-# @Time: 2020/12/16# @Author: Eritque arcus# @File: Main.pyimport joblibimport datetime as DTfrom GetModel import GetModelimport matplotlib.pyplot as plt# 训练并保存模型并返回MAEr = GetModel()print(&#x22;MAE:&#x22;, r[0])# 读取保存的模型model = joblib.load(&#x27;Model.pkl&#x27;)# 最终预测结果preds = model.predict(r[1])# 反归一化或标准化，不过出bug了，不用# for cols in range(0, len(preds)):#     preds[cols] = scaler.inverse_transform(preds[cols])# sns.lineplot(data=preds)# plt.show()# 打印结果到控制台print(&#x22;未来7天预测&#x22;)print(preds)all_ave_t = []all_high_t = []all_low_t = []for a in range(1, 7):    today = DT.datetime.now()    time = (today + DT.timedelta(days=a)).date()    print(time.year, &#x27;/&#x27;, time.month, &#x27;/&#x27;, time.day,          &#x27;: 平均气温&#x27;,  preds[a][0],          &#x27;最高气温&#x27;, preds[a][1],          &#x27;最低气温&#x27;, preds[a][2],          &#x22;降雨量&#x22;, preds[a][3],          &#x22;风力&#x22;, preds[a][4])    all_ave_t.append(preds[a][0])    all_high_t.append(preds[a][1])    all_low_t.append(preds[a][2])temp = {&#x22;ave_t&#x22;: all_ave_t, &#x22;high_t&#x22;: all_high_t, &#x22;low_t&#x22;: all_low_t}# 绘画折线图plt.plot(range(1, 7), temp[&#x22;ave_t&#x22;], color=&#x22;green&#x22;, label=&#x22;ave_t&#x22;)plt.plot(range(1, 7), temp[&#x22;high_t&#x22;], color=&#x22;red&#x22;, label=&#x22;high_t&#x22;)plt.plot(range(1, 7), temp[&#x22;low_t&#x22;], color=&#x22;blue&#x22;, label=&#x22;low_t&#x22;)plt.legend()  # 显示图例plt.ylabel(&#x22;Temperature(°C)&#x22;)plt.xlabel(&#x22;day&#x22;)# 显示plt.show()"><div></div></button></div></figure></div>
<h3 id="82-使用方法"><a class="not-prose" href="#82-使用方法">8.2 使用方法</a></h3>
<p>直接用python运行pre_weather/Main.py，就会在控制台输出预测的数据</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:26ch"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">python</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">pre_weather/Main.py</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="python pre_weather/Main.py"><div></div></button></div></figure></div>
<p>或</p>
<p>在你的python代码里用joblib导入生成的模型，然后输入你的数据进行预测</p>
<p>(PS: 因为模型的训练用的数据日期和你预测数据的日期有关，所以不建议直接用使用非当天训练的模型进行预测，误差可能偏大)</p>
<p>如以下代码(在Main.py的11行):</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:32ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> joblib</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 读取保存的模型</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">model </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> joblib.load(</span><span style="--0:#9ECBFF;--1:#032F62">'Model.pkl'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 最终预测结果</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">preds </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> model.predict(r[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">其中，r[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">]是预测数据</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import joblib# 读取保存的模型model = joblib.load(&#x27;Model.pkl&#x27;)# 最终预测结果preds = model.predict(r[1])其中，r[1]是预测数据"><div></div></button></div></figure></div>
<p>或</p>
<p>参考<code>Main.py</code>，自己写一个符合你需求的启动文件</p>
<h2 id="9-最后效果"><a class="not-prose" href="#9-最后效果">9 最后效果</a></h2>
<img src="/images/%E7%94%A8python-sklearn-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E5%AE%9E%E7%8E%B0%E5%A4%A9%E6%B0%94%E9%A2%84%E6%8A%A5.md-6.png" alt="效果">
<blockquote>
<p>本系列教程到这就结束了，代码具体还要以<a href="https://github.com/Nambers/PYWeatherReport" rel="noreferrer noopener" target="_blank">github项目:PYWeatherReport
</a>为主，可能会在这个github项目上不定期优化更新</p>
</blockquote>
<center>-END-</center>   </div> </div> </article> <button class="hover:border-link fixed end-4 bottom-8 z-90 flex h-10 w-10 translate-y-28 cursor-pointer items-center justify-center rounded-full border-2 border-transparent bg-zinc-200 text-3xl opacity-0 transition-all transition-discrete duration-300 data-[show=true]:translate-y-0 data-[show=true]:opacity-100 sm:end-8 sm:h-12 sm:w-12 dark:bg-zinc-700" data-show="false" id="to-top-btn"> <span class="sr-only">Back to top</span> <svg aria-hidden="true" class="h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M4.5 15.75l7.5-7.5 7.5 7.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button>  </main> <footer class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pt-20 pb-4 text-center align-top font-semibold text-gray-600 sm:flex-row sm:justify-between sm:text-xs dark:text-gray-400"> <div class="me-0 text-neutral-400 sm:me-4">
&copy; <span class="text-accent">Eritque Arcus</span> 2020-2025.<br> <span>Powered by <a href="https://astro.build" class="hover:text-gray-700 dark:hover:text-gray-200">Astro</a> | <a href="https://github.com/chrismwilliams/astro-theme-cactus" class="hover:text-gray-700 dark:hover:text-gray-200">cactus</a></span><br> <a href="https://icp.gov.moe/?keyword=20222242" class="flex justify-center gap-1 text-xs hover:text-gray-700 dark:hover:text-gray-200"> <img src="/images/moe-icon120.png" class="h-4 w-4" alt="萌ICP备图标">
萌ICP备20222242号
</a> </div> <nav aria-labelledby="footer_links" class="flex flex-wrap gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500"> <p id="footer_links" class="sr-only">More on this site</p> <a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/archive/"> Archive </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/about/"> About </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/math-notes/"> Notes </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/ctf-cheatsheet/"> CTF-QuickRef </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/music/"> Music </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://photos.ikuyo.dev"> Photos </a> <a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://www.travellings.cn/go.html"> 开往 </a> </nav> <script defer src="https://4-um4m1.ikuyo.dev/script.js" data-website-id="34e0a647-a8e8-40a8-ad62-742e9d604413" data-domains="ikuyo.dev"></script> <script type="text/javascript">
		(() => {
			const name = "outbound-link-click";
			document.querySelectorAll("a").forEach((a) => {
				if (a.host !== window.location.host && !a.getAttribute("data-umami-event")) {
					a.setAttribute("data-umami-event", name);
					a.setAttribute("data-umami-event-url", a.href);
				}
			});
		})();
	</script> </footer> </body></html> <script type="module">const e=document.getElementById("to-top-btn"),n=document.getElementById("blog-hero");function c(t){t.forEach(o=>{e.dataset.show=(!o.isIntersecting).toString()})}e.addEventListener("click",()=>{document.documentElement.scrollTo({behavior:"smooth",top:0})});const r=new IntersectionObserver(c);r.observe(n);</script>