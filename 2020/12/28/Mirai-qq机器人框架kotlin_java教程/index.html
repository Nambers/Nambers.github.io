<!DOCTYPE html><html class="scroll-smooth" lang="zh-CN"> <head><meta charset="utf-8"><meta content="width=device-width, initial-scale=1.0" name="viewport"><title>用kotlin/java构建一个Mirai插件 • Eritque Arcus</title><link rel="icon" href="/favicon.png" type="image/png"><link href="/manifest.webmanifest" rel="manifest"><link href="https://ikuyo.dev/2020/12/28/Mirai-qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A1%86%E6%9E%B6kotlin_java%E6%95%99%E7%A8%8B/" rel="canonical"><meta content="用kotlin/java构建一个Mirai插件 • Eritque Arcus" name="title"><meta content="## 前言构建mirai的mirai-console插件教程用到的概念有`mcl` - 指mirai-console-" name="description"><meta content="Eritque Arcus" name="author"><meta content="article" property="og:type"><meta content="用kotlin/java构建一个Mirai插件" property="og:title"><meta content="## 前言构建mirai的mirai-console插件教程用到的概念有`mcl` - 指mirai-console-" property="og:description"><meta content="https://ikuyo.dev/2020/12/28/Mirai-qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A1%86%E6%9E%B6kotlin_java%E6%95%99%E7%A8%8B/" property="og:url"><meta content="Eritque Arcus" property="og:site_name"><meta content="zh_CN" property="og:locale"><meta content="1200" property="og:image:width"><meta content="630" property="og:image:height"><meta content="Eritque Arcus" property="article:author"><meta content="2020-12-28T17:35:14.000Z" property="article:published_time"><meta content="summary_large_image" property="twitter:card"><meta content="https://ikuyo.dev/2020/12/28/Mirai-qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A1%86%E6%9E%B6kotlin_java%E6%95%99%E7%A8%8B/" property="twitter:url"><meta content="用kotlin/java构建一个Mirai插件" property="twitter:title"><meta content="## 前言构建mirai的mirai-console插件教程用到的概念有`mcl` - 指mirai-console-" property="twitter:description"><link href="/sitemap-index.xml" rel="sitemap"><link href="/rss.xml" title="Blog" rel="alternate" type="application/rss+xml"><link href="/notes/rss.xml" title="Notes" rel="alternate" type="application/rss+xml"><link href="https://webmention.io/ikuyo.dev/webmention" rel="webmention"><meta content="Astro v5.6.2" name="generator"><link href="https://github.com/Nambers" rel="me"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="anonymous" data-unfont><link rel="preload" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?family=Major Mono Display&family=Space Grotesk&family=Noto Sans SC&family=LXGW WenKai Mono TC&display=swap" data-unfont><style>@font-face{font-family:Iosevka Etoile;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/iosevka-etoile-latin-400-normal.CbciBTy_.woff2) format("woff2"),url(/_astro/iosevka-etoile-latin-400-normal.BsCJFtHE.woff) format("woff")}
</style>
<link rel="stylesheet" href="/_astro/_page_.CUlGpJG1.css"><script type="module" src="/_astro/page.V2R8AmkL.js"></script></head> <body class="bg-global-bg text-global-text mx-auto flex min-h-screen max-w-7xl flex-col px-4 pt-16 text-sm font-normal antialiased sm:px-8"> <script>
	const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

	function getUserPref() {
		const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		return storedTheme || (lightModePref.matches ? "light" : "dark");
	}

	function setTheme(newTheme) {
		if (newTheme !== "light" && newTheme !== "dark") {
			return console.warn(
				`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
			);
		}

		const root = document.documentElement;

		// root already set to newTheme, exit early
		if (newTheme === root.getAttribute("data-theme")) {
			return;
		}

		root.setAttribute("data-theme", newTheme);

		if (typeof localStorage !== "undefined") {
			localStorage.setItem("theme", newTheme);
		}
	}

	// initial setup
	setTheme(getUserPref());

	// View Transitions hook to restore theme
	document.addEventListener("astro:after-swap", () => setTheme(getUserPref()));

	// listen for theme-change custom event, fired in src/components/ThemeToggle.astro
	document.addEventListener("theme-change", (e) => {
		setTheme(e.detail.theme);
	});

	// listen for prefers-color-scheme change.
	lightModePref.addEventListener("change", (e) => setTheme(e.matches ? "light" : "dark"));
</script> <a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">skip to content
</a> <header class="group relative mb-28 flex w-full items-center sm:ps-20" id="main-header"> <div class="flex w-full sm:flex-col"> <div class="flex w-full items-center sm:relative sm:inline-block"> <a aria-current="false" class="inline-flex items-center sm:relative sm:inline-block" href="/"> <img src="/avatar.png" alt="Avatar" class="me-3 h-16 w-16 rounded-full sm:absolute sm:-start-18 sm:me-0 sm:h-16 sm:w-16"> <span class="font-display text-accent ps-3 text-4xl font-bold tracking-wide whitespace-nowrap dark:drop-shadow-[0_0_2px_white] dark:drop-shadow-[0_0_4px_cyan] dark:drop-shadow-[0_0_8px_cyan] dark:drop-shadow-[0_0_16px_rgba(0,255,255,0.5)]"> Eritque Arcus </span> </a> </div> <nav aria-label="Main menu" class="bg-global-bg/85 absolute -inset-x-4 top-14 hidden w-full flex-col items-end gap-y-4 rounded-md py-4 shadow backdrop-blur-sm group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:rounded-none sm:bg-transparent sm:py-0 sm:ps-4 sm:shadow-none sm:backdrop-blur-none" id="navigation-menu"> <div class="text-accent sm:divide-accent sm:divide-x"> <a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/archive/"> Archive </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/about/"> About </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/math-notes/"> Notes </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/friends/"> Friends </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/ctf-cheatsheet/"> CTF-QuickRef </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/music/"> Music </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="https://photos.ikuyo.dev"> Photos </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="https://www.travellings.cn/go.html"> 开往 </a> </div> <div class="flex sm:ps-28"> <site-search class="ms-auto" id="search"> <button class="hover:text-accent flex h-9 w-9 cursor-pointer items-center justify-center rounded-md" aria-keyshortcuts="Control+K Meta+K" data-open-modal disabled> <svg aria-hidden="true" class="h-7 w-7" fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" stroke="none"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <span class="sr-only">Open Search</span> </button> <dialog aria-label="search" class="bg-global-bg h-full max-h-full w-full max-w-full border border-zinc-400 shadow-sm backdrop:backdrop-blur-sm open:flex sm:mx-auto sm:mt-16 sm:mb-auto sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md"> <div class="dialog-frame flex grow flex-col gap-4 p-6 pt-12 sm:pt-6"> <button class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700" data-close-modal>Close</button> <div class="search-container"> <div id="cactus__search"></div> </div> </div> </dialog> </site-search> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.fEYUxNp8.js"></script> <theme-toggle class="ms-2 sm:ms-4"> <button class="hover:text-accent relative h-9 w-9 cursor-pointer rounded-md p-2" type="button"> <span class="sr-only">Dark Theme</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0" fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100" fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path> <path d="M19 11h2m-1 -1v2"></path> </svg> </button> </theme-toggle> <script type="module" src="/_astro/ThemeToggle.astro_astro_type_script_index_0_lang.C1tldoqx.js"></script> </div> </nav> </div> <mobile-button class="mb-15"> <button aria-expanded="false" aria-haspopup="menu" class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button"> <span class="sr-only">Open main menu</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0" fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="text-accent absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100" class="text-accent" fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button> </mobile-button> </header> <script type="module" src="/_astro/Header.astro_astro_type_script_index_0_lang.DuSsDY4R.js"></script> <main id="main">  <article class="grow break-words" data-pagefind-body> <div id="blog-hero" class="mb-12"><h1 class="title"> 用kotlin/java构建一个Mirai插件 </h1> <div class="flex flex-wrap items-center gap-x-3 gap-y-2"> <p class="font-semibold"> <time datetime="2020-12-28T17:35:14.000Z" title="2020-12-28T17:35:14.000Z">28 December 2020</time> /  11 min read </p>  </div> <div class="mt-2"> <svg aria-hidden="true" class="inline-block h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:kotlin" href="/tags/kotlin/"><span class="sr-only">View more blogs with the tag&nbsp;</span>kotlin </a>,  </span> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:java" href="/tags/java/"><span class="sr-only">View more blogs with the tag&nbsp;</span>java </a> </span>  </div></div> <div class="grid grid-cols-[1fr_auto] gap-10 lg:flex-row lg:items-start"> <details open class="lg:sticky lg:top-12 lg:order-2 lg:-me-32 lg:basis-64"> <summary class="title hover:marker:text-accent cursor-pointer text-lg">Table of Contents</summary> <nav class="ms-4 lg:w-full"> <ol class="mt-4"> <li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#前言"><span aria-hidden="true" class="me-0.5">#</span>前言</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#资料列表"><span aria-hidden="true" class="me-0.5">#</span>资料列表</a>  </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#可能遇到的问题"><span aria-hidden="true" class="me-0.5">#</span>可能遇到的问题</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#1准备"><span aria-hidden="true" class="me-0.5">#</span>1.准备</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#i-配置java环境"><span aria-hidden="true" class="me-0.5">#</span>i. 配置java环境</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#ii-配置ide"><span aria-hidden="true" class="me-0.5">#</span>ii. 配置IDE</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#iii-下载mirai-console-loadermcl作为启动器"><span aria-hidden="true" class="me-0.5">#</span>iii. 下载mirai-console-loader(mcl)作为启动器</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#其他启动器"><span aria-hidden="true" class="me-0.5">#</span>其他启动器</a>  </li> </ol> </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#2创建mirai-console插件项目"><span aria-hidden="true" class="me-0.5">#</span>2.创建mirai-console插件项目</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#i-下载"><span aria-hidden="true" class="me-0.5">#</span>i. 下载</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#ii-个性化项目"><span aria-hidden="true" class="me-0.5">#</span>ii. 个性化项目</a>  </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#3-文件夹结构解析"><span aria-hidden="true" class="me-0.5">#</span>3. 文件夹结构解析</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#4kotlin插件代码解析"><span aria-hidden="true" class="me-0.5">#</span>4.kotlin插件代码解析</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#i所有在以下代码中要引入的库"><span aria-hidden="true" class="me-0.5">#</span>i.所有在以下代码中要引入的库</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#ii构建主类"><span aria-hidden="true" class="me-0.5">#</span>ii.构建主类</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#iii覆盖插件启用函数"><span aria-hidden="true" class="me-0.5">#</span>iii.覆盖插件启用函数</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#iv监听事件"><span aria-hidden="true" class="me-0.5">#</span>iv.监听事件</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#v-全部代码"><span aria-hidden="true" class="me-0.5">#</span>v. 全部代码</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#vi-gradle部分代码"><span aria-hidden="true" class="me-0.5">#</span>vi. gradle部分代码</a>  </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#5-java插件代码解析"><span aria-hidden="true" class="me-0.5">#</span>5. Java插件代码解析</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#i-在下面代码中要引入的库"><span aria-hidden="true" class="me-0.5">#</span>i. 在下面代码中要引入的库</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#ii-构建主类"><span aria-hidden="true" class="me-0.5">#</span>ii. 构建主类</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#iii-覆盖插件启用函数"><span aria-hidden="true" class="me-0.5">#</span>iii. 覆盖插件启用函数</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#iv-监听事件"><span aria-hidden="true" class="me-0.5">#</span>iv. 监听事件</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#v-全部代码-1"><span aria-hidden="true" class="me-0.5">#</span>v. 全部代码</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#vi-gradle-部分代码"><span aria-hidden="true" class="me-0.5">#</span>vi. gradle 部分代码</a>  </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#6-在ide内运行"><span aria-hidden="true" class="me-0.5">#</span>6. 在IDE内运行</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#i-更改mirairunkt配置"><span aria-hidden="true" class="me-0.5">#</span>i. 更改MiraiRunKt配置</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#ii运行mirairunkt任务"><span aria-hidden="true" class="me-0.5">#</span>ii.运行MiraiRunKt任务</a>  </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#7-生成插件并运行"><span aria-hidden="true" class="me-0.5">#</span>7. 生成插件并运行</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#i-生成插件"><span aria-hidden="true" class="me-0.5">#</span>i. 生成插件</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#ii在mcl中运行"><span aria-hidden="true" class="me-0.5">#</span>ii.在mcl中运行</a>  </li> </ol> </li> </ol> </nav> </details> <div class="prose max-w-none prose-sm prose-headings:font-semibold prose-headings:text-accent-2 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-gray-600 prose-headings:hover:before:text-accent sm:prose-headings:before:content-['#'] sm:prose-th:before:content-none">  <h2 id="前言"><a class="not-prose" href="#前言">前言</a></h2>
<p>构建mirai的mirai-console插件教程
用到的概念有
<code>mcl</code> - 指mirai-console-loader，mirai-console官方启动器
<code>mirai</code> - mirai 是一个在全平台下运行，提供 QQ Android 协议支持的高效率机器人库，根据<code>AGPLv3</code>开源</p>
<h3 id="资料列表"><a class="not-prose" href="#资料列表">资料列表</a></h3>
<p>以下为一些官方资料
<a href="https://github.com/mamoe/mirai" rel="noreferrer noopener" target="_blank">mirai官方github库</a>
<a href="https://github.com/mamoe/mirai-console" rel="noreferrer noopener" target="_blank">mirai-console官方github库</a>
<a href="https://github.com/iTXTech/mirai-console-loader" rel="noreferrer noopener" target="_blank">mirai-console-loader(mcl)官方启动器官方github库</a>
这三者的关系可以参考<a href="https://github.com/mamoe/mirai/blob/dev/docs/mirai-ecology.md" rel="noreferrer noopener" target="_blank">这里</a>
<a href="https://github.com/project-mirai/mirai-hello-world" rel="noreferrer noopener" target="_blank">官方实例</a>
<a href="https://mirai.mamoe.net/" rel="noreferrer noopener" target="_blank">mirai官方论坛</a>
<a href="https://github.com/project-mirai/mirai-console-plugin-template" rel="noreferrer noopener" target="_blank">官方demo</a>
<a href="https://docs.mamoe.net/" rel="noreferrer noopener" target="_blank">mirai在线api文档</a></p>
<p>另，以下是一些资源:
<a href="https://github.com/Nambers/mirai_plugin_example" rel="noreferrer noopener" target="_blank">笔者整理的mirai-console插件实例包含kt和java)</a></p>
<h2 id="可能遇到的问题"><a class="not-prose" href="#可能遇到的问题">可能遇到的问题</a></h2>
<ul>
<li>MiraiOK已经没用了，用mcl(网址在上面)</li>
<li>最好用openjdk不过甲骨文的jdk好像也可以(建议用openjdk, 解释在下面)</li>
<li>根据<a href="https://github.com/mamoe/mirai/issues/959" rel="noreferrer noopener" target="_blank">issue#959</a>目前邀请机器人进200+人的群都不会触发事件</li>
<li>插件id必须为类包格式(xxx.xxx.xxx)</li>
<li>有的时候收不到机器人的信息是因为被tx风控了换号或多发几次以及多挂(可以去论坛看看)</li>
<li>建议看一遍官方文档虽然有点乱</li>
<li>如果遇到问题，可以去<a href="https://mirai.mamoe.net/" rel="noreferrer noopener" target="_blank">mirai论坛</a>上问</li>
<li>如果要在mcl内改登录协议，在login命令后加参数或在config/console/autologin.yml里面设置自动登录命令和登录的协议</li>
<li>mcl登录报错<code>环境异常</code>，参考<a href="https://mirai.mamoe.net/topic/223/%E6%97%A0%E6%B3%95%E7%99%BB%E5%BD%95%E7%9A%84%E4%B8%B4%E6%97%B6%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88" rel="noreferrer noopener" target="_blank">论坛解决方案</a></li>
<li>改了入口点包路径需要到<code>resources\META-INF\services\net.mamoe.mirai.console.plugin.jvm.JvmPlugin</code>改成对应的类包路径</li>
</ul>
<h2 id="1准备"><a class="not-prose" href="#1准备">1.准备</a></h2>
<h3 id="i-配置java环境"><a class="not-prose" href="#i-配置java环境">i. 配置java环境</a></h3>
<p>下载mcl所需要的是>=11版本的openjdk，<a href="http://jdk.java.net/archive/" rel="noreferrer noopener" target="_blank">openjdk下载地址</a>，下载教程参考搜索引擎</p>
<blockquote>
<p>最好用openjdk而不是甲骨文(Oracle)的jdk，<a href="https://github.com/mamoe/mirai/discussions/779" rel="noreferrer noopener" target="_blank">原因</a></p>
</blockquote>
<h3 id="ii-配置ide"><a class="not-prose" href="#ii-配置ide">ii. 配置IDE</a></h3>
<p>推荐IDEA吧，其他的也可以，主要是IDEA挺好用的
可以选择安装的官方插件:
<a href="https://plugins.jetbrains.com/plugin/15094-mirai-console" rel="noreferrer noopener" target="_blank">Mirai Console IntelliJ 提供错误检查等功能</a>
<a href="https://plugins.jetbrains.com/plugin/14816-kotlin-jvm-blocking-bridge" rel="noreferrer noopener" target="_blank">Kotlin Jvm Blocking Bridge 帮助 Java 用户调用 Kotlin suspend 函数</a>
详细参考<a href="https://github.com/mamoe/mirai-console/blob/master/docs/Preparations.md" rel="noreferrer noopener" target="_blank">官方文档</a></p>
<h3 id="iii-下载mirai-console-loadermcl作为启动器"><a class="not-prose" href="#iii-下载mirai-console-loadermcl作为启动器">iii. 下载mirai-console-loader(mcl)作为启动器</a></h3>
<p><a href="https://github.com/iTXTech/mirai-console-loader" rel="noreferrer noopener" target="_blank">官方地址</a>
教程同见官方说明</p>
<h4 id="其他启动器"><a class="not-prose" href="#其他启动器">其他启动器</a></h4>
<p>目前也出了其他启动器，查看<a href="https://github.com/mamoe/mirai-console/blob/master/docs/ConfiguringProjects.md#%E6%A8%A1%E5%9D%97%E8%AF%B4%E6%98%8E" rel="noreferrer noopener" target="_blank">这里</a></p>
<h2 id="2创建mirai-console插件项目"><a class="not-prose" href="#2创建mirai-console插件项目">2.创建mirai-console插件项目</a></h2>
<h3 id="i-下载"><a class="not-prose" href="#i-下载">i. 下载</a></h3>
<ol>
<li>从<a href="https://github.com/project-mirai/mirai-hello-world" rel="noreferrer noopener" target="_blank">官方实例</a>或<a href="https://github.com/Nambers/mirai_plugin_example" rel="noreferrer noopener" target="_blank">笔者整理的mirai-console插件实例</a>中下载最新版的框架到本地，然后用IDE打开文件夹</li>
<li>使用插件生成，详细查看<a href="https://github.com/mamoe/mirai/blob/dev/docs/Preparations.md#%E5%AE%89%E8%A3%85-ide-%E6%8F%92%E4%BB%B6" rel="noreferrer noopener" target="_blank">官网</a></li>
</ol>
<h3 id="ii-个性化项目"><a class="not-prose" href="#ii-个性化项目">ii. 个性化项目</a></h3>
<ul>
<li>在<code>settings.gradle.kts</code>里改生成的插件.jar名称也就是项目名称, 或者在build.gradle.kts里面获取shadowjar任务改如:</li>
</ul>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.fpf9q.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="kotlin" class="wrap" style="--ecMaxLine:83ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">tasks</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">afterEvaluate</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">named</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">net</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">mamoe</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">mirai</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">console</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">gradle</span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">BuildMiraiPluginTask</span><span style="--0:#E1E4E8;--1:#24292E">>(</span><span style="--0:#9ECBFF;--1:#032F62">"buildPlugin"</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">archiveBaseName.</span><span style="--0:#B392F0;--1:#6F42C1">set</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"name"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">archiveClassifier.</span><span style="--0:#B392F0;--1:#6F42C1">set</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">archiveVersion.</span><span style="--0:#B392F0;--1:#6F42C1">set</span><span style="--0:#E1E4E8;--1:#24292E">(version)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tasks {    afterEvaluate {        named<net.mamoe.mirai.console.gradle.BuildMiraiPluginTask>(&#x22;buildPlugin&#x22;) {            archiveBaseName.set(&#x22;name&#x22;)            archiveClassifier.set(&#x22;&#x22;)            archiveVersion.set(version)        }    }}"><div></div></button></div></figure></div>
<ul>
<li>用<code>RunMiraikt</code>这个文件(在test文件夹下)可以在ide里运行，不用复制到mcl或其他启动器</li>
<li>用<code>buildPlugin</code>这个gradle任务可以生成.jar插件</li>
<li>在<code>src/main/kotlin/PluginMain</code>主类内可以修改插件信息(mcl用)</li>
<li>最好修改<code>PluginMain.kt</code>或<code>JavaPluginMain.java</code>的包名避免插件载入冲突,然后在<code>resources\META-INF\services\net.mamoe.mirai.console.plugin.jvm.JvmPlugin</code>中更改类包名到你改后的名，路径见下面</li>
</ul>
<h2 id="3-文件夹结构解析"><a class="not-prose" href="#3-文件夹结构解析">3. 文件夹结构解析</a></h2>
<p>插件实例代码文件结构</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="plain" class="wrap" style="--ecMaxLine:66ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#e1e4e8;--1:#24292e">│  build.gradle.kts gradle依赖列表</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#e1e4e8;--1:#24292e">│  settings.gradle.kts gradle设置</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#e1e4e8;--1:#24292e">│</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#e1e4e8;--1:#24292e">├─.run</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#e1e4e8;--1:#24292e">│      RunMiraiKt.run.xml IDE中运行任务配置，即RunMiraiKt源文件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#e1e4e8;--1:#24292e">│</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#e1e4e8;--1:#24292e">├─run RunMiraiKt默认运行目录</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#e1e4e8;--1:#24292e">│</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#e1e4e8;--1:#24292e">└─src</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">├─main</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">│  ├─kotlin</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">│  │      PluginMain.kt  kotlin插件主类</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">│  ├─Java</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">│  │      JavaPluginMain.java java插件主类</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">  </span></span><span style="--0:#e1e4e8;--1:#24292e">│  │</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">  </span></span><span style="--0:#e1e4e8;--1:#24292e">│  ├─resources\META-INF\services</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">  </span></span><span style="--0:#e1e4e8;--1:#24292e">│  │     net.mamoe.mirai.console.plugin.jvm.JvmPlugin Mirai加载的主类</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">    </span></span><span style="--0:#e1e4e8;--1:#24292e">└─test</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">        </span></span><span style="--0:#e1e4e8;--1:#24292e">└─kotlin</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#e1e4e8;--1:#24292e">                </span></span><span style="--0:#e1e4e8;--1:#24292e">RunMirai.kt RunMiraiKt任务配置</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="│  build.gradle.kts gradle依赖列表│  settings.gradle.kts gradle设置│├─.run│      RunMiraiKt.run.xml IDE中运行任务配置，即RunMiraiKt源文件│├─run RunMiraiKt默认运行目录│└─src    ├─main    │  ├─kotlin    │  │      PluginMain.kt  kotlin插件主类    │  ├─Java    │  │      JavaPluginMain.java java插件主类  │  │  │  ├─resources\META-INF\services  │  │     net.mamoe.mirai.console.plugin.jvm.JvmPlugin Mirai加载的主类    └─test        └─kotlin                RunMirai.kt RunMiraiKt任务配置"><div></div></button></div></figure></div>
<h2 id="4kotlin插件代码解析"><a class="not-prose" href="#4kotlin插件代码解析">4.kotlin插件代码解析</a></h2>
<p><strong>代码以github上的代码为准，可能会有更新</strong></p>
<h3 id="i所有在以下代码中要引入的库"><a class="not-prose" href="#i所有在以下代码中要引入的库">i.所有在以下代码中要引入的库</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="kotlin" class="wrap" style="--ecMaxLine:67ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//插件信息</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.console.plugin.jvm.JvmPluginDescription</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//主类继承</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.console.plugin.jvm.KotlinPlugin</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//机器人被拉进群的事件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.events.BotInvitedJoinGroupRequestEvent</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//收到好友信息事件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.events.FriendMessageEvent</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//收到群消息事件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.events.GroupMessageEvent</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//新好友申请事件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.events.NewFriendRequestEvent</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//日志组件(logger)发控制台信息函数</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.utils.info</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//消息(messageChain)中的图片类型</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.message.data.Image</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//消息(messageChain)中的纯文本类型</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.message.data.PlainText</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//监听器</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.Listener</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//监听范围</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.globalEventChannel</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//协程范围?</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">kotlin.coroutines.EmptyCoroutineContext</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="//插件信息import net.mamoe.mirai.console.plugin.jvm.JvmPluginDescription//主类继承import net.mamoe.mirai.console.plugin.jvm.KotlinPlugin//机器人被拉进群的事件import net.mamoe.mirai.event.events.BotInvitedJoinGroupRequestEvent//收到好友信息事件import net.mamoe.mirai.event.events.FriendMessageEvent//收到群消息事件import net.mamoe.mirai.event.events.GroupMessageEvent//新好友申请事件import net.mamoe.mirai.event.events.NewFriendRequestEvent//日志组件(logger)发控制台信息函数import net.mamoe.mirai.utils.info//消息(messageChain)中的图片类型import net.mamoe.mirai.message.data.Image//消息(messageChain)中的纯文本类型import net.mamoe.mirai.message.data.PlainText//监听器import net.mamoe.mirai.event.Listener//监听范围import net.mamoe.mirai.event.globalEventChannel//协程范围?import kotlin.coroutines.EmptyCoroutineContext"><div></div></button></div></figure></div>
<p>监听和事件参考<a href="https://github.com/mamoe/mirai/blob/dev/docs/Events.md" rel="noreferrer noopener" target="_blank">官方文档</a></p>
<h3 id="ii构建主类"><a class="not-prose" href="#ii构建主类">ii.构建主类</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="kotlin" class="wrap" style="--ecMaxLine:41ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">object</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">PluginMain</span><span style="--0:#E1E4E8;--1:#24292E"> : </span><span style="--0:#B392F0;--1:#6F42C1">KotlinPlugin</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">JvmPluginDescription</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">id </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"org.example.mirai-example"</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">version </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"0.1.0"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="object PluginMain : KotlinPlugin(    JvmPluginDescription(        id = &#x22;org.example.mirai-example&#x22;,        version = &#x22;0.1.0&#x22;    )) {}"><div></div></button></div></figure></div>
<p>其中，<code>kotlinPlugin</code>指继承plugin父类，<code>JvmPluginDescription</code>指声明插件消息和版本</p>
<h3 id="iii覆盖插件启用函数"><a class="not-prose" href="#iii覆盖插件启用函数">iii.覆盖插件启用函数</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="kotlin" class="wrap" style="--ecMaxLine:33ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">override</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">fun</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">onEnable</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">//或logger.info("xxx")作用一样</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">logger.</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E"> { </span><span style="--0:#9ECBFF;--1:#032F62">"Plugin loaded"</span><span style="--0:#E1E4E8;--1:#24292E"> }</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="override fun onEnable() {    //或logger.info(&#x22;xxx&#x22;)作用一样  logger.info { &#x22;Plugin loaded&#x22; }}"><div></div></button></div></figure></div>
<p>用kotlin关键字<code>override</code>实现插件启用函数，然后用<code>logger.info()</code>进行日志输出，其中<code>logger</code>是<code>kotlinPlugin</code>类内成员，除了<code>.info()</code>还有<code>.warning()</code>输出警告和<code>.error()</code>输出报错</p>
<h3 id="iv监听事件"><a class="not-prose" href="#iv监听事件">iv.监听事件</a></h3>
<p>用<code> subscribeAlways&#x3C;>{}</code>这个函数在<code>onEnable</code>函数中开启监听(还可以<code>subscribe</code>或<code>subscribeOnce</code>见mirai文档)</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="kotlin" class="wrap" style="--ecMaxLine:78ch"><code><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">globalEventChannel</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">GroupMessageEvent</span><span style="--0:#E1E4E8;--1:#24292E">>{</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//群消息</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (message.</span><span style="--0:#B392F0;--1:#6F42C1">contentToString</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">startsWith</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"复读"</span><span style="--0:#E1E4E8;--1:#24292E">)) {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">group.</span><span style="--0:#B392F0;--1:#6F42C1">sendMessage</span><span style="--0:#E1E4E8;--1:#24292E">(message.</span><span style="--0:#B392F0;--1:#6F42C1">contentToString</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">replace</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"复读"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">))</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (message.</span><span style="--0:#B392F0;--1:#6F42C1">contentToString</span><span style="--0:#E1E4E8;--1:#24292E">() </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"hi"</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">group.</span><span style="--0:#B392F0;--1:#6F42C1">sendMessage</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"hi"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">message.</span><span style="--0:#B392F0;--1:#6F42C1">forEach</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">                </span><span style="--0:#99A0A6;--1:#616972">//循环每个元素在消息里</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (it </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> Image) {</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">                    </span><span style="--0:#99A0A6;--1:#616972">//如果消息这一部分是图片</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (it </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> PlainText) {</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">                    </span><span style="--0:#99A0A6;--1:#616972">//如果消息这一部分是纯文本</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">globalEventChannel</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">FriendMessageEvent</span><span style="--0:#E1E4E8;--1:#24292E">>{</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//好友信息</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">globalEventChannel</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">NewFriendRequestEvent</span><span style="--0:#E1E4E8;--1:#24292E">>{</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//自动同意好友申请</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">            </span><span style="--0:#B392F0;--1:#6F42C1">accept</span><span style="--0:#E1E4E8;--1:#24292E">()</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">globalEventChannel</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">BotInvitedJoinGroupRequestEvent</span><span style="--0:#E1E4E8;--1:#24292E">>{</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//自动同意加群申请</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">            </span><span style="--0:#B392F0;--1:#6F42C1">accept</span><span style="--0:#E1E4E8;--1:#24292E">()</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    globalEventChannel().subscribeAlways<GroupMessageEvent>{            //群消息            if (message.contentToString().startsWith(&#x22;复读&#x22;)) {                group.sendMessage(message.contentToString().replace(&#x22;复读&#x22;, &#x22;&#x22;))            }            if (message.contentToString() == &#x22;hi&#x22;) {                group.sendMessage(&#x22;hi&#x22;)            }            message.forEach {                //循环每个元素在消息里                if (it is Image) {                    //如果消息这一部分是图片                }                if (it is PlainText) {                    //如果消息这一部分是纯文本                }            }        }        globalEventChannel().subscribeAlways<FriendMessageEvent>{            //好友信息        }        globalEventChannel().subscribeAlways<NewFriendRequestEvent>{            //自动同意好友申请            accept()        }        globalEventChannel().subscribeAlways<BotInvitedJoinGroupRequestEvent>{            //自动同意加群申请            accept()        }"><div></div></button></div></figure></div>
<h3 id="v-全部代码"><a class="not-prose" href="#v-全部代码">v. 全部代码</a></h3>
<p>这些代码是<a href="https://github.com/Nambers/mirai_kotlin_example" rel="noreferrer noopener" target="_blank">笔者整理的mirai-console插件kotlin版实例</a>中的内容</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="kotlin" class="wrap" style="--ecMaxLine:81ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">package</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">org.example.mirai.plugin</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.console.plugin.jvm.JvmPluginDescription</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.console.plugin.jvm.KotlinPlugin</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.Listener</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.events.BotInvitedJoinGroupRequestEvent</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.events.FriendMessageEvent</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.events.GroupMessageEvent</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.events.NewFriendRequestEvent</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.event.globalEventChannel</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.message.code.MiraiCode</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.utils.info</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.message.data.Image</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.message.data.Image.Key.queryUrl</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">net.mamoe.mirai.message.data.PlainText</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">/*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">使用kotlin版请把</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">src/main/resources/META-INF.services/net.mamoe.mirai.console.plugin.jvm.JvmPlugin</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">文件内容改成"org.example.mirai.plugin.PluginMain"也就是当前主类</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">使用kt可以把java文件夹删除不会对项目有影响</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">在settings.gradle.kts里改生成的插件.jar名称</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">build.gradle.kts里改依赖库和插件版本</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">在主类下的JvmPluginDescription改插件名称，id和版本</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">用runmiraikt这个配置可以在ide里运行，不用复制到mcl或其他启动器</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#99A0A6;--1:#616972"> </span></span><span style="--0:#99A0A6;--1:#616972">*/</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">object</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">PluginMain</span><span style="--0:#E1E4E8;--1:#24292E"> : </span><span style="--0:#B392F0;--1:#6F42C1">KotlinPlugin</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">JvmPluginDescription</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">id </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"org.example.mirai-example"</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">name </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"插件示例"</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">version </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"0.1.0"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">override</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">fun</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">onEnable</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">logger.</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E"> { </span><span style="--0:#9ECBFF;--1:#032F62">"Plugin loaded"</span><span style="--0:#E1E4E8;--1:#24292E"> }</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972">//配置文件目录 "${dataFolder.absolutePath}/"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">globalEventChannel</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">GroupMessageEvent</span><span style="--0:#E1E4E8;--1:#24292E">>{</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//群消息</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">group.</span><span style="--0:#B392F0;--1:#6F42C1">sendMessage</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">\u</span><span style="--0:#9ECBFF;--1:#032F62">D83D</span><span style="--0:#79B8FF;--1:#005CC5">\u</span><span style="--0:#9ECBFF;--1:#032F62">DE03"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">globalEventChannel</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">FriendMessageEvent</span><span style="--0:#E1E4E8;--1:#24292E">>{</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//好友信息</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">sender.</span><span style="--0:#B392F0;--1:#6F42C1">sendMessage</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"hi"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">globalEventChannel</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">NewFriendRequestEvent</span><span style="--0:#E1E4E8;--1:#24292E">>{</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//自动同意好友申请</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">            </span><span style="--0:#B392F0;--1:#6F42C1">accept</span><span style="--0:#E1E4E8;--1:#24292E">()</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">globalEventChannel</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">BotInvitedJoinGroupRequestEvent</span><span style="--0:#E1E4E8;--1:#24292E">>{</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//自动同意加群申请</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">            </span><span style="--0:#B392F0;--1:#6F42C1">accept</span><span style="--0:#E1E4E8;--1:#24292E">()</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="package org.example.mirai.pluginimport net.mamoe.mirai.console.plugin.jvm.JvmPluginDescriptionimport net.mamoe.mirai.console.plugin.jvm.KotlinPluginimport net.mamoe.mirai.event.Listenerimport net.mamoe.mirai.event.events.BotInvitedJoinGroupRequestEventimport net.mamoe.mirai.event.events.FriendMessageEventimport net.mamoe.mirai.event.events.GroupMessageEventimport net.mamoe.mirai.event.events.NewFriendRequestEventimport net.mamoe.mirai.event.globalEventChannelimport net.mamoe.mirai.message.code.MiraiCodeimport net.mamoe.mirai.utils.infoimport net.mamoe.mirai.message.data.Imageimport net.mamoe.mirai.message.data.Image.Key.queryUrlimport net.mamoe.mirai.message.data.PlainText/*使用kotlin版请把src/main/resources/META-INF.services/net.mamoe.mirai.console.plugin.jvm.JvmPlugin文件内容改成&#x22;org.example.mirai.plugin.PluginMain&#x22;也就是当前主类使用kt可以把java文件夹删除不会对项目有影响在settings.gradle.kts里改生成的插件.jar名称build.gradle.kts里改依赖库和插件版本在主类下的JvmPluginDescription改插件名称，id和版本用runmiraikt这个配置可以在ide里运行，不用复制到mcl或其他启动器 */object PluginMain : KotlinPlugin(    JvmPluginDescription(        id = &#x22;org.example.mirai-example&#x22;,        name = &#x22;插件示例&#x22;,        version = &#x22;0.1.0&#x22;    )) {    override fun onEnable() {        logger.info { &#x22;Plugin loaded&#x22; }        //配置文件目录 &#x22;${dataFolder.absolutePath}/&#x22;        globalEventChannel().subscribeAlways<GroupMessageEvent>{            //群消息            group.sendMessage(&#x22;\uD83D\uDE03&#x22;)        }        globalEventChannel().subscribeAlways<FriendMessageEvent>{            //好友信息            sender.sendMessage(&#x22;hi&#x22;)        }        globalEventChannel().subscribeAlways<NewFriendRequestEvent>{            //自动同意好友申请            accept()        }        globalEventChannel().subscribeAlways<BotInvitedJoinGroupRequestEvent>{            //自动同意加群申请            accept()        }    }}"><div></div></button></div></figure></div>
<h3 id="vi-gradle部分代码"><a class="not-prose" href="#vi-gradle部分代码">vi. gradle部分代码</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="groovy" class="wrap" style="--ecMaxLine:95ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">plugins {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">val kotlinVersion </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"1.4.30"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">kotlin(</span><span style="--0:#9ECBFF;--1:#032F62">"jvm"</span><span style="--0:#E1E4E8;--1:#24292E">) version kotlinVersion</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">kotlin(</span><span style="--0:#9ECBFF;--1:#032F62">"plugin.serialization"</span><span style="--0:#E1E4E8;--1:#24292E">) version kotlinVersion</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">id(</span><span style="--0:#9ECBFF;--1:#032F62">"net.mamoe.mirai-console"</span><span style="--0:#E1E4E8;--1:#24292E">) version </span><span style="--0:#9ECBFF;--1:#032F62">"2.3.2"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">group </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"org.example"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">version </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"0.1.0"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">repositories {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">jcenter()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">//国内镜像源</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">//华为云</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">maven { url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">uri(</span><span style="--0:#9ECBFF;--1:#032F62">"https://mirrors.huaweicloud.com/repository/maven"</span><span style="--0:#E1E4E8;--1:#24292E">) }</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">//阿里云</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">maven { url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">uri(</span><span style="--0:#9ECBFF;--1:#032F62">"https://maven.aliyun.com/nexus/content/repositories/jcenter"</span><span style="--0:#E1E4E8;--1:#24292E">)}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">//mirai-console的仓库</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">maven {url </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> uri(</span><span style="--0:#9ECBFF;--1:#032F62">"https://dl.bintray.com/him188moe/mirai"</span><span style="--0:#E1E4E8;--1:#24292E">)}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">//滑动模块的仓库</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">// maven { url = uri("https://dl.bintray.com/karlatemp/misc") }</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">mavenLocal()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">mavenCentral()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">dependencies{</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">//在IDE内运行的mcl添加滑块模块，请参考https://github.com/project-mirai/mirai-login-solver-selenium把版本更新为最新</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">//runtimeOnly("net.mamoe:mirai-login-solver-selenium:1.0-dev-15")</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="plugins {    val kotlinVersion = &#x22;1.4.30&#x22;    kotlin(&#x22;jvm&#x22;) version kotlinVersion    kotlin(&#x22;plugin.serialization&#x22;) version kotlinVersion    id(&#x22;net.mamoe.mirai-console&#x22;) version &#x22;2.3.2&#x22;}group = &#x22;org.example&#x22;version = &#x22;0.1.0&#x22;repositories {    jcenter()    //国内镜像源    //华为云    maven { url =uri(&#x22;https://mirrors.huaweicloud.com/repository/maven&#x22;) }    //阿里云    maven { url =uri(&#x22;https://maven.aliyun.com/nexus/content/repositories/jcenter&#x22;)}    //mirai-console的仓库    maven {url = uri(&#x22;https://dl.bintray.com/him188moe/mirai&#x22;)}    //滑动模块的仓库    // maven { url = uri(&#x22;https://dl.bintray.com/karlatemp/misc&#x22;) }    mavenLocal()    mavenCentral()}dependencies{    //在IDE内运行的mcl添加滑块模块，请参考https://github.com/project-mirai/mirai-login-solver-selenium把版本更新为最新    //runtimeOnly(&#x22;net.mamoe:mirai-login-solver-selenium:1.0-dev-15&#x22;)}"><div></div></button></div></figure></div>
<p>其中<code>2.3.2</code>是目前最新开发版本，请自行通过<a href="https://github.com/mamoe/mirai-console/blob/master/docs/ConfiguringProjects.md#%E9%80%89%E6%8B%A9%E7%89%88%E6%9C%AC" rel="noreferrer noopener" target="_blank">官方文档</a>选择版本并更改
<img src="/images/Mirai-qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A1%86%E6%9E%B6kotlin_java%E6%95%99%E7%A8%8B.md-0.png" alt="更改版本"></p>
<h2 id="5-java插件代码解析"><a class="not-prose" href="#5-java插件代码解析">5. Java插件代码解析</a></h2>
<h3 id="i-在下面代码中要引入的库"><a class="not-prose" href="#i-在下面代码中要引入的库">i. 在下面代码中要引入的库</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="java" class="wrap" style="--ecMaxLine:70ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.console.plugin.jvm.JavaPlugin;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//继承对象</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.console.plugin.jvm.JvmPluginDescriptionBuilder;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//构造插件信息</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.event.GlobalEventChannel;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//全局监听通道</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.event.events.FriendMessageEvent;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//好友信息事件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.event.events.GroupMessageEvent;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">//群消息事件</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import net.mamoe.mirai.console.plugin.jvm.JavaPlugin;//继承对象import net.mamoe.mirai.console.plugin.jvm.JvmPluginDescriptionBuilder;//构造插件信息import net.mamoe.mirai.event.GlobalEventChannel;//全局监听通道import net.mamoe.mirai.event.events.FriendMessageEvent;//好友信息事件import net.mamoe.mirai.event.events.GroupMessageEvent;//群消息事件"><div></div></button></div></figure></div>
<h3 id="ii-构建主类"><a class="not-prose" href="#ii-构建主类">ii. 构建主类</a></h3>
<p>构建mirai插件的主类也就是入口点，必须要继承JavaPlugin</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="java" class="wrap" style="--ecMaxLine:83ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">public</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">final</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">class</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JavaPluginMain</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">extends</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JavaPlugin</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">public</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">static</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">final</span><span style="--0:#E1E4E8;--1:#24292E"> JavaPluginMain INSTANCE </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">new</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JavaPluginMain</span><span style="--0:#E1E4E8;--1:#24292E">();</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">private</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JavaPluginMain</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">super</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">new</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JvmPluginDescriptionBuilder</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"org.example.mirai-example"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"0.1.0"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"EG"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">build</span><span style="--0:#E1E4E8;--1:#24292E">());</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="public final class JavaPluginMain extends JavaPlugin {    public static final JavaPluginMain INSTANCE = new JavaPluginMain();    private JavaPluginMain() {        super(new JvmPluginDescriptionBuilder(&#x22;org.example.mirai-example&#x22;, &#x22;0.1.0&#x22;)                .info(&#x22;EG&#x22;)                .build());    }    }"><div></div></button></div></figure></div>
<p>其中<code>JvmPluginDescriptionBuilder</code>的声明插件信息</p>
<h3 id="iii-覆盖插件启用函数"><a class="not-prose" href="#iii-覆盖插件启用函数">iii. 覆盖插件启用函数</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="java" class="wrap" style="--ecMaxLine:31ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">@</span><span style="--0:#F97583;--1:#BF3441">Override</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">public</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">onEnable</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">getLogger</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"日志"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:5ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">     </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="@Override    public void onEnable() {        getLogger().info(&#x22;日志&#x22;);     }"><div></div></button></div></figure></div>
<p>用<code>getLogger()</code>获取日志对象，然后用<code>.info()</code>发送普通日志</p>
<h3 id="iv-监听事件"><a class="not-prose" href="#iv-监听事件">iv. 监听事件</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="java" class="wrap" style="--ecMaxLine:84ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">GlobalEventChannel.INSTANCE.</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">(GroupMessageEvent.class, g </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//监听群消息</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">            </span><span style="--0:#B392F0;--1:#6F42C1">getLogger</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E">(g.</span><span style="--0:#B392F0;--1:#6F42C1">getMessage</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">contentToString</span><span style="--0:#E1E4E8;--1:#24292E">());</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">});</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">GlobalEventChannel.INSTANCE.</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">(FriendMessageEvent.class, f </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//监听好友消息</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">            </span><span style="--0:#B392F0;--1:#6F42C1">getLogger</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E">(f.</span><span style="--0:#B392F0;--1:#6F42C1">getMessage</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">contentToString</span><span style="--0:#E1E4E8;--1:#24292E">());</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">});</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="GlobalEventChannel.INSTANCE.subscribeAlways(GroupMessageEvent.class, g -> {            //监听群消息            getLogger().info(g.getMessage().contentToString());        });        GlobalEventChannel.INSTANCE.subscribeAlways(FriendMessageEvent.class, f -> {            //监听好友消息            getLogger().info(f.getMessage().contentToString());        });"><div></div></button></div></figure></div>
<h3 id="v-全部代码-1"><a class="not-prose" href="#v-全部代码-1">v. 全部代码</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="java" class="wrap" style="--ecMaxLine:84ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">package</span><span style="--0:#E1E4E8;--1:#24292E"> org.example.mirai.plugin;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.console.plugin.jvm.JavaPlugin;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.console.plugin.jvm.JvmPluginDescriptionBuilder;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.event.GlobalEventChannel;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.event.events.FriendMessageEvent;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> net.mamoe.mirai.event.events.GroupMessageEvent;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">public</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">final</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">class</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JavaPluginMain</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">extends</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JavaPlugin</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">public</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">static</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">final</span><span style="--0:#E1E4E8;--1:#24292E"> JavaPluginMain INSTANCE </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">new</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JavaPluginMain</span><span style="--0:#E1E4E8;--1:#24292E">();</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">private</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JavaPluginMain</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">super</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">new</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">JvmPluginDescriptionBuilder</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"org.example.mirai-example"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"0.1.0"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"EG"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">.</span><span style="--0:#B392F0;--1:#6F42C1">build</span><span style="--0:#E1E4E8;--1:#24292E">());</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">@</span><span style="--0:#F97583;--1:#BF3441">Override</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">public</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">onEnable</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">getLogger</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"日志"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">GlobalEventChannel.INSTANCE.</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">(GroupMessageEvent.class, g </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//监听群消息</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">            </span><span style="--0:#B392F0;--1:#6F42C1">getLogger</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E">(g.</span><span style="--0:#B392F0;--1:#6F42C1">getMessage</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">contentToString</span><span style="--0:#E1E4E8;--1:#24292E">());</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">});</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">GlobalEventChannel.INSTANCE.</span><span style="--0:#B392F0;--1:#6F42C1">subscribeAlways</span><span style="--0:#E1E4E8;--1:#24292E">(FriendMessageEvent.class, f </span><span style="--0:#F97583;--1:#BF3441">-></span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972">//监听好友消息</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">            </span><span style="--0:#B392F0;--1:#6F42C1">getLogger</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">info</span><span style="--0:#E1E4E8;--1:#24292E">(f.</span><span style="--0:#B392F0;--1:#6F42C1">getMessage</span><span style="--0:#E1E4E8;--1:#24292E">().</span><span style="--0:#B392F0;--1:#6F42C1">contentToString</span><span style="--0:#E1E4E8;--1:#24292E">());</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">});</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="package org.example.mirai.plugin;import net.mamoe.mirai.console.plugin.jvm.JavaPlugin;import net.mamoe.mirai.console.plugin.jvm.JvmPluginDescriptionBuilder;import net.mamoe.mirai.event.GlobalEventChannel;import net.mamoe.mirai.event.events.FriendMessageEvent;import net.mamoe.mirai.event.events.GroupMessageEvent;public final class JavaPluginMain extends JavaPlugin {    public static final JavaPluginMain INSTANCE = new JavaPluginMain();    private JavaPluginMain() {        super(new JvmPluginDescriptionBuilder(&#x22;org.example.mirai-example&#x22;, &#x22;0.1.0&#x22;)                .info(&#x22;EG&#x22;)                .build());    }    @Override    public void onEnable() {        getLogger().info(&#x22;日志&#x22;);        GlobalEventChannel.INSTANCE.subscribeAlways(GroupMessageEvent.class, g -> {            //监听群消息            getLogger().info(g.getMessage().contentToString());        });        GlobalEventChannel.INSTANCE.subscribeAlways(FriendMessageEvent.class, f -> {            //监听好友消息            getLogger().info(f.getMessage().contentToString());        });    }}"><div></div></button></div></figure></div>
<h3 id="vi-gradle-部分代码"><a class="not-prose" href="#vi-gradle-部分代码">vi. gradle 部分代码</a></h3>
<p>同<code>#4-vi.-gradle-部分代码</code></p>
<h2 id="6-在ide内运行"><a class="not-prose" href="#6-在ide内运行">6. 在IDE内运行</a></h2>
<h3 id="i-更改mirairunkt配置"><a class="not-prose" href="#i-更改mirairunkt配置">i. 更改MiraiRunKt配置</a></h3>
<p>把<code>/src/test/kotlin/RunMirai.kt</code>中的qq号和密码改成你的
如果在根目录下没有run文件夹，则可能报错，新建一个就好了</p>
<h3 id="ii运行mirairunkt任务"><a class="not-prose" href="#ii运行mirairunkt任务">ii.运行MiraiRunKt任务</a></h3>
<p>如果任务报错先配置任务
<img src="/images/Mirai-qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A1%86%E6%9E%B6kotlin_java%E6%95%99%E7%A8%8B.md-1.png" alt="配置任务">
然后检查根目录下有没有run文件夹，就是这里的路径，如果没有则创建
<img src="/images/Mirai-qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A1%86%E6%9E%B6kotlin_java%E6%95%99%E7%A8%8B.md-2.png" alt="run文件夹">
然后配置登录配置
<img src="/images/Mirai-qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A1%86%E6%9E%B6kotlin_java%E6%95%99%E7%A8%8B.md-3.png" alt="登录配置"></p>
<h2 id="7-生成插件并运行"><a class="not-prose" href="#7-生成插件并运行">7. 生成插件并运行</a></h2>
<h3 id="i-生成插件"><a class="not-prose" href="#i-生成插件">i. 生成插件</a></h3>
<p>用IDE中gradle的<code>buldplugin</code>任务可以在<code>buid/mirai/</code>下生成一个.jar插件文件
<img src="/images/Mirai-qq%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%A1%86%E6%9E%B6kotlin_java%E6%95%99%E7%A8%8B.md-4.png" alt="buildPlugin"></p>
<h3 id="ii在mcl中运行"><a class="not-prose" href="#ii在mcl中运行">ii.在mcl中运行</a></h3>
<p>把这个.jar文件放到mcl的plugin文件夹下，然后用cmd或者直接打开mcl.cmd运行</p>
<blockquote>
<p>有什么评论区问，以后再补充</p>
</blockquote>
<center>-END-</center>   </div> </div> </article> <button class="hover:border-link fixed end-4 bottom-8 z-90 flex h-10 w-10 translate-y-28 cursor-pointer items-center justify-center rounded-full border-2 border-transparent bg-zinc-200 text-3xl opacity-0 transition-all transition-discrete duration-300 data-[show=true]:translate-y-0 data-[show=true]:opacity-100 sm:end-8 sm:h-12 sm:w-12 dark:bg-zinc-700" data-show="false" id="to-top-btn"> <span class="sr-only">Back to top</span> <svg aria-hidden="true" class="h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M4.5 15.75l7.5-7.5 7.5 7.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button>  </main> <footer class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pt-20 pb-4 text-center align-top font-semibold text-gray-600 sm:flex-row sm:justify-between sm:text-xs dark:text-gray-400"> <div class="me-0 text-neutral-400 sm:me-4">
&copy; <span class="text-accent">Eritque Arcus</span> 2020-2025.<br> <span>Powered by <a href="https://astro.build" class="hover:text-black">Astro</a>|<a href="https://github.com/chrismwilliams/astro-theme-cactus" class="hover:text-black">cactus</a></span><br> <a href="https://icp.gov.moe/?keyword=20222242" class="flex justify-center gap-1 text-xs hover:text-black"> <img src="/images/moe-icon120.png" class="h-4 w-4" alt="萌ICP备图标">
萌ICP备20222242号
</a> </div> <nav aria-labelledby="footer_links" class="flex flex-wrap gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500"> <p id="footer_links" class="sr-only">More on this site</p> <a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/archive/"> Archive </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/about/"> About </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/math-notes/"> Notes </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/friends/"> Friends </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/ctf-cheatsheet/"> CTF-QuickRef </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/music/"> Music </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://photos.ikuyo.dev"> Photos </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://www.travellings.cn/go.html"> 开往 </a> </nav> <script defer src="https://4-um4m1.ikuyo.dev/script.js" data-website-id="34e0a647-a8e8-40a8-ad62-742e9d604413" data-domains="ikuyo.dev"></script> <script type="text/javascript">
		(() => {
			const name = "outbound-link-click";
			document.querySelectorAll("a").forEach((a) => {
				if (a.host !== window.location.host && !a.getAttribute("data-umami-event")) {
					a.setAttribute("data-umami-event", name);
					a.setAttribute("data-umami-event-url", a.href);
				}
			});
		})();
	</script> </footer> </body></html> <script type="module">const e=document.getElementById("to-top-btn"),n=document.getElementById("blog-hero");function c(t){t.forEach(o=>{e.dataset.show=(!o.isIntersecting).toString()})}e.addEventListener("click",()=>{document.documentElement.scrollTo({behavior:"smooth",top:0})});const r=new IntersectionObserver(c);r.observe(n);</script>