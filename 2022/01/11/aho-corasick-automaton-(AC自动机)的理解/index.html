<!DOCTYPE html><html class="scroll-smooth" lang="zh-CN"> <head><meta charset="utf-8"><meta content="width=device-width, initial-scale=1.0" name="viewport"><title>aho-corasick automaton AC自动机的理解 • Eritque Arcus</title><link rel="icon" href="/favicon.png" type="image/png"><link href="/manifest.webmanifest" rel="manifest"><link href="https://ikuyo.dev/2022/01/11/aho-corasick-automaton-(AC%E8%87%AA%E5%8A%A8%E6%9C%BA)%E7%9A%84%E7%90%86%E8%A7%A3/" rel="canonical"><meta content="aho-corasick automaton AC自动机的理解 • Eritque Arcus" name="title"><meta content="Eritque Arcus's blog" name="description"><meta content="Eritque Arcus" name="author"><meta content="article" property="og:type"><meta content="aho-corasick automaton AC自动机的理解" property="og:title"><meta content="Eritque Arcus's blog" property="og:description"><meta content="https://ikuyo.dev/2022/01/11/aho-corasick-automaton-(AC%E8%87%AA%E5%8A%A8%E6%9C%BA)%E7%9A%84%E7%90%86%E8%A7%A3/" property="og:url"><meta content="Eritque Arcus" property="og:site_name"><meta content="zh_CN" property="og:locale"><meta content="1200" property="og:image:width"><meta content="630" property="og:image:height"><meta content="Eritque Arcus" property="article:author"><meta content="2022-01-11T20:47:00.000Z" property="article:published_time"><meta content="summary_large_image" property="twitter:card"><meta content="https://ikuyo.dev/2022/01/11/aho-corasick-automaton-(AC%E8%87%AA%E5%8A%A8%E6%9C%BA)%E7%9A%84%E7%90%86%E8%A7%A3/" property="twitter:url"><meta content="aho-corasick automaton AC自动机的理解" property="twitter:title"><meta content="Eritque Arcus's blog" property="twitter:description"><link href="/sitemap-index.xml" rel="sitemap"><link href="/rss.xml" title="Blog" rel="alternate" type="application/rss+xml"><link href="/notes/rss.xml" title="Notes" rel="alternate" type="application/rss+xml"><link href="https://webmention.io/ikuyo.dev/webmention" rel="webmention"><meta content="Astro v5.14.1" name="generator"><link href="https://github.com/Nambers" rel="me"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="anonymous" data-unfont><link rel="preload" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?family=Space Grotesk&family=Noto Sans SC&family=LXGW WenKai Mono TC&display=swap" data-unfont><style>@font-face{font-family:Iosevka Etoile;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/iosevka-etoile-latin-400-normal.CbciBTy_.woff2) format("woff2"),url(/_astro/iosevka-etoile-latin-400-normal.BsCJFtHE.woff) format("woff")}@font-face{font-family:Maple Mono;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/maple-mono-latin-400-normal.C5QbKxa2.woff2) format("woff2"),url(/_astro/maple-mono-latin-400-normal.BgUYpi45.woff) format("woff")}
</style>
<link rel="stylesheet" href="/_astro/_page_.Cx_-R518.css"><script type="module" src="/_astro/page.V2R8AmkL.js"></script></head> <body class="bg-global-bg text-global-text mx-auto flex min-h-screen max-w-7xl flex-col px-4 pt-16 text-sm font-normal antialiased sm:px-8"> <script>
	const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

	function getUserPref() {
		const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		return storedTheme || (lightModePref.matches ? "light" : "dark");
	}

	function setTheme(newTheme) {
		if (newTheme !== "light" && newTheme !== "dark") {
			return console.warn(
				`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
			);
		}

		const root = document.documentElement;

		// root already set to newTheme, exit early
		if (newTheme === root.getAttribute("data-theme")) {
			return;
		}

		root.setAttribute("data-theme", newTheme);

		if (typeof localStorage !== "undefined") {
			localStorage.setItem("theme", newTheme);
		}
	}

	// initial setup
	setTheme(getUserPref());

	// View Transitions hook to restore theme
	document.addEventListener("astro:after-swap", () => setTheme(getUserPref()));

	// listen for theme-change custom event, fired in src/components/ThemeToggle.astro
	document.addEventListener("theme-change", (e) => {
		setTheme(e.detail.theme);
	});

	// listen for prefers-color-scheme change.
	lightModePref.addEventListener("change", (e) => setTheme(e.matches ? "light" : "dark"));
</script> <a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">skip to content
</a> <header class="group relative mb-28 flex w-full items-center sm:ps-20" id="main-header"> <div class="flex w-full sm:flex-col"> <div class="flex w-full items-center sm:relative sm:inline-block"> <a aria-current="false" class="inline-flex items-center sm:relative sm:inline-block" href="/"> <img src="/avatar.png" alt="Avatar" class="me-3 h-16 w-16 rounded-full sm:absolute sm:-start-18 sm:me-0 sm:h-16 sm:w-16"> <span class="font-display text-accent ps-3 text-4xl font-bold tracking-wide whitespace-nowrap dark:drop-shadow-[0_0_2px_white] dark:drop-shadow-[0_0_4px_cyan] dark:drop-shadow-[0_0_8px_cyan] dark:drop-shadow-[0_0_16px_rgba(0,255,255,0.5)]"> Eritque Arcus </span> </a> </div> <nav aria-label="Main menu" class="bg-global-bg/85 absolute -inset-x-4 top-14 hidden w-full flex-col items-end gap-y-4 rounded-md py-4 shadow backdrop-blur-sm group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:rounded-none sm:bg-transparent sm:py-0 sm:ps-4 sm:shadow-none sm:backdrop-blur-none" id="navigation-menu"> <div class="text-accent sm:divide-accent sm:divide-x"> <a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/archive/"> Archive </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/about/"> About </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/math-notes/"> Notes </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/ctf-cheatsheet/"> CTF-QuickRef </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/music/"> Music </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="https://photos.ikuyo.dev"> Photos </a> </div> <div class="flex sm:ps-28"> <site-search class="ms-auto" id="search"> <button class="hover:text-accent flex h-9 w-9 cursor-pointer items-center justify-center rounded-md" aria-keyshortcuts="Control+K Meta+K" data-open-modal disabled> <svg aria-hidden="true" class="h-7 w-7" fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" stroke="none"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <span class="sr-only">Open Search</span> </button> <dialog aria-label="search" class="bg-global-bg h-full max-h-full w-full max-w-full border border-zinc-400 shadow-sm backdrop:backdrop-blur-sm open:flex sm:mx-auto sm:mt-16 sm:mb-auto sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md"> <div class="dialog-frame flex grow flex-col gap-4 p-6 pt-12 sm:pt-6"> <button class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700" data-close-modal>Close</button> <div class="search-container"> <div id="cactus__search"></div> </div> </div> </dialog> </site-search> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.rgeqRwRC.js"></script> <theme-toggle class="ms-2 sm:ms-4"> <button class="hover:text-accent relative h-9 w-9 cursor-pointer rounded-md p-2" type="button"> <span class="sr-only">Dark Theme</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0" fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100" fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path> <path d="M19 11h2m-1 -1v2"></path> </svg> </button> </theme-toggle> <script type="module" src="/_astro/ThemeToggle.astro_astro_type_script_index_0_lang.C1tldoqx.js"></script> </div> </nav> </div> <mobile-button class="mb-15"> <button aria-expanded="false" aria-haspopup="menu" class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button"> <span class="sr-only">Open main menu</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0" fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="text-accent absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100" class="text-accent" fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button> </mobile-button> </header> <script type="module" src="/_astro/Header.astro_astro_type_script_index_0_lang.DuSsDY4R.js"></script> <main id="main">  <article class="grow break-words" data-pagefind-body> <div id="blog-hero" class="mb-12"><h1 class="title"> aho-corasick automaton AC自动机的理解 </h1> <div class="flex flex-wrap items-center gap-x-3 gap-y-2"> <p class="font-semibold"> <time datetime="2022-01-11T20:47:00.000Z" title="2022-01-11T20:47:00.000Z">11 January 2022</time> /  17 min read </p>  </div> <div class="mt-2"> <svg aria-hidden="true" class="inline-block h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:cpp" href="/tags/cpp/"><span class="sr-only">View more blogs with the tag&nbsp;</span>cpp </a>,  </span> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:aho-corasick" href="/tags/aho-corasick/"><span class="sr-only">View more blogs with the tag&nbsp;</span>aho-corasick </a>,  </span> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:trie-tree" href="/tags/trie-tree/"><span class="sr-only">View more blogs with the tag&nbsp;</span>trie-tree </a> </span>  </div></div> <div class="grid grid-cols-[1fr_auto] gap-10 lg:flex-row lg:items-start"> <details open class="lg:sticky lg:top-12 lg:order-2 lg:-me-32 lg:basis-64"> <summary class="title hover:marker:text-accent cursor-pointer text-lg">Table of Contents</summary> <nav class="ms-4 lg:w-full"> <ol class="mt-4"> <li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#1-背景"><span aria-hidden="true" class="me-0.5">#</span>1. 背景</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#2-思想"><span aria-hidden="true" class="me-0.5">#</span>2. 思想</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#3-代码"><span aria-hidden="true" class="me-0.5">#</span>3. 代码</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#31-trie树"><span aria-hidden="true" class="me-0.5">#</span>3.1 Trie树</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#311-优化endnodes"><span aria-hidden="true" class="me-0.5">#</span>3.1.1 优化endNodes</a>  </li> </ol> </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#32-失配算法"><span aria-hidden="true" class="me-0.5">#</span>3.2 失配算法</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#33-寻找"><span aria-hidden="true" class="me-0.5">#</span>3.3 寻找</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#34-测试代码"><span aria-hidden="true" class="me-0.5">#</span>3.4 测试代码</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#35-完整代码"><span aria-hidden="true" class="me-0.5">#</span>3.5 完整代码</a>  </li> </ol> </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#4-可视化扩展"><span aria-hidden="true" class="me-0.5">#</span>4. 可视化扩展</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#41-cpp-更改"><span aria-hidden="true" class="me-0.5">#</span>4.1 cpp 更改</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#42-python"><span aria-hidden="true" class="me-0.5">#</span>4.2 python</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#43-效果"><span aria-hidden="true" class="me-0.5">#</span>4.3 效果</a>  </li> </ol> </li> </ol> </nav> </details> <div class="prose max-w-none prose-base prose-code:font-normal prose-headings:font-semibold prose-headings:text-accent-2 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-gray-600 prose-headings:hover:before:text-accent sm:prose-headings:before:content-['#'] sm:prose-th:before:content-none">  <blockquote>
<p>最近在学编译原理, 里面在3.3节词法单元识别后面就提到了这个算法然后根据网上资料自己做了一遍，只支持英文字母
可能最后的效果没有<a href="https://oi-wiki.org/string/ac-automaton" rel="noreferrer noopener" target="_blank">oi-wiki</a>上的效率高</p>
</blockquote>
<h2 id="1-背景"><a class="not-prose" href="#1-背景">1. 背景</a></h2>
<p>大概涉及到的知识:</p>
<ul>
<li>Trie 树，一种字典树，可以看<a href="https://yuepenglei.github.io/2019/01/06/Trie/" rel="noreferrer noopener" target="_blank">这里</a>做的挺直观的</li>
<li>BFS 广度优先搜索Trie树</li>
<li>状态压缩，随便做的小优化，可能有负效果对于数据量小(x
主要思想就是用int/long这种数据类型的每一位通过位运算当作bool而不是单独声明bool类型, 主要的算法就
<ul>
<li><code>(n>>k)&#x26;1</code>取出n的第k位的数据</li>
<li><code>n^(1&#x3C;&#x3C;k)</code> n的第k位取反</li>
</ul>
</li>
<li>AC自动机的失配(失效)算法</li>
</ul>
<h2 id="2-思想"><a class="not-prose" href="#2-思想">2. 思想</a></h2>
<p>主要流程就, 先构造一棵trie树，然后用bfs构造每个节点的失配位置(最后效果就类似于DFA确定有限状态自动机)，然后再遍历以匹配出结果</p>
<h2 id="3-代码"><a class="not-prose" href="#3-代码">3. 代码</a></h2>
<h3 id="31-trie树"><a class="not-prose" href="#31-trie树">3.1 Trie树</a></h3>
<p>比较简易的做法就是</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.oaceo.css"><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:15ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">struct</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">Node</span><span style="--0:#E1E4E8;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">Node</span><span style="--0:#F97583;--1:#BF3441">*</span><span style="--0:#E1E4E8;--1:#24292E"> next[</span><span style="--0:#79B8FF;--1:#005CC5">26</span><span style="--0:#E1E4E8;--1:#24292E">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">bool</span><span style="--0:#E1E4E8;--1:#24292E"> end;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">};</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="struct Node{Node* next[26];bool end;};"><div></div></button></div></figure></div>
<p>用数组的下标表示对应边(anscii, 比如 <code>char - 'a'</code>)和对应的下一个节点
这里优化一下, 不然内存地址太分散然后其实这个数据结构不是很有必要
所以本文用一个<strong>二维数组</strong>代替这一套(<code>nodes[x][y]</code>x是节点的编号,y是<code>y+'a'</code>的边指向的节点 0&#x3C;=y&#x3C;=25, 比如a的边就是<code>'a'-'a'=0</code>), 具象化表示就<a href="https://oi-wiki.org/string/ac-automaton/#_5" rel="noreferrer noopener" target="_blank">参考oi-wiki</a></p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:21ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">constexpr</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> s </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">50</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[s][</span><span style="--0:#79B8FF;--1:#005CC5">26</span><span style="--0:#E1E4E8;--1:#24292E">]{</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> now </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">bool</span><span style="--0:#E1E4E8;--1:#24292E"> end[s];</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="constexpr int s = 50;int nodes[s][26]{0};int now = 1;bool end[s];"><div></div></button></div></figure></div>
<ul>
<li><code>s</code>是数组大小，因为后面状态压缩的时候还要用到就提取出来，作用和<code>#define</code>一样</li>
<li><code>end</code>是代表对应下标的节点是不是单词的结尾(判断匹配是否成功)</li>
<li><code>now</code>是下一个节点应该是哪个下标</li>
</ul>
<p>然后就是写<code>add()</code>或者<code>insert</code>方法</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:65ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">std</span><span style="--0:#E1E4E8;--1:#24292E">::</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#FFAB70;--1:#AE4B07">text</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972">   // 插入单词</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                            // 当前插入到哪个节点, 一开始从根节点开始</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> each: text) {</span><span style="--0:#99A0A6;--1:#616972">               // 循环每个字符</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#99A0A6;--1:#616972">    // 如果没有对应的字符节点就新建一个</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> now</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 存入对应字符节点的下标</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">];</span><span style="--0:#99A0A6;--1:#616972">         // 把目前插入到的节点指向到对应字符的子节点</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">end[p] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 单词结尾</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void trieAdd(const std::string &#x26;text) {   // 插入单词    int p = 0;                            // 当前插入到哪个节点, 一开始从根节点开始    for (char each: text) {               // 循环每个字符        if (nodes[p][each - &#x27;a&#x27;] == 0)    // 如果没有对应的字符节点就新建一个            nodes[p][each - &#x27;a&#x27;] = now++; // 存入对应字符节点的下标        p = nodes[p][each - &#x27;a&#x27;];         // 把目前插入到的节点指向到对应字符的子节点    }    end[p] = true; // 单词结尾}"><div></div></button></div></figure></div>
<h4 id="311-优化endnodes"><a class="not-prose" href="#311-优化endnodes">3.1.1 优化endNodes</a></h4>
<p>这里做了一个可有可无的优化, 就把代表end节点从一个bool数组改成一个int32_t数组, 然后用32位中每一位表示一个节点是否为接受节点(0或1)
为了使数据方便取余, 最好用2的整次方为数位长度(如8, 16, 32等)</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:75ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">constexpr</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> s </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">50</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[s][</span><span style="--0:#79B8FF;--1:#005CC5">26</span><span style="--0:#E1E4E8;--1:#24292E">]{</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> now </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">constexpr</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> bitW </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">32</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                             // 必须是2的n次方</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int32_t</span><span style="--0:#E1E4E8;--1:#24292E"> endNodes[s </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> (s </span><span style="--0:#F97583;--1:#BF3441">%</span><span style="--0:#E1E4E8;--1:#24292E"> bitW </span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">?</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">)]{</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">};</span><span style="--0:#99A0A6;--1:#616972"> // 该下标对应的节点是否为单词的结尾</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="constexpr int s = 50;int nodes[s][26]{0};int now = 1;constexpr int bitW = 32;                             // 必须是2的n次方int32_t endNodes[s / bitW + (s % bitW > 0 ? 1 : 0)]{0}; // 该下标对应的节点是否为单词的结尾"><div></div></button></div></figure></div>
<p>所以上面的声明代码就变成这样, 和add方法</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:159ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">std</span><span style="--0:#E1E4E8;--1:#24292E">::</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#FFAB70;--1:#AE4B07">text</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972">   // 插入单词</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                            // 当前插入到哪个节点, 一开始从根节点开始</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> each: text) {</span><span style="--0:#99A0A6;--1:#616972">               // 循环每个字符</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#99A0A6;--1:#616972">    // 如果没有对应的字符节点就新建一个</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> now</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 存入对应字符节点的下标</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">];</span><span style="--0:#99A0A6;--1:#616972">         // 把目前插入到的节点指向到对应字符的子节点</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">^</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> (bitW </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)));</span><span style="--0:#99A0A6;--1:#616972"> // 表明该节点是单词的结尾, endNodes[p/bitW]^(1&#x3C;&#x3C;n)是对n位取反, 后面的p&#x26;63为:当取余的除数为2^n时,可以用p&#x26;(k-1)代替,也就是p&#x26;63</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void trieAdd(const std::string &#x26;text) {   // 插入单词    int p = 0;                            // 当前插入到哪个节点, 一开始从根节点开始    for (char each: text) {               // 循环每个字符        if (nodes[p][each - &#x27;a&#x27;] == 0)    // 如果没有对应的字符节点就新建一个            nodes[p][each - &#x27;a&#x27;] = now++; // 存入对应字符节点的下标        p = nodes[p][each - &#x27;a&#x27;];         // 把目前插入到的节点指向到对应字符的子节点    }    endNodes[p / bitW] = endNodes[p / bitW] ^ (1 << (p &#x26; (bitW - 1))); // 表明该节点是单词的结尾, endNodes[p/bitW]^(1<<n)是对n位取反, 后面的p&#x26;63为:当取余的除数为2^n时,可以用p&#x26;(k-1)代替,也就是p&#x26;63}"><div></div></button></div></figure></div>
<p>然后当要去第p个节点是否是接受(结束)节点时:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:49ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> ((endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">>></span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> (bitW </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">))) </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="if ((endNodes[p / bitW] >> (p &#x26; (bitW - 1))) &#x26; 1)"><div></div></button></div></figure></div>
<h3 id="32-失配算法"><a class="not-prose" href="#32-失配算法">3.2 失配算法</a></h3>
<p>主要就先准备一个fail数组(在这里我设立的是从1开始, 就不用提前赋值全部元素为-1, 因为元素可以是0), 下标代表对应的节点失配后跳转到哪个节点
然后用一个队列(queue)确保BFS因为先入先出
然后就循环每一个节点和子节点找失配位置
具体流程:
先从根节点开始 -> 依循bfs也就是宽度(广度)优先顺序搜索每个子节点->先遍历每个子节点的每条边->当边不为空(指向的子节点!=0, 因为边是不可能指向根节点), 对于每个子节点的边有3种情况:</p>
<ul>
<li>如果父节点是0也就是根节点, 那当前边指向的子节点的失配位置就是根节点也就是0</li>
<li>如果父节点是失配位置有当前边, 那当前边指向的子节点的失配位置就是父节点的失配位置</li>
<li>如果以上都不是, 把父节点的失配位置看作这条边的父节点然后继续上面的流程知道父节点是根节点</li>
</ul>
<p>执行上面的流程找到失配位置后把当前边对应的子节点压入队列然后开始下一条边</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:139ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> fail[s]{</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">trieFail</span><span style="--0:#E1E4E8;--1:#24292E">() {</span><span style="--0:#99A0A6;--1:#616972">                                   // 失配跳转配置</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> n;</span><span style="--0:#99A0A6;--1:#616972">                                          // now, 也就是当前节点的下标</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">queue</span><span style="--0:#F97583;--1:#BF3441">&#x3C;int></span><span style="--0:#E1E4E8;--1:#24292E"> ns;</span><span style="--0:#99A0A6;--1:#616972">                                  // 待处理的节点下标</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">ns.</span><span style="--0:#B392F0;--1:#6F42C1">push</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">);</span><span style="--0:#99A0A6;--1:#616972">                                     // 一开始从根节点开始</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (ns.</span><span style="--0:#B392F0;--1:#6F42C1">empty</span><span style="--0:#E1E4E8;--1:#24292E">()) </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 如果没有待处理的就推出</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">n </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> ns.</span><span style="--0:#B392F0;--1:#6F42C1">front</span><span style="--0:#E1E4E8;--1:#24292E">();</span><span style="--0:#99A0A6;--1:#616972">          // 取出最上面待处理的并弹出</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">ns.</span><span style="--0:#B392F0;--1:#6F42C1">pop</span><span style="--0:#E1E4E8;--1:#24292E">();</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">; i </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">26</span><span style="--0:#E1E4E8;--1:#24292E">; i</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 循环该节点下全部子节点</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[n][i] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">{</span><span style="--0:#99A0A6;--1:#616972">                         // 求失配跳转位置</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> pp </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> n;</span><span style="--0:#99A0A6;--1:#616972">           // 父节点, 因为遍历的是当前节点的子节点, 所以父节点就是当前节点</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> nn </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[n][i];</span><span style="--0:#99A0A6;--1:#616972"> // 当前节点, 也就是遍历的子节点</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (pp </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972">        // 如果父节点是根节点, 那失配节点就是根节点</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                        </span></span><span style="--0:#E1E4E8;--1:#24292E">fail[nn] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">} </span><span style="--0:#F97583;--1:#BF3441">else</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">                        </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 不断循环父节点的失配位置, 或者父节点的失配位置的失配位置直到到根节点或者找到合适的</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">                            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (fail[pp] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) pp </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> fail[pp] </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 如果父节点有失配位置, 就把父节点的失配位置视为父节点</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">                            </span><span style="--0:#F97583;--1:#BF3441">else</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">                                </span><span style="--0:#F97583;--1:#BF3441">throw</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">invalid_argument</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">to_string</span><span style="--0:#E1E4E8;--1:#24292E">(nn) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"-"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">to_string</span><span style="--0:#E1E4E8;--1:#24292E">(pp) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"x"</span><span style="--0:#E1E4E8;--1:#24292E">);</span><span style="--0:#99A0A6;--1:#616972"> // unreachable</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">                            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[pp][i] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972">                                               // 如果该节点(父节点的某个失配位置)有i的边, 失配位置就是那个边指向的节点</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                                </span></span><span style="--0:#E1E4E8;--1:#24292E">fail[nn] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[pp][i] </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">                                </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">                            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (pp </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 如果父节点是根节点, 那失配节点就直接是根节点</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                                </span></span><span style="--0:#E1E4E8;--1:#24292E">fail[nn] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">                                </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">ns.</span><span style="--0:#B392F0;--1:#6F42C1">push</span><span style="--0:#E1E4E8;--1:#24292E">(nodes[n][i]);</span><span style="--0:#99A0A6;--1:#616972"> // 把该节点列入待处理队列</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="int fail[s]{0};void trieFail() {                                   // 失配跳转配置    int n;                                          // now, 也就是当前节点的下标    queue<int> ns;                                  // 待处理的节点下标    ns.push(0);                                     // 一开始从根节点开始    while (true) {        if (ns.empty()) break; // 如果没有待处理的就推出        n = ns.front();          // 取出最上面待处理的并弹出        ns.pop();        for (int i = 0; i < 26; i++) { // 循环该节点下全部子节点            if (nodes[n][i] != 0) {                {                         // 求失配跳转位置                    int pp = n;           // 父节点, 因为遍历的是当前节点的子节点, 所以父节点就是当前节点                    int nn = nodes[n][i]; // 当前节点, 也就是遍历的子节点                    if (pp == 0) {        // 如果父节点是根节点, 那失配节点就是根节点                        fail[nn] = 1;                    } else                        while (true) { // 不断循环父节点的失配位置, 或者父节点的失配位置的失配位置直到到根节点或者找到合适的                            if (fail[pp] != 0) pp = fail[pp] - 1; // 如果父节点有失配位置, 就把父节点的失配位置视为父节点                            else                                throw invalid_argument(to_string(nn) + &#x22;-&#x22; + to_string(pp) + &#x22;x&#x22;); // unreachable                            if (nodes[pp][i] != 0) {                                               // 如果该节点(父节点的某个失配位置)有i的边, 失配位置就是那个边指向的节点                                fail[nn] = nodes[pp][i] + 1;                                break;                            }                            if (pp == 0) { // 如果父节点是根节点, 那失配节点就直接是根节点                                fail[nn] = 1;                                break;                            }                        }                }                ns.push(nodes[n][i]); // 把该节点列入待处理队列            }        }    }}"><div></div></button></div></figure></div>
<h3 id="33-寻找"><a class="not-prose" href="#33-寻找">3.3 寻找</a></h3>
<p>就循环每条边, 如果匹配不上就移动到失配节点继续</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:133ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">vector</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E">> </span><span style="--0:#B392F0;--1:#6F42C1">trieFind</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">std</span><span style="--0:#E1E4E8;--1:#24292E">::</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#FFAB70;--1:#AE4B07">text</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 查找一个单词</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                                     // 从根节点开始找</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">vector</span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E">string</span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> rev;</span><span style="--0:#99A0A6;--1:#616972">                            // 所有匹配到的串</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">string re;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> each: text) {</span><span style="--0:#99A0A6;--1:#616972"> // 循环每一个字符</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) re </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 如果对应字符的边存在,就移动到那个子节点</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">];</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">re </span><span style="--0:#F97583;--1:#BF3441">+=</span><span style="--0:#E1E4E8;--1:#24292E"> each;</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> ((endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">>></span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> (bitW </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">))) </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 如果最后一个节点是单词结束就代表匹配,p&#x26;63=p%bitW,(endNodes[p/bitW]>>n)&#x26;1是取第n位的数据</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">rev.</span><span style="--0:#B392F0;--1:#6F42C1">push_back</span><span style="--0:#E1E4E8;--1:#24292E">(re);</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> fail[p] </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E">(re.</span><span style="--0:#B392F0;--1:#6F42C1">length</span><span style="--0:#E1E4E8;--1:#24292E">() </span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                        </span></span><span style="--0:#E1E4E8;--1:#24292E">re </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> re.</span><span style="--0:#B392F0;--1:#6F42C1">substr</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">} </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (fail[p] </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> fail[p] </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 否则转移(因为fail是从1开始的所以减一)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E">(re.</span><span style="--0:#B392F0;--1:#6F42C1">length</span><span style="--0:#E1E4E8;--1:#24292E">() </span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">re </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> re.</span><span style="--0:#B392F0;--1:#6F42C1">substr</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> ((endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">>></span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> (bitW </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">))) </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 如果节点是匹配结束节点</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">rev.</span><span style="--0:#B392F0;--1:#6F42C1">push_back</span><span style="--0:#E1E4E8;--1:#24292E">(re);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> rev;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="vector<string> trieFind(const std::string &#x26;text) { // 查找一个单词    int p = 0;                                     // 从根节点开始找    vector<string> rev;                            // 所有匹配到的串    string re;    for (char each: text) { // 循环每一个字符        while (true) {            if (p == 0) re = &#x22;&#x22;;            if (nodes[p][each - &#x27;a&#x27;] != 0) { // 如果对应字符的边存在,就移动到那个子节点                p = nodes[p][each - &#x27;a&#x27;];                re += each;                if ((endNodes[p / bitW] >> (p &#x26; (bitW - 1))) &#x26; 1) { // 如果最后一个节点是单词结束就代表匹配,p&#x26;63=p%bitW,(endNodes[p/bitW]>>n)&#x26;1是取第n位的数据                    rev.push_back(re);                    p = fail[p] - 1;                    if(re.length() > 1)                        re = re.substr(1);                }                break;            } else {                if (fail[p] == 0) break;                p = fail[p] - 1; // 否则转移(因为fail是从1开始的所以减一)                if(re.length() > 1)                    re = re.substr(1);            }        }    }    if ((endNodes[p / bitW] >> (p &#x26; (bitW - 1))) &#x26; 1) { // 如果节点是匹配结束节点        rev.push_back(re);    }    return rev;}"><div></div></button></div></figure></div>
<h3 id="34-测试代码"><a class="not-prose" href="#34-测试代码">3.4 测试代码</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:113ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">printVector</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">vector</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E">> </span><span style="--0:#FFAB70;--1:#AE4B07">t</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">string re;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">auto</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E">i: t)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">re </span><span style="--0:#F97583;--1:#BF3441">+=</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">" "</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> re;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">main</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"gsafsfawdasca"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"gdscascwadawxszg"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"ewyuoascasdwo"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"csaxawewddwaqw"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieFail</span><span style="--0:#E1E4E8;--1:#24292E">();</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">to_string</span><span style="--0:#E1E4E8;--1:#24292E">(now) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> endl;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">printVector</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">trieFind</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"csaxawewddwaqwfsacasfegdscascwadawxszgagsafsfawdascawgrhherasdawdwzz"</span><span style="--0:#E1E4E8;--1:#24292E">)) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> endl</span></div></div><div class="ec-line" style="--ecIndent:9ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">         </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">printVector</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">trieFind</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"fsacasfegdscascwadawxszgsafsfawdascawgrhherasdawdwzzcsaxawewddwaqw"</span><span style="--0:#E1E4E8;--1:#24292E">)) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> endl</span></div></div><div class="ec-line" style="--ecIndent:9ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">         </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">printVector</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">trieFind</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"cegergecsaxaweqsdawryyrgte"</span><span style="--0:#E1E4E8;--1:#24292E">)) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> endl;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">; i </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> s; i</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">" "</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> endl;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">auto</span><span style="--0:#E1E4E8;--1:#24292E"> a: fail)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> a </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">" "</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="string printVector(vector<string> t) {    string re;    for (auto &#x26;i: t)        re += i + &#x22; &#x22;;    return re;}int main() {    trieAdd(&#x22;gsafsfawdasca&#x22;);    trieAdd(&#x22;gdscascwadawxszg&#x22;);    trieAdd(&#x22;ewyuoascasdwo&#x22;);    trieAdd(&#x22;csaxawewddwaqw&#x22;);    trieFail();    cout << to_string(now) << endl;    cout << printVector(trieFind(&#x22;csaxawewddwaqwfsacasfegdscascwadawxszgagsafsfawdascawgrhherasdawdwzz&#x22;)) << endl         << printVector(trieFind(&#x22;fsacasfegdscascwadawxszgsafsfawdascawgrhherasdawdwzzcsaxawewddwaqw&#x22;)) << endl         << printVector(trieFind(&#x22;cegergecsaxaweqsdawryyrgte&#x22;)) << endl;    for (int i = 0; i < s; i++)        cout << i << &#x22; &#x22;;    cout << endl;    for (auto a: fail)        cout << a - 1 << &#x22; &#x22;;    return 0;}"><div></div></button></div></figure></div>
<h3 id="35-完整代码"><a class="not-prose" href="#35-完整代码">3.5 完整代码</a></h3>
<div class="expressive-code"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:159ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">/*</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent"><span style="--0:#99A0A6;--1:#616972"> </span></span><span style="--0:#99A0A6;--1:#616972">* Copyright (c) Eritque arcus</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#99A0A6;--1:#616972"> </span></span><span style="--0:#99A0A6;--1:#616972">* Date: 2022/1/11</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#99A0A6;--1:#616972"> </span></span><span style="--0:#99A0A6;--1:#616972">* MIT license</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#99A0A6;--1:#616972"> </span></span><span style="--0:#99A0A6;--1:#616972">*/</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">#include</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">&#x3C;iostream></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">#include</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">&#x3C;queue></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">#include</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">&#x3C;vector></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">using</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">namespace</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">std</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">constexpr</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> s </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">50</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                                  // 有多少个节点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">constexpr</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> bitW </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">32</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                                // 必须是2的n次方</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[s][</span><span style="--0:#79B8FF;--1:#005CC5">26</span><span style="--0:#E1E4E8;--1:#24292E">]{</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">};</span><span style="--0:#99A0A6;--1:#616972">                                    // 储存全部的节点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> fail[s]{</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">};</span><span style="--0:#99A0A6;--1:#616972">                                         // 失配跳转</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> now </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                                            // 下一个插入节点的地方</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int32_t</span><span style="--0:#E1E4E8;--1:#24292E"> endNodes[s </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> (s </span><span style="--0:#F97583;--1:#BF3441">%</span><span style="--0:#E1E4E8;--1:#24292E"> bitW </span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">?</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">:</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">)]{</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">};</span><span style="--0:#99A0A6;--1:#616972"> // 该下标对应的节点是否为单词的结尾</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">trieFail</span><span style="--0:#E1E4E8;--1:#24292E">() {</span><span style="--0:#99A0A6;--1:#616972">                                       // 失配跳转配置</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> n;</span><span style="--0:#99A0A6;--1:#616972">                                              // now, parent</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">queue</span><span style="--0:#F97583;--1:#BF3441">&#x3C;int></span><span style="--0:#E1E4E8;--1:#24292E"> ns;</span><span style="--0:#99A0A6;--1:#616972">                                      // 待处理的节点下标</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">ns.</span><span style="--0:#B392F0;--1:#6F42C1">push</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">);</span><span style="--0:#99A0A6;--1:#616972">                                         // 一开始从根目录开始</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (ns.</span><span style="--0:#B392F0;--1:#6F42C1">empty</span><span style="--0:#E1E4E8;--1:#24292E">()) </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 如果没有待处理的就推出</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">n </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> ns.</span><span style="--0:#B392F0;--1:#6F42C1">front</span><span style="--0:#E1E4E8;--1:#24292E">();</span><span style="--0:#99A0A6;--1:#616972">        // 取出最上面待处理的</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">ns.</span><span style="--0:#B392F0;--1:#6F42C1">pop</span><span style="--0:#E1E4E8;--1:#24292E">();</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">; i </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">26</span><span style="--0:#E1E4E8;--1:#24292E">; i</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 循环该节点下全部子节点</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[n][i] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">{</span><span style="--0:#99A0A6;--1:#616972">                         // 求失配跳转位置</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> pp </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> n;</span><span style="--0:#99A0A6;--1:#616972">           // 父节点, 因为遍历的是当前节点的子节点, 所以父节点就是当前节点</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> nn </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[n][i];</span><span style="--0:#99A0A6;--1:#616972"> // 当前节点, 也就是遍历的子节点</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (pp </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972">        // 如果父节点是根节点, 那失配节点就是根节点</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                        </span></span><span style="--0:#E1E4E8;--1:#24292E">fail[nn] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">} </span><span style="--0:#F97583;--1:#BF3441">else</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">                        </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972">                            // 不断循环父节点的失配位置, 或者父节点的失配位置的失配位置直到在根节点寻找失配位置或者找到合适的</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">                            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (fail[pp] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) pp </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> fail[pp] </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 如果父节点有失配位置, 就移动过去</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">                            </span><span style="--0:#F97583;--1:#BF3441">else</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">                                </span><span style="--0:#F97583;--1:#BF3441">throw</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">invalid_argument</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">to_string</span><span style="--0:#E1E4E8;--1:#24292E">(nn) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"-"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">to_string</span><span style="--0:#E1E4E8;--1:#24292E">(pp) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"x"</span><span style="--0:#E1E4E8;--1:#24292E">);</span><span style="--0:#99A0A6;--1:#616972"> // unreachable</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">                            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[pp][i] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972">                                               // 如果该节点(父节点的某个失配位置)有i的边就移动过去</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                                </span></span><span style="--0:#E1E4E8;--1:#24292E">fail[nn] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[pp][i] </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">                                </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">                            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (pp </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 如果父节点是根节点, 那失配节点就直接是根节点</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                                </span></span><span style="--0:#E1E4E8;--1:#24292E">fail[nn] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:32ch"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">                                </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:28ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">ns.</span><span style="--0:#B392F0;--1:#6F42C1">push</span><span style="--0:#E1E4E8;--1:#24292E">(nodes[n][i]);</span><span style="--0:#99A0A6;--1:#616972"> // 把该子节点列入待处理栈</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">std</span><span style="--0:#E1E4E8;--1:#24292E">::</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#FFAB70;--1:#AE4B07">text</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972">   // 插入单词</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                            // 当前插入到哪个节点, 一开始从根节点开始</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> each: text) {</span><span style="--0:#99A0A6;--1:#616972">               // 循环每个字符</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#99A0A6;--1:#616972">    // 如果没有对应的字符节点就新建一个</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> now</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 存入对应字符节点的下标</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">];</span><span style="--0:#99A0A6;--1:#616972">         // 把目前插入到的节点指向到对应字符的子节点</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">^</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> (bitW </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)));</span><span style="--0:#99A0A6;--1:#616972"> // 表明该节点是单词的结尾, endNodes[p/bitW]^(1&#x3C;&#x3C;n)是对n位取反, 后面的p&#x26;63为:当取余的除数为2^n时,可以用p&#x26;(k-1)代替,也就是p&#x26;63</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">vector</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E">> </span><span style="--0:#B392F0;--1:#6F42C1">trieFind</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">std</span><span style="--0:#E1E4E8;--1:#24292E">::</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#FFAB70;--1:#AE4B07">text</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 查找一个单词</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                                     // 从根节点开始找</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">vector</span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E">string</span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> rev;</span><span style="--0:#99A0A6;--1:#616972">                            // 所有匹配到的串</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">string re;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> each: text) {</span><span style="--0:#99A0A6;--1:#616972"> // 循环每一个字符</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) re </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 如果对应字符的边存在,就移动到那个子节点</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">];</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">re </span><span style="--0:#F97583;--1:#BF3441">+=</span><span style="--0:#E1E4E8;--1:#24292E"> each;</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> ((endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">>></span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> (bitW </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">))) </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 如果最后一个节点是单词结束就代表匹配,p&#x26;63=p%bitW,(endNodes[p/bitW]>>n)&#x26;1是取第n位的数据</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">rev.</span><span style="--0:#B392F0;--1:#6F42C1">push_back</span><span style="--0:#E1E4E8;--1:#24292E">(re);</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> fail[p] </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E">(re.</span><span style="--0:#B392F0;--1:#6F42C1">length</span><span style="--0:#E1E4E8;--1:#24292E">() </span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:24ch"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                        </span></span><span style="--0:#E1E4E8;--1:#24292E">re </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> re.</span><span style="--0:#B392F0;--1:#6F42C1">substr</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">} </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E"> {</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (fail[p] </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">break</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> fail[p] </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 否则转移(因为fail是从1开始的所以减一)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E">(re.</span><span style="--0:#B392F0;--1:#6F42C1">length</span><span style="--0:#E1E4E8;--1:#24292E">() </span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">re </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> re.</span><span style="--0:#B392F0;--1:#6F42C1">substr</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> ((endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">>></span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> (bitW </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">))) </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972"> // 如果节点是匹配结束节点</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">rev.</span><span style="--0:#B392F0;--1:#6F42C1">push_back</span><span style="--0:#E1E4E8;--1:#24292E">(re);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> rev;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">printVector</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">vector</span><span style="--0:#E1E4E8;--1:#24292E">&#x3C;</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E">> </span><span style="--0:#FFAB70;--1:#AE4B07">t</span><span style="--0:#E1E4E8;--1:#24292E">) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">string re;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">auto</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E">i: t)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">re </span><span style="--0:#F97583;--1:#BF3441">+=</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">" "</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> re;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">main</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"aaaaaa"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"bbbbbb"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"ababab"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"cacsafasfasfsgefacsdcewg"</span><span style="--0:#E1E4E8;--1:#24292E">);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">trieFail</span><span style="--0:#E1E4E8;--1:#24292E">();</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"节点数:"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">to_string</span><span style="--0:#E1E4E8;--1:#24292E">(now) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> endl;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">printVector</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#B392F0;--1:#6F42C1">trieFind</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"aaaaaaabbbbbbbbbacacsafasfasfsgefacsdcewgbaabcaaaaaaabbbbbbbbbbbbabbbbbbbbbbbbaav"</span><span style="--0:#E1E4E8;--1:#24292E">)) </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> endl;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">; i </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> s; i</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">" "</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> endl;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">auto</span><span style="--0:#E1E4E8;--1:#24292E"> a: fail)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">cout </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> a </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">" "</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/* * Copyright (c) Eritque arcus * Date: 2022/1/11 * MIT license */#include <iostream>#include <queue>#include <vector>using namespace std;constexpr int s = 50;                                  // 有多少个节点constexpr int bitW = 32;                                // 必须是2的n次方int nodes[s][26]{0};                                    // 储存全部的节点int fail[s]{0};                                         // 失配跳转int now = 1;                                            // 下一个插入节点的地方int32_t endNodes[s / bitW + (s % bitW > 0 ? 1 : 0)]{0}; // 该下标对应的节点是否为单词的结尾void trieFail() {                                       // 失配跳转配置    int n;                                              // now, parent    queue<int> ns;                                      // 待处理的节点下标    ns.push(0);                                         // 一开始从根目录开始    while (true) {        if (ns.empty()) break; // 如果没有待处理的就推出        n = ns.front();        // 取出最上面待处理的        ns.pop();        for (int i = 0; i < 26; i++) { // 循环该节点下全部子节点            if (nodes[n][i] != 0) {                {                         // 求失配跳转位置                    int pp = n;           // 父节点, 因为遍历的是当前节点的子节点, 所以父节点就是当前节点                    int nn = nodes[n][i]; // 当前节点, 也就是遍历的子节点                    if (pp == 0) {        // 如果父节点是根节点, 那失配节点就是根节点                        fail[nn] = 1;                    } else                        while (true) {                            // 不断循环父节点的失配位置, 或者父节点的失配位置的失配位置直到在根节点寻找失配位置或者找到合适的                            if (fail[pp] != 0) pp = fail[pp] - 1; // 如果父节点有失配位置, 就移动过去                            else                                throw invalid_argument(to_string(nn) + &#x22;-&#x22; + to_string(pp) + &#x22;x&#x22;); // unreachable                            if (nodes[pp][i] != 0) {                                               // 如果该节点(父节点的某个失配位置)有i的边就移动过去                                fail[nn] = nodes[pp][i] + 1;                                break;                            }                            if (pp == 0) { // 如果父节点是根节点, 那失配节点就直接是根节点                                fail[nn] = 1;                                break;                            }                        }                }                ns.push(nodes[n][i]); // 把该子节点列入待处理栈            }        }    }}void trieAdd(const std::string &#x26;text) {   // 插入单词    int p = 0;                            // 当前插入到哪个节点, 一开始从根节点开始    for (char each: text) {               // 循环每个字符        if (nodes[p][each - &#x27;a&#x27;] == 0)    // 如果没有对应的字符节点就新建一个            nodes[p][each - &#x27;a&#x27;] = now++; // 存入对应字符节点的下标        p = nodes[p][each - &#x27;a&#x27;];         // 把目前插入到的节点指向到对应字符的子节点    }    endNodes[p / bitW] = endNodes[p / bitW] ^ (1 << (p &#x26; (bitW - 1))); // 表明该节点是单词的结尾, endNodes[p/bitW]^(1<<n)是对n位取反, 后面的p&#x26;63为:当取余的除数为2^n时,可以用p&#x26;(k-1)代替,也就是p&#x26;63}vector<string> trieFind(const std::string &#x26;text) { // 查找一个单词    int p = 0;                                     // 从根节点开始找    vector<string> rev;                            // 所有匹配到的串    string re;    for (char each: text) { // 循环每一个字符        while (true) {            if (p == 0) re = &#x22;&#x22;;            if (nodes[p][each - &#x27;a&#x27;] != 0) { // 如果对应字符的边存在,就移动到那个子节点                p = nodes[p][each - &#x27;a&#x27;];                re += each;                if ((endNodes[p / bitW] >> (p &#x26; (bitW - 1))) &#x26; 1) { // 如果最后一个节点是单词结束就代表匹配,p&#x26;63=p%bitW,(endNodes[p/bitW]>>n)&#x26;1是取第n位的数据                    rev.push_back(re);                    p = fail[p] - 1;                    if(re.length() > 1)                        re = re.substr(1);                }                break;            } else {                if (fail[p] == 0) break;                p = fail[p] - 1; // 否则转移(因为fail是从1开始的所以减一)                if(re.length() > 1)                    re = re.substr(1);            }        }    }    if ((endNodes[p / bitW] >> (p &#x26; (bitW - 1))) &#x26; 1) { // 如果节点是匹配结束节点        rev.push_back(re);    }    return rev;}string printVector(vector<string> t) {    string re;    for (auto &#x26;i: t)        re += i + &#x22; &#x22;;    return re;}int main() {    trieAdd(&#x22;aaaaaa&#x22;);    trieAdd(&#x22;bbbbbb&#x22;);    trieAdd(&#x22;ababab&#x22;);    trieAdd(&#x22;cacsafasfasfsgefacsdcewg&#x22;);    trieFail();    cout << &#x22;节点数:&#x22; + to_string(now) << endl;    cout << printVector(trieFind(&#x22;aaaaaaabbbbbbbbbacacsafasfasfsgefacsdcewgbaabcaaaaaaabbbbbbbbbbbbabbbbbbbbbbbbaav&#x22;)) << endl;    for (int i = 0; i < s; i++)        cout << i << &#x22; &#x22;;    cout << endl;    for (auto a: fail)        cout << a - 1 << &#x22; &#x22;;    return 0;}"><div></div></button></div></figure></div>
<h2 id="4-可视化扩展"><a class="not-prose" href="#4-可视化扩展">4. 可视化扩展</a></h2>
<p>可以通过python的<a href="https://pypi.org/project/visual-automata/" rel="noreferrer noopener" target="_blank">visual-automata</a>来画</p>
<h3 id="41-cpp-更改"><a class="not-prose" href="#41-cpp-更改">4.1 cpp 更改</a></h3>
<p>这部分就不考虑优化了(
先声明一个<code>vector&#x3C;int> final;</code>储存最终节点
然后在triedAdd方法push_back</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:159ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">void</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">trieAdd</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">const</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">std</span><span style="--0:#E1E4E8;--1:#24292E">::</span><span style="--0:#B392F0;--1:#6F42C1">string</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#FFAB70;--1:#AE4B07">text</span><span style="--0:#E1E4E8;--1:#24292E">) {</span><span style="--0:#99A0A6;--1:#616972">   // 插入单词</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972">                            // 当前插入到哪个节点, 一开始从根节点开始</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#F97583;--1:#BF3441">char</span><span style="--0:#E1E4E8;--1:#24292E"> each: text) {</span><span style="--0:#99A0A6;--1:#616972">               // 循环每个字符</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> (nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">)</span><span style="--0:#99A0A6;--1:#616972">    // 如果没有对应的字符节点就新建一个</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> now</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">;</span><span style="--0:#99A0A6;--1:#616972"> // 存入对应字符节点的下标</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">p </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[p][each </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">];</span><span style="--0:#99A0A6;--1:#616972">         // 把目前插入到的节点指向到对应字符的子节点</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">final.</span><span style="--0:#B392F0;--1:#6F42C1">push_back</span><span style="--0:#E1E4E8;--1:#24292E">(p);</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> endNodes[p </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> bitW] </span><span style="--0:#F97583;--1:#BF3441">^</span><span style="--0:#E1E4E8;--1:#24292E"> (</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> (p </span><span style="--0:#F97583;--1:#BF3441">&#x26;</span><span style="--0:#E1E4E8;--1:#24292E"> (bitW </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)));</span><span style="--0:#99A0A6;--1:#616972"> // 表明该节点是单词的结尾, endNodes[p/bitW]^(1&#x3C;&#x3C;n)是对n位取反, 后面的p&#x26;63为:当取余的除数为2^n时,可以用p&#x26;(k-1)代替,也就是p&#x26;63</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void trieAdd(const std::string &#x26;text) {   // 插入单词    int p = 0;                            // 当前插入到哪个节点, 一开始从根节点开始    for (char each: text) {               // 循环每个字符        if (nodes[p][each - &#x27;a&#x27;] == 0)    // 如果没有对应的字符节点就新建一个            nodes[p][each - &#x27;a&#x27;] = now++; // 存入对应字符节点的下标        p = nodes[p][each - &#x27;a&#x27;];         // 把目前插入到的节点指向到对应字符的子节点    }    final.push_back(p);    endNodes[p / bitW] = endNodes[p / bitW] ^ (1 << (p &#x26; (bitW - 1))); // 表明该节点是单词的结尾, endNodes[p/bitW]^(1<<n)是对n位取反, 后面的p&#x26;63为:当取余的除数为2^n时,可以用p&#x26;(k-1)代替,也就是p&#x26;63}"><div></div></button></div></figure></div>
<p>要在main方法调用后</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="cpp" class="wrap" style="--ecMaxLine:37ch"><code><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span class="indent">  </span><span style="--0:#B392F0;--1:#6F42C1">nlohmann</span><span style="--0:#E1E4E8;--1:#24292E">::json j;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">; i </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> now;i</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">int</span><span style="--0:#E1E4E8;--1:#24292E"> a </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">; a </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">26</span><span style="--0:#E1E4E8;--1:#24292E">; a </span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">j[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">][i][a] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> nodes[i][a];</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">j[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> fail;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">j[</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">final</span><span style="--0:#E1E4E8;--1:#24292E">;</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">cout</span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E">endl</span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E">j.</span><span style="--0:#B392F0;--1:#6F42C1">dump</span><span style="--0:#E1E4E8;--1:#24292E">();</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="  nlohmann::json j;    for(int i = 0; i < now;i++)        for(int a = 0; a < 26; a ++)            j[0][i][a] = nodes[i][a];    j[1] = fail;    j[2] = final;    cout<<endl<<j.dump();"><div></div></button></div></figure></div>
<p>就可以拿到json格式的转换表</p>
<h3 id="42-python"><a class="not-prose" href="#42-python">4.2 python</a></h3>
<p>先根据<a href="https://pypi.org/project/visual-automata/#prerequisites" rel="noreferrer noopener" target="_blank">pypi</a>里的安装依赖, 然后把上面的json数据复制到下面代码里的<code>jsonData</code>然后运行就可以了</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:2440ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#!/usr/bin/python</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># author: Eritque arcus</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> json</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> visual_automata.fa.nfa </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> VisualNFA</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">jsonData </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"[[[1,7,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,0,0,0,0,0,0,0],[22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,23,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0],[0,0,0,0,0,26,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[27,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,0,0,0,0,0,0,0],[0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,0,0,0,0,0,0,0],[0,0,0,0,0,0,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[34,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,0,0,0],[0,0,0,37,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,39,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,0,0,0],[0,0,0,0,0,0,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[0,1,2,3,4,5,6,1,8,9,10,11,12,8,2,14,15,16,1,2,19,1,2,1,2,1,1,2,1,1,1,1,1,1,2,19,1,1,19,1,1,1,0,0,0,0,0,0,0,0],[6,12,17,41]]"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">a </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> json.loads(jsonData)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">t </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> {}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> j </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(a[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">])):</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">it </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> {}  </span><span style="--0:#99A0A6;--1:#616972"># inside transition</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(a[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">][j])):</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> a[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">][j][i] </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">it[</span><span style="--0:#79B8FF;--1:#005CC5">chr</span><span style="--0:#E1E4E8;--1:#24292E">(i </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">ord</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">))] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> {</span><span style="--0:#9ECBFF;--1:#032F62">"q"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(a[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">][j][i])}</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> a[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">][j] </span><span style="--0:#F97583;--1:#BF3441">></span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">it[</span><span style="--0:#9ECBFF;--1:#032F62">"fail"</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> {</span><span style="--0:#9ECBFF;--1:#032F62">"q"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(a[</span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">][j] </span><span style="--0:#F97583;--1:#BF3441">-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span><span style="--0:#E1E4E8;--1:#24292E">)}</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">t[</span><span style="--0:#9ECBFF;--1:#032F62">"q"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(j)] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> it</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">inputS </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">set</span><span style="--0:#E1E4E8;--1:#24292E">([</span><span style="--0:#79B8FF;--1:#005CC5">chr</span><span style="--0:#E1E4E8;--1:#24292E">(b </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">ord</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">'a'</span><span style="--0:#E1E4E8;--1:#24292E">)) </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> b </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">26</span><span style="--0:#E1E4E8;--1:#24292E">)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">inputS.add(</span><span style="--0:#9ECBFF;--1:#032F62">"fail"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">nfa </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> VisualNFA(</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#FFAB70;--1:#AE4B07">states</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">set</span><span style="--0:#E1E4E8;--1:#24292E">([</span><span style="--0:#9ECBFF;--1:#032F62">"q"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(b) </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> b </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">range</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">len</span><span style="--0:#E1E4E8;--1:#24292E">(a[</span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">]))]),</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#FFAB70;--1:#AE4B07">input_symbols</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">inputS,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#FFAB70;--1:#AE4B07">transitions</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">t,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#FFAB70;--1:#AE4B07">initial_state</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"q0"</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#FFAB70;--1:#AE4B07">final_states</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">set</span><span style="--0:#E1E4E8;--1:#24292E">([</span><span style="--0:#9ECBFF;--1:#032F62">"q"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">(b) </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> b </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> a[</span><span style="--0:#79B8FF;--1:#005CC5">2</span><span style="--0:#E1E4E8;--1:#24292E">]])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">nfa.show_diagram(</span><span style="--0:#FFAB70;--1:#AE4B07">view</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">True</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/python# author: Eritque arcusimport jsonfrom visual_automata.fa.nfa import VisualNFAjsonData = &#x22;[[[1,7,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,0,0,0,0,0,0,0],[22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,23,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,0,0,0],[0,0,0,0,0,26,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[27,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,0,0,0,0,0,0,0],[0,0,0,0,0,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30,0,0,0,0,0,0,0],[0,0,0,0,0,0,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[34,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,0,0,0],[0,0,0,37,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,39,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,0,0,0],[0,0,0,0,0,0,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],[0,1,2,3,4,5,6,1,8,9,10,11,12,8,2,14,15,16,1,2,19,1,2,1,2,1,1,2,1,1,1,1,1,1,2,19,1,1,19,1,1,1,0,0,0,0,0,0,0,0],[6,12,17,41]]&#x22;a = json.loads(jsonData)t = {}for j in range(len(a[0])):    it = {}  # inside transition    for i in range(len(a[0][j])):        if a[0][j][i] != 0:            it[chr(i + ord(&#x27;a&#x27;))] = {&#x22;q&#x22; + str(a[0][j][i])}            if a[1][j] > 0:                it[&#x22;fail&#x22;] = {&#x22;q&#x22; + str(a[1][j] - 1)}    t[&#x22;q&#x22; + str(j)] = itinputS = set([chr(b + ord(&#x27;a&#x27;)) for b in range(26)])inputS.add(&#x22;fail&#x22;)nfa = VisualNFA(    states=set([&#x22;q&#x22; + str(b) for b in range(len(a[0]))]),    input_symbols=inputS,    transitions=t,    initial_state=&#x22;q0&#x22;,    final_states=set([&#x22;q&#x22; + str(b) for b in a[2]]))nfa.show_diagram(view=True)"><div></div></button></div></figure></div>
<p>这里用nfa而不是dfa是因为dfa画起来线太多很乱, 因为每个点有26根可能的线, 所以就把失配位置用<code>fail</code>线指向</p>
<h3 id="43-效果"><a class="not-prose" href="#43-效果">4.3 效果</a></h3>
<img src="/images/aho-corasick-automaton-(AC%E8%87%AA%E5%8A%A8%E6%9C%BA)%E7%9A%84%E7%90%86%E8%A7%A3.md-0.png" alt="nfa">
<center>end</center>   </div> </div> </article> <button class="hover:border-link fixed end-4 bottom-8 z-90 flex h-10 w-10 translate-y-28 cursor-pointer items-center justify-center rounded-full border-2 border-transparent bg-zinc-200 text-3xl opacity-0 transition-all transition-discrete duration-300 data-[show=true]:translate-y-0 data-[show=true]:opacity-100 sm:end-8 sm:h-12 sm:w-12 dark:bg-zinc-700" data-show="false" id="to-top-btn"> <span class="sr-only">Back to top</span> <svg aria-hidden="true" class="h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M4.5 15.75l7.5-7.5 7.5 7.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button>  </main> <footer class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pt-20 pb-4 text-center align-top font-semibold text-gray-600 sm:flex-row sm:justify-between sm:text-xs dark:text-gray-400"> <div class="me-0 text-neutral-400 sm:me-4">
&copy; <span class="text-accent">Eritque Arcus</span> 2020-2025.<br> <span>Powered by <a href="https://astro.build" class="hover:text-gray-700 dark:hover:text-gray-200">Astro</a> | <a href="https://github.com/chrismwilliams/astro-theme-cactus" class="hover:text-gray-700 dark:hover:text-gray-200">cactus</a></span><br> <a href="https://icp.gov.moe/?keyword=20222242" class="flex justify-center gap-1 text-xs hover:text-gray-700 dark:hover:text-gray-200"> <img src="/images/moe-icon120.png" class="h-4 w-4" alt="萌ICP备图标">
萌ICP备20222242号
</a> </div> <nav aria-labelledby="footer_links" class="flex flex-wrap gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500"> <p id="footer_links" class="sr-only">More on this site</p> <a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/archive/"> Archive </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/about/"> About </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/math-notes/"> Notes </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/ctf-cheatsheet/"> CTF-QuickRef </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/music/"> Music </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://photos.ikuyo.dev"> Photos </a> <a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://www.travellings.cn/go.html"> 开往 </a> </nav> <script defer src="https://4-um4m1.ikuyo.dev/script.js" data-website-id="34e0a647-a8e8-40a8-ad62-742e9d604413" data-domains="ikuyo.dev"></script> <script type="text/javascript">
		(() => {
			const name = "outbound-link-click";
			document.querySelectorAll("a").forEach((a) => {
				if (a.host !== window.location.host && !a.getAttribute("data-umami-event")) {
					a.setAttribute("data-umami-event", name);
					a.setAttribute("data-umami-event-url", a.href);
				}
			});
		})();
	</script> </footer> </body></html> <script type="module">const e=document.getElementById("to-top-btn"),n=document.getElementById("blog-hero");function c(t){t.forEach(o=>{e.dataset.show=(!o.isIntersecting).toString()})}e.addEventListener("click",()=>{document.documentElement.scrollTo({behavior:"smooth",top:0})});const r=new IntersectionObserver(c);r.observe(n);</script>