<!DOCTYPE html><html class="scroll-smooth" lang="zh-CN"> <head><meta charset="utf-8"><meta content="width=device-width, initial-scale=1.0" name="viewport"><title>python 用 pyhidra 调用 Ghidra 执行二进制 static analysis • Eritque Arcus</title><link rel="icon" href="/favicon.png" type="image/png"><link href="/manifest.webmanifest" rel="manifest"><link href="https://ikuyo.dev/2023/12/04/python-pyhidra-static-analysis/" rel="canonical"><meta content="python 用 pyhidra 调用 Ghidra 执行二进制 static analysis • Eritque Arcus" name="title"><meta content="## 0. Prep1. 安装 `ghidra` `pacman -S ghidra`i. 写入 `ghidra` 的" name="description"><meta content="Eritque Arcus" name="author"><meta content="article" property="og:type"><meta content="python 用 pyhidra 调用 Ghidra 执行二进制 static analysis" property="og:title"><meta content="## 0. Prep1. 安装 `ghidra` `pacman -S ghidra`i. 写入 `ghidra` 的" property="og:description"><meta content="https://ikuyo.dev/2023/12/04/python-pyhidra-static-analysis/" property="og:url"><meta content="Eritque Arcus" property="og:site_name"><meta content="zh_CN" property="og:locale"><meta content="1200" property="og:image:width"><meta content="630" property="og:image:height"><meta content="Eritque Arcus" property="article:author"><meta content="2023-12-04T23:30:35.000Z" property="article:published_time"><meta content="summary_large_image" property="twitter:card"><meta content="https://ikuyo.dev/2023/12/04/python-pyhidra-static-analysis/" property="twitter:url"><meta content="python 用 pyhidra 调用 Ghidra 执行二进制 static analysis" property="twitter:title"><meta content="## 0. Prep1. 安装 `ghidra` `pacman -S ghidra`i. 写入 `ghidra` 的" property="twitter:description"><link href="/sitemap-index.xml" rel="sitemap"><link href="/rss.xml" title="Blog" rel="alternate" type="application/rss+xml"><link href="/notes/rss.xml" title="Notes" rel="alternate" type="application/rss+xml"><link href="https://webmention.io/ikuyo.dev/webmention" rel="webmention"><meta content="Astro v5.13.2" name="generator"><link href="https://github.com/Nambers" rel="me"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="anonymous" data-unfont><link rel="preload" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?family=Major Mono Display&family=Space Grotesk&family=Noto Sans SC&family=LXGW WenKai Mono TC&display=swap" data-unfont><style>@font-face{font-family:Iosevka Etoile;font-style:normal;font-display:swap;font-weight:400;src:url(/_astro/iosevka-etoile-latin-400-normal.CbciBTy_.woff2) format("woff2"),url(/_astro/iosevka-etoile-latin-400-normal.BsCJFtHE.woff) format("woff")}
</style>
<link rel="stylesheet" href="/_astro/_page_.WatadrwL.css"><script type="module" src="/_astro/page.V2R8AmkL.js"></script></head> <body class="bg-global-bg text-global-text mx-auto flex min-h-screen max-w-7xl flex-col px-4 pt-16 text-sm font-normal antialiased sm:px-8"> <script>
	const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

	function getUserPref() {
		const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		return storedTheme || (lightModePref.matches ? "light" : "dark");
	}

	function setTheme(newTheme) {
		if (newTheme !== "light" && newTheme !== "dark") {
			return console.warn(
				`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
			);
		}

		const root = document.documentElement;

		// root already set to newTheme, exit early
		if (newTheme === root.getAttribute("data-theme")) {
			return;
		}

		root.setAttribute("data-theme", newTheme);

		if (typeof localStorage !== "undefined") {
			localStorage.setItem("theme", newTheme);
		}
	}

	// initial setup
	setTheme(getUserPref());

	// View Transitions hook to restore theme
	document.addEventListener("astro:after-swap", () => setTheme(getUserPref()));

	// listen for theme-change custom event, fired in src/components/ThemeToggle.astro
	document.addEventListener("theme-change", (e) => {
		setTheme(e.detail.theme);
	});

	// listen for prefers-color-scheme change.
	lightModePref.addEventListener("change", (e) => setTheme(e.matches ? "light" : "dark"));
</script> <a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">skip to content
</a> <header class="group relative mb-28 flex w-full items-center sm:ps-20" id="main-header"> <div class="flex w-full sm:flex-col"> <div class="flex w-full items-center sm:relative sm:inline-block"> <a aria-current="false" class="inline-flex items-center sm:relative sm:inline-block" href="/"> <img src="/avatar.png" alt="Avatar" class="me-3 h-16 w-16 rounded-full sm:absolute sm:-start-18 sm:me-0 sm:h-16 sm:w-16"> <span class="font-display text-accent ps-3 text-4xl font-bold tracking-wide whitespace-nowrap dark:drop-shadow-[0_0_2px_white] dark:drop-shadow-[0_0_4px_cyan] dark:drop-shadow-[0_0_8px_cyan] dark:drop-shadow-[0_0_16px_rgba(0,255,255,0.5)]"> Eritque Arcus </span> </a> </div> <nav aria-label="Main menu" class="bg-global-bg/85 absolute -inset-x-4 top-14 hidden w-full flex-col items-end gap-y-4 rounded-md py-4 shadow backdrop-blur-sm group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:rounded-none sm:bg-transparent sm:py-0 sm:ps-4 sm:shadow-none sm:backdrop-blur-none" id="navigation-menu"> <div class="text-accent sm:divide-accent sm:divide-x"> <a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/archive/"> Archive </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/about/"> About </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/math-notes/"> Notes </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/friends/"> Friends </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/ctf-cheatsheet/"> CTF-QuickRef </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="/music/"> Music </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="https://photos.ikuyo.dev"> Photos </a><a aria-current="false" class="px-2 py-2 underline-offset-2 hover:underline sm:py-0" data-astro-prefetch href="https://www.travellings.cn/go.html"> 开往 </a> </div> <div class="flex sm:ps-28"> <site-search class="ms-auto" id="search"> <button class="hover:text-accent flex h-9 w-9 cursor-pointer items-center justify-center rounded-md" aria-keyshortcuts="Control+K Meta+K" data-open-modal disabled> <svg aria-hidden="true" class="h-7 w-7" fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" stroke="none"></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6"></path> </svg> <span class="sr-only">Open Search</span> </button> <dialog aria-label="search" class="bg-global-bg h-full max-h-full w-full max-w-full border border-zinc-400 shadow-sm backdrop:backdrop-blur-sm open:flex sm:mx-auto sm:mt-16 sm:mb-auto sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md"> <div class="dialog-frame flex grow flex-col gap-4 p-6 pt-12 sm:pt-6"> <button class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700" data-close-modal>Close</button> <div class="search-container"> <div id="cactus__search"></div> </div> </div> </dialog> </site-search> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.fEYUxNp8.js"></script> <theme-toggle class="ms-2 sm:ms-4"> <button class="hover:text-accent relative h-9 w-9 cursor-pointer rounded-md p-2" type="button"> <span class="sr-only">Dark Theme</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0" fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100" fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path> <path d="M19 11h2m-1 -1v2"></path> </svg> </button> </theme-toggle> <script type="module" src="/_astro/ThemeToggle.astro_astro_type_script_index_0_lang.C1tldoqx.js"></script> </div> </nav> </div> <mobile-button class="mb-15"> <button aria-expanded="false" aria-haspopup="menu" class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button"> <span class="sr-only">Open main menu</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0" fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="text-accent absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100" class="text-accent" fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button> </mobile-button> </header> <script type="module" src="/_astro/Header.astro_astro_type_script_index_0_lang.DuSsDY4R.js"></script> <main id="main">  <article class="grow break-words" data-pagefind-body> <div id="blog-hero" class="mb-12"><h1 class="title"> python 用 pyhidra 调用 Ghidra 执行二进制 static analysis </h1> <div class="flex flex-wrap items-center gap-x-3 gap-y-2"> <p class="font-semibold"> <time datetime="2023-12-04T23:30:35.000Z" title="2023-12-04T23:30:35.000Z">4 December 2023</time> /  6 min read </p>  </div> <div class="mt-2"> <svg aria-hidden="true" class="inline-block h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:python" href="/tags/python/"><span class="sr-only">View more blogs with the tag&nbsp;</span>python </a>,  </span> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:pyhidra" href="/tags/pyhidra/"><span class="sr-only">View more blogs with the tag&nbsp;</span>pyhidra </a>,  </span> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:ghidra" href="/tags/ghidra/"><span class="sr-only">View more blogs with the tag&nbsp;</span>ghidra </a>,  </span> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:reverse" href="/tags/reverse/"><span class="sr-only">View more blogs with the tag&nbsp;</span>reverse </a>,  </span> <span class="contents"> <a class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag:static analysis" href="/tags/static analysis/"><span class="sr-only">View more blogs with the tag&nbsp;</span>static analysis </a> </span>  </div></div> <div class="grid grid-cols-[1fr_auto] gap-10 lg:flex-row lg:items-start"> <details open class="lg:sticky lg:top-12 lg:order-2 lg:-me-32 lg:basis-64"> <summary class="title hover:marker:text-accent cursor-pointer text-lg">Table of Contents</summary> <nav class="ms-4 lg:w-full"> <ol class="mt-4"> <li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#0-prep"><span aria-hidden="true" class="me-0.5">#</span>0. Prep</a>  </li><li class> <a class="line-clamp-2 hover:text-accent mt-3" href="#1-usage"><span aria-hidden="true" class="me-0.5">#</span>1. Usage</a> <ol> <li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#10-helper-tools"><span aria-hidden="true" class="me-0.5">#</span>1.0 Helper Tools</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#11-基础用法"><span aria-hidden="true" class="me-0.5">#</span>1.1 基础用法</a>  </li><li class="ms-2"> <a class="line-clamp-2 hover:text-accent mt-2 text-xs" href="#12-取-callee-依赖方法"><span aria-hidden="true" class="me-0.5">#</span>1.2 取 Callee 依赖方法</a>  </li> </ol> </li> </ol> </nav> </details> <div class="prose max-w-none prose-base prose-code:font-normal prose-headings:font-semibold prose-headings:text-accent-2 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-gray-600 prose-headings:hover:before:text-accent sm:prose-headings:before:content-['#'] sm:prose-th:before:content-none">  <h2 id="0-prep"><a class="not-prose" href="#0-prep">0. Prep</a></h2>
<ol>
<li>安装 <code>ghidra</code> <code>pacman -S ghidra</code>
i. 写入 <code>ghidra</code> 的环境变量 <code>echo "export GHIDRA_INSTALL_DIR=/opt/ghidra" >> ~/.zshrc</code> (视情况而定)</li>
<li>安装 <a href="https://pypi.org/project/pyhidra/" rel="noreferrer noopener" target="_blank"><code>pyhidra</code></a> <code>pip install pyhidra</code></li>
<li>[Optional] 安装 <a href="https://pypi.org/project/ghidra-stubs/" rel="noreferrer noopener" target="_blank"><code>ghidra-stub</code></a> <code>pip install ghidra-stub</code></li>
</ol>
<h2 id="1-usage"><a class="not-prose" href="#1-usage">1. Usage</a></h2>
<h3 id="10-helper-tools"><a class="not-prose" href="#10-helper-tools">1.0 Helper Tools</a></h3>
<p>我对 <code>pyhidra</code> 中的实现做了一些更改:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.6e9qs.css"><script type="module" src="/_astro/ec.p1z7b.js"></script><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:114ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> helper </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">FAIL</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> traceback</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> atexit</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> config </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_BASE</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># this file is a modified version pyhidra.core.open_program and pyhidra.core._setup_project</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># original credit for pyhidra</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> contextlib</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> pathlib </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Path</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> typing </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Union, ContextManager</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> pyhidra.core </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> _analyze_program, _get_compiler_spec, _get_language</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> pyhidra.converters </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">*</span><span style="--0:#E1E4E8;--1:#24292E">  </span><span style="--0:#99A0A6;--1:#616972"># pylint: disable=wildcard-import, unused-wildcard-import</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.base.project </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> GhidraProject</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> typing </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Union, Tuple, ContextManager</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.program.model.listing </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Program</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">_project: GhidraProject </span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">_program_pool: dict[</span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Program"</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> {}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">_setup_project2</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">binary_path: Union[</span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">, Path],</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">language: </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">compiler: </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">) -> Tuple[</span><span style="--0:#9ECBFF;--1:#032F62">"GhidraProject"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Program"</span><span style="--0:#E1E4E8;--1:#24292E">]:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> java.io </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> IOException</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">global</span><span style="--0:#E1E4E8;--1:#24292E"> _project</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">assert</span><span style="--0:#E1E4E8;--1:#24292E"> _project </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> binary_path </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">binary_path </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> Path(binary_path)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># Open/Create project</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">program: </span><span style="--0:#9ECBFF;--1:#032F62">"Program"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">project </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> _project</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> binary_path </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># if project.getRootFolder().getFile(binary_path.name): # since this not works</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">try</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.openProgram(</span><span style="--0:#9ECBFF;--1:#032F62">"/"</span><span style="--0:#E1E4E8;--1:#24292E">, binary_path.name, </span><span style="--0:#79B8FF;--1:#005CC5">False</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">except</span><span style="--0:#E1E4E8;--1:#24292E"> IOException:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">pass</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> binary_path </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">and</span><span style="--0:#E1E4E8;--1:#24292E"> program </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> language </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.importProgram(binary_path) </span><span style="--0:#99A0A6;--1:#616972"># type: ignore</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> program </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">raise</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">RuntimeError</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"Ghidra failed to import '</span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">binary_path</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">'. Try providing a language manually."</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">lang </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> _get_language(language)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">comp </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> _get_compiler_spec(lang, compiler) </span><span style="--0:#99A0A6;--1:#616972"># type: ignore</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.importProgram(binary_path, lang, comp) </span><span style="--0:#99A0A6;--1:#616972"># type: ignore</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> program </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">message </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"Ghidra failed to import '</span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">binary_path</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">'. "</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> compiler:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">message </span><span style="--0:#F97583;--1:#BF3441">+=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"The provided language/compiler pair (</span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">language</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62"> / </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">compiler</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">) may be invalid."</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">message </span><span style="--0:#F97583;--1:#BF3441">+=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"The provided language (</span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">language</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">) may be invalid."</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">raise</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">ValueError</span><span style="--0:#E1E4E8;--1:#24292E">(message)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project.saveAs(program, </span><span style="--0:#9ECBFF;--1:#032F62">"/"</span><span style="--0:#E1E4E8;--1:#24292E">, binary_path.name, </span><span style="--0:#79B8FF;--1:#005CC5">False</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#99A0A6;--1:#616972"># True to False</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">assert</span><span style="--0:#E1E4E8;--1:#24292E"> program </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> program </span><span style="--0:#99A0A6;--1:#616972"># type: ignore</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">_setup_project</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">binary_path: Union[</span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">, Path],</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project_location: Union[</span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">, Path] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project_name: </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">language: </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">compiler: </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">) -> Tuple[</span><span style="--0:#9ECBFF;--1:#032F62">"GhidraProject"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#9ECBFF;--1:#032F62">"Program"</span><span style="--0:#E1E4E8;--1:#24292E">]:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.base.project </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> GhidraProject</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> java.io </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> IOException</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> binary_path </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">binary_path </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> Path(binary_path)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> project_location:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project_location </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> Path(project_location)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project_location </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> binary_path.parent</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> project_name:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project_name </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">binary_path.name</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">_ghidra"</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">project_location </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project_location </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> project_name</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">project_location.mkdir(</span><span style="--0:#FFAB70;--1:#AE4B07">exist_ok</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">True</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#FFAB70;--1:#AE4B07">parents</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">True</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># Open/Create project</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">program: </span><span style="--0:#9ECBFF;--1:#032F62">"Program"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">try</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> GhidraProject.openProject(project_location, project_name, </span><span style="--0:#79B8FF;--1:#005CC5">True</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> binary_path </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972"># if project.getRootFolder().getFile(binary_path.name): # since this not works</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.openProgram(</span><span style="--0:#9ECBFF;--1:#032F62">"/"</span><span style="--0:#E1E4E8;--1:#24292E">, binary_path.name, </span><span style="--0:#79B8FF;--1:#005CC5">False</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">except</span><span style="--0:#E1E4E8;--1:#24292E"> IOException:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> GhidraProject.createProject(project_location, project_name, </span><span style="--0:#79B8FF;--1:#005CC5">False</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> binary_path </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">and</span><span style="--0:#E1E4E8;--1:#24292E"> program </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> language </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.importProgram(binary_path)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> program </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">raise</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">RuntimeError</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"Ghidra failed to import '</span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">binary_path</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">'. Try providing a language manually."</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">lang </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> _get_language(language)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">comp </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> _get_compiler_spec(lang, compiler)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project.importProgram(binary_path, lang, comp)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> program </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">message </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"Ghidra failed to import '</span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">binary_path</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">'. "</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> compiler:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">message </span><span style="--0:#F97583;--1:#BF3441">+=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"The provided language/compiler pair (</span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">language</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62"> / </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">compiler</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">) may be invalid."</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                    </span></span><span style="--0:#E1E4E8;--1:#24292E">message </span><span style="--0:#F97583;--1:#BF3441">+=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"The provided language (</span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">language</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">) may be invalid."</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">raise</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">ValueError</span><span style="--0:#E1E4E8;--1:#24292E">(message)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project.saveAs(program, </span><span style="--0:#9ECBFF;--1:#032F62">"/"</span><span style="--0:#E1E4E8;--1:#24292E">, binary_path.name, </span><span style="--0:#79B8FF;--1:#005CC5">False</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#99A0A6;--1:#616972"># True to False</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> project, program</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">@contextlib.contextmanager</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">open_program</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">116</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">binary_path: Path,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">117</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project_location: Union[</span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">, Path] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">118</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">project_name: </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">119</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">analyze</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">True</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">120</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">language: </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">121</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">compiler: </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">122</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">) -> ContextManager[</span><span style="--0:#9ECBFF;--1:#032F62">"FlatProgramAPI"</span><span style="--0:#E1E4E8;--1:#24292E">]:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">123</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">124</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">Opens given binary path in Ghidra and returns FlatProgramAPI object.</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">125</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">126</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param binary_path: Path to binary file, may be None.</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">127</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param project_location: Location of Ghidra project to open/create.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">128</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">(Defaults to same directory as binary file)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">129</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param project_name: Name of Ghidra project to open/create.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">130</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">(Defaults to name of binary file suffixed with "_ghidra")</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">131</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param analyze: Whether to run analysis before returning.</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">132</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param language: The LanguageID to use for the program.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">133</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">(Defaults to Ghidra's detected LanguageID)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">134</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param compiler: The CompilerSpecID to use for the program. Requires a provided language.</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">135</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">        </span></span><span style="--0:#9ECBFF;--1:#032F62">(Defaults to the Language's default compiler)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">136</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:return: A Ghidra FlatProgramAPI object.</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">137</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:raises ValueError: If the provided language or compiler is invalid.</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">138</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">"""</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">139</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">global</span><span style="--0:#E1E4E8;--1:#24292E"> _project, _program_pool</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">140</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">141</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> pyhidra.launcher </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> PyhidraLauncher, HeadlessPyhidraLauncher</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">142</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">143</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> PyhidraLauncher.has_launched():</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">144</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">HeadlessPyhidraLauncher().start()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">145</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">146</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.app.script </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> GhidraScriptUtil</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">147</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.program.flatapi </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> FlatProgramAPI</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">148</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">149</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">  _program_pool.get(binary_path.name, </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">150</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> program </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">151</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> _project </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">152</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">project, program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> _setup_project(</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">153</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">binary_path,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">154</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">project_location,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">155</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">project_name,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">156</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">language,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">157</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">compiler</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">158</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">159</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">_project </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> project</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">160</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972"># _project.setDeleteOnClose(True)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">161</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">atexit.register(_project.close)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">162</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">else</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">163</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">program </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> _setup_project2(</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">164</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">binary_path,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">165</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">language,</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">166</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">compiler</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">167</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">168</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">_program_pool[binary_path.name] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> program</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">169</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">GhidraScriptUtil.acquireBundleHostReference()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">170</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">171</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">try</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">172</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">flat_api </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> FlatProgramAPI(program)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">173</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">174</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> analyze:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">175</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">_analyze_program(flat_api, program)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">176</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">177</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># change base address</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">178</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">base_addr </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> flat_api.toAddr(</span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_BASE</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">179</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> flat_api.currentProgram.getImageBase() </span><span style="--0:#F97583;--1:#BF3441">!=</span><span style="--0:#E1E4E8;--1:#24292E"> base_addr:</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">180</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">flat_api.currentProgram.setImageBase(base_addr, </span><span style="--0:#79B8FF;--1:#005CC5">False</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">181</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">assert</span><span style="--0:#E1E4E8;--1:#24292E"> flat_api.currentProgram.getImageBase() </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> base_addr</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">182</div></div><div class="code">
</div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">183</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">yield</span><span style="--0:#E1E4E8;--1:#24292E"> flat_api</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">184</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">except</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">Exception</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> e:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">185</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">FAIL(</span><span style="--0:#9ECBFF;--1:#032F62">"--- Error while opening program:"</span><span style="--0:#E1E4E8;--1:#24292E">, e)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">186</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">FAIL(</span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"binary </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">binary_path</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62"> in </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">project_location</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">187</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">traceback.print_exc()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">188</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">finally</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">189</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">GhidraScriptUtil.releaseBundleHostReference()</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">190</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># project.save(program)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">191</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># project.close()</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="from helper import FAILimport tracebackimport atexitfrom config import GHIDRA_BASE# this file is a modified version pyhidra.core.open_program and pyhidra.core._setup_project# original credit for pyhidraimport contextlibfrom pathlib import Pathfrom typing import Union, ContextManagerfrom pyhidra.core import _analyze_program, _get_compiler_spec, _get_languagefrom pyhidra.converters import *  # pylint: disable=wildcard-import, unused-wildcard-importfrom ghidra.base.project import GhidraProjectfrom typing import Union, Tuple, ContextManagerfrom ghidra.program.model.listing import Program_project: GhidraProject | None = None_program_pool: dict[str, &#x22;Program&#x22;] = {}def _setup_project2(        binary_path: Union[str, Path],        language: str | None = None,        compiler: str | None = None) -> Tuple[&#x22;GhidraProject&#x22;, &#x22;Program&#x22;]:    from java.io import IOException    global _project    assert _project is not None    if binary_path is not None:        binary_path = Path(binary_path)    # Open/Create project    program: &#x22;Program&#x22; | None = None    project = _project    if binary_path is not None:        # if project.getRootFolder().getFile(binary_path.name): # since this not works        try:            program = project.openProgram(&#x22;/&#x22;, binary_path.name, False)        except IOException:            program = None            pass    if binary_path is not None and program is None:        if language is None:            program = project.importProgram(binary_path) # type: ignore            if program is None:                raise RuntimeError(f&#x22;Ghidra failed to import &#x27;{binary_path}&#x27;. Try providing a language manually.&#x22;)        else:            lang = _get_language(language)            comp = _get_compiler_spec(lang, compiler) # type: ignore            program = project.importProgram(binary_path, lang, comp) # type: ignore            if program is None:                message = f&#x22;Ghidra failed to import &#x27;{binary_path}&#x27;. &#x22;                if compiler:                    message += f&#x22;The provided language/compiler pair ({language} / {compiler}) may be invalid.&#x22;                else:                    message += f&#x22;The provided language ({language}) may be invalid.&#x22;                raise ValueError(message)        project.saveAs(program, &#x22;/&#x22;, binary_path.name, False) # True to False    assert program is not None    return program # type: ignoredef _setup_project(        binary_path: Union[str, Path],        project_location: Union[str, Path] = None,        project_name: str = None,        language: str = None,        compiler: str = None) -> Tuple[&#x22;GhidraProject&#x22;, &#x22;Program&#x22;]:    from ghidra.base.project import GhidraProject    from java.io import IOException    if binary_path is not None:        binary_path = Path(binary_path)    if project_location:        project_location = Path(project_location)    else:        project_location = binary_path.parent    if not project_name:        project_name = f&#x22;{binary_path.name}_ghidra&#x22;    project_location = project_location / project_name    project_location.mkdir(exist_ok=True, parents=True)    # Open/Create project    program: &#x22;Program&#x22; = None    try:        project = GhidraProject.openProject(project_location, project_name, True)        if binary_path is not None:            # if project.getRootFolder().getFile(binary_path.name): # since this not works            program = project.openProgram(&#x22;/&#x22;, binary_path.name, False)    except IOException:        project = GhidraProject.createProject(project_location, project_name, False)    if binary_path is not None and program is None:        if language is None:            program = project.importProgram(binary_path)            if program is None:                raise RuntimeError(f&#x22;Ghidra failed to import &#x27;{binary_path}&#x27;. Try providing a language manually.&#x22;)        else:            lang = _get_language(language)            comp = _get_compiler_spec(lang, compiler)            program = project.importProgram(binary_path, lang, comp)            if program is None:                message = f&#x22;Ghidra failed to import &#x27;{binary_path}&#x27;. &#x22;                if compiler:                    message += f&#x22;The provided language/compiler pair ({language} / {compiler}) may be invalid.&#x22;                else:                    message += f&#x22;The provided language ({language}) may be invalid.&#x22;                raise ValueError(message)        project.saveAs(program, &#x22;/&#x22;, binary_path.name, False) # True to False    return project, program@contextlib.contextmanagerdef open_program(        binary_path: Path,        project_location: Union[str, Path] = None,        project_name: str = None,        analyze=True,        language: str = None,        compiler: str = None,) -> ContextManager[&#x22;FlatProgramAPI&#x22;]:    &#x22;&#x22;&#x22;    Opens given binary path in Ghidra and returns FlatProgramAPI object.    :param binary_path: Path to binary file, may be None.    :param project_location: Location of Ghidra project to open/create.        (Defaults to same directory as binary file)    :param project_name: Name of Ghidra project to open/create.        (Defaults to name of binary file suffixed with &#x22;_ghidra&#x22;)    :param analyze: Whether to run analysis before returning.    :param language: The LanguageID to use for the program.        (Defaults to Ghidra&#x27;s detected LanguageID)    :param compiler: The CompilerSpecID to use for the program. Requires a provided language.        (Defaults to the Language&#x27;s default compiler)    :return: A Ghidra FlatProgramAPI object.    :raises ValueError: If the provided language or compiler is invalid.    &#x22;&#x22;&#x22;    global _project, _program_pool    from pyhidra.launcher import PyhidraLauncher, HeadlessPyhidraLauncher    if not PyhidraLauncher.has_launched():        HeadlessPyhidraLauncher().start()    from ghidra.app.script import GhidraScriptUtil    from ghidra.program.flatapi import FlatProgramAPI    program =  _program_pool.get(binary_path.name, None)    if program == None:        if _project == None:            project, program = _setup_project(                binary_path,                project_location,                project_name,                language,                compiler            )            _project = project            # _project.setDeleteOnClose(True)            atexit.register(_project.close)        else:            program = _setup_project2(                binary_path,                language,                compiler            )        _program_pool[binary_path.name] = program    GhidraScriptUtil.acquireBundleHostReference()    try:        flat_api = FlatProgramAPI(program)        if analyze:            _analyze_program(flat_api, program)        # change base address        base_addr = flat_api.toAddr(GHIDRA_BASE)        if flat_api.currentProgram.getImageBase() != base_addr:            flat_api.currentProgram.setImageBase(base_addr, False)        assert flat_api.currentProgram.getImageBase() == base_addr        yield flat_api    except Exception as e:        FAIL(&#x22;--- Error while opening program:&#x22;, e)        FAIL(f&#x22;binary {binary_path} in {project_location}&#x22;)        traceback.print_exc()    finally:        GhidraScriptUtil.releaseBundleHostReference()        # project.save(program)        # project.close()"><div></div></button></div></figure></div>
<h3 id="11-基础用法"><a class="not-prose" href="#11-基础用法">1.1 基础用法</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:96ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> pyhidra</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">pyhidra.start()</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> typing </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">TYPE_CHECKING</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">TYPE_CHECKING</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> pathlib </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Path</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.app.decompiler.flatapi </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> FlatDecompilerAPI</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.program.flatapi </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> FlatProgramAPI</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">DATASET_PATH</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> Path(</span><span style="--0:#9ECBFF;--1:#032F62">"."</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_DIR</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> Path(</span><span style="--0:#9ECBFF;--1:#032F62">"."</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#99A0A6;--1:#616972"># Ghidra project location</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_PROJECT_NAME</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"test"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#99A0A6;--1:#616972"># Ghidra project name</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_BASE</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">0x</span><span style="--0:#79B8FF;--1:#005CC5">400000</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#99A0A6;--1:#616972"># Ghidra base address, used in open_program</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">FUNC_ADDRS</span><span style="--0:#E1E4E8;--1:#24292E">: set[</span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">set</span><span style="--0:#E1E4E8;--1:#24292E">() </span><span style="--0:#99A0A6;--1:#616972"># function addresses in binary (base addr is 0x0 in default)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">with</span><span style="--0:#E1E4E8;--1:#24292E"> open_program(</span><span style="--0:#79B8FF;--1:#005CC5">DATASET_PATH</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">/</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"test.so"</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_DIR</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_PROJECT_NAME</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> f_api:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">f_api: FlatProgramAPI </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> f_api</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">decomp_api </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> FlatDecompilerAPI(f_api)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">listing </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> f_api.currentProgram.getListing()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> target </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">FUNC_ADDRS</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">func </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> f_api.getFunctionAt(f_api.toAddr(</span><span style="--0:#79B8FF;--1:#005CC5">hex</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#79B8FF;--1:#005CC5">int</span><span style="--0:#E1E4E8;--1:#24292E">(target.addr, </span><span style="--0:#79B8FF;--1:#005CC5">16</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">+</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_BASE</span><span style="--0:#E1E4E8;--1:#24292E">)))</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">acode </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> [] </span><span style="--0:#99A0A6;--1:#616972"># assembly code</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> i </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> listing.getCodeUnits(func.getBody(), </span><span style="--0:#79B8FF;--1:#005CC5">True</span><span style="--0:#E1E4E8;--1:#24292E">):</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">acode.append(i.toString())</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">panic_if_not(func </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">not</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"[-] function not found at </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">target.addr</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62"> in </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">bin_name</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">dcode </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> decomp_api.decompile(func, </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E">).strip() </span><span style="--0:#99A0A6;--1:#616972"># decompiled code</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">acode </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">\n</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">.join(acode)</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">print</span><span style="--0:#E1E4E8;--1:#24292E">(dcode, acode, </span><span style="--0:#FFAB70;--1:#AE4B07">sep</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">\n</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import pyhidrapyhidra.start()from typing import TYPE_CHECKINGif TYPE_CHECKING:    import ghidrafrom pathlib import Pathfrom ghidra.app.decompiler.flatapi import FlatDecompilerAPIfrom ghidra.program.flatapi import FlatProgramAPIDATASET_PATH = Path(&#x22;.&#x22;)GHIDRA_DIR = Path(&#x22;.&#x22;) # Ghidra project locationGHIDRA_PROJECT_NAME = &#x22;test&#x22; # Ghidra project nameGHIDRA_BASE = 0x400000 # Ghidra base address, used in open_programFUNC_ADDRS: set[str] = set() # function addresses in binary (base addr is 0x0 in default)with open_program(DATASET_PATH / &#x22;test.so&#x22;, GHIDRA_DIR, GHIDRA_PROJECT_NAME) as f_api:    f_api: FlatProgramAPI = f_api    decomp_api = FlatDecompilerAPI(f_api)    listing = f_api.currentProgram.getListing()    for target in FUNC_ADDRS:        func = f_api.getFunctionAt(f_api.toAddr(hex(int(target.addr, 16) + GHIDRA_BASE)))        acode = [] # assembly code        for i in listing.getCodeUnits(func.getBody(), True):            acode.append(i.toString())        panic_if_not(func is not None, f&#x22;[-] function not found at {target.addr} in {bin_name}&#x22;)        dcode = decomp_api.decompile(func, 0).strip() # decompiled code        acode = &#x22;\n&#x22;.join(acode)        print(dcode, acode, sep=&#x22;\n&#x22;)"><div></div></button></div></figure></div>
<h3 id="12-取-callee-依赖方法"><a class="not-prose" href="#12-取-callee-依赖方法">1.2 取 Callee 依赖方法</a></h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="python" class="wrap" style="--ecMaxLine:123ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> pathlib </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Path</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> binary_search.pyhidra_helper </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> open_program</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> config </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_DIR</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_PROJECT_NAME</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_BASE</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> helper </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">INFO</span><span style="--0:#E1E4E8;--1:#24292E">, panic_if_not, </span><span style="--0:#79B8FF;--1:#005CC5">WARNING</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">OK</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.program.flatapi </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> FlatProgramAPI</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.util.task </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> ConsoleTaskMonitor</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> ghidra.program.model.listing </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> Function</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> tqdm </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> tqdm</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">from</span><span style="--0:#E1E4E8;--1:#24292E"> copy </span><span style="--0:#F97583;--1:#BF3441">import</span><span style="--0:#E1E4E8;--1:#24292E"> copy</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">def</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">search_deps</span><span style="--0:#E1E4E8;--1:#24292E">(function_addrs: set[</span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">], elf: Path) -> set[tuple[</span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">]]:</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#9ECBFF;--1:#032F62">'''</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">Search for dependencies of given functions in given binary.</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param function_addrs: set of function addresses in Ghidra in hex string</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:param elf: path to binary</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">:return: set of function addresses in Ghidra in hex string</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#9ECBFF;--1:#032F62">    </span></span><span style="--0:#9ECBFF;--1:#032F62">'''</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">known_addrs: str[] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> []</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">INFO(</span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"[+] binary searching for deps for </span><span style="--0:#79B8FF;--1:#005CC5">{len</span><span style="--0:#E1E4E8;--1:#24292E">(function_addrs)</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62"> functions in </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">elf</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">panic_if_not(elf.exists(), </span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"[-] </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">elf</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62"> not found"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">funcs: set[tuple[</span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E">]] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">set</span><span style="--0:#E1E4E8;--1:#24292E">()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">monitor </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> ConsoleTaskMonitor()</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">with</span><span style="--0:#E1E4E8;--1:#24292E"> open_program(elf, </span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_DIR</span><span style="--0:#E1E4E8;--1:#24292E">, </span><span style="--0:#79B8FF;--1:#005CC5">GHIDRA_PROJECT_NAME</span><span style="--0:#E1E4E8;--1:#24292E">) </span><span style="--0:#F97583;--1:#BF3441">as</span><span style="--0:#E1E4E8;--1:#24292E"> f_api:</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">f_api: FlatProgramAPI </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> f_api </span><span style="--0:#99A0A6;--1:#616972"># for type hint</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> addr </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> tqdm(function_addrs):</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972"># panic_if_not(int(addr, 16) > GHIDRA_BASE, f"[-] invalid address for Ghidra base {addr} &#x3C; {hex(GHIDRA_BASE)}")</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">func </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> f_api.getFunctionAt(f_api.toAddr(addr))</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> func </span><span style="--0:#F97583;--1:#BF3441">is</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">None</span><span style="--0:#E1E4E8;--1:#24292E">:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">WARNING(</span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"[-] function not found at </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">addr</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62"> in </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">elf</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">continue</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">            </span><span style="--0:#99A0A6;--1:#616972"># find CFG</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">            </span></span><span style="--0:#E1E4E8;--1:#24292E">called_funcs: set[Function] </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> func.getCalledFunctions(monitor)</span></div></div><div class="ec-line" style="--ecIndent:12ch"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">            </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> f </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> called_funcs:</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">addr: </span><span style="--0:#79B8FF;--1:#005CC5">str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> f.getEntryPoint().toString() </span><span style="--0:#99A0A6;--1:#616972"># type: ignore</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">                </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> addr </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> known_addrs:</span></div></div><div class="ec-line" style="--ecIndent:20ch"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F97583;--1:#BF3441">continue</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">known_addrs.add(addr)</span></div></div><div class="ec-line" style="--ecIndent:16ch"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">                </span></span><span style="--0:#E1E4E8;--1:#24292E">funcs.add((f.getName(), addr)) </span><span style="--0:#99A0A6;--1:#616972"># type: ignore</span></div></div><div class="ec-line" style="--ecIndent:8ch"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">OK(</span><span style="--0:#F97583;--1:#BF3441">f</span><span style="--0:#9ECBFF;--1:#032F62">"[+] found </span><span style="--0:#79B8FF;--1:#005CC5">{len</span><span style="--0:#E1E4E8;--1:#24292E">(funcs)</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62"> functions as deps in </span><span style="--0:#79B8FF;--1:#005CC5">{</span><span style="--0:#E1E4E8;--1:#24292E">elf</span><span style="--0:#79B8FF;--1:#005CC5">}</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">return</span><span style="--0:#E1E4E8;--1:#24292E"> funcs</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="from pathlib import Pathfrom binary_search.pyhidra_helper import open_programfrom config import GHIDRA_DIR, GHIDRA_PROJECT_NAME, GHIDRA_BASEfrom helper import INFO, panic_if_not, WARNING, OKfrom ghidra.program.flatapi import FlatProgramAPIfrom ghidra.util.task import ConsoleTaskMonitorfrom ghidra.program.model.listing import Functionfrom tqdm import tqdmfrom copy import copydef search_deps(function_addrs: set[str], elf: Path) -> set[tuple[str, str]]:    &#x27;&#x27;&#x27;    Search for dependencies of given functions in given binary.    :param function_addrs: set of function addresses in Ghidra in hex string    :param elf: path to binary    :return: set of function addresses in Ghidra in hex string    &#x27;&#x27;&#x27;    known_addrs: str[] = []    INFO(f&#x22;[+] binary searching for deps for {len(function_addrs)} functions in {elf}&#x22;)    panic_if_not(elf.exists(), f&#x22;[-] {elf} not found&#x22;)    funcs: set[tuple[str, str]] = set()    monitor = ConsoleTaskMonitor()    with open_program(elf, GHIDRA_DIR, GHIDRA_PROJECT_NAME) as f_api:        f_api: FlatProgramAPI = f_api # for type hint        for addr in tqdm(function_addrs):            # panic_if_not(int(addr, 16) > GHIDRA_BASE, f&#x22;[-] invalid address for Ghidra base {addr} < {hex(GHIDRA_BASE)}&#x22;)            func = f_api.getFunctionAt(f_api.toAddr(addr))            if func is None:                WARNING(f&#x22;[-] function not found at {addr} in {elf}&#x22;)                continue            # find CFG            called_funcs: set[Function] = func.getCalledFunctions(monitor)            for f in called_funcs:                addr: str = f.getEntryPoint().toString() # type: ignore                if addr in known_addrs:                    continue                known_addrs.add(addr)                funcs.add((f.getName(), addr)) # type: ignore        OK(f&#x22;[+] found {len(funcs)} functions as deps in {elf}&#x22;)    return funcs"><div></div></button></div></figure></div>
<center> -EOF- </center>   </div> </div> </article> <button class="hover:border-link fixed end-4 bottom-8 z-90 flex h-10 w-10 translate-y-28 cursor-pointer items-center justify-center rounded-full border-2 border-transparent bg-zinc-200 text-3xl opacity-0 transition-all transition-discrete duration-300 data-[show=true]:translate-y-0 data-[show=true]:opacity-100 sm:end-8 sm:h-12 sm:w-12 dark:bg-zinc-700" data-show="false" id="to-top-btn"> <span class="sr-only">Back to top</span> <svg aria-hidden="true" class="h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M4.5 15.75l7.5-7.5 7.5 7.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button>  </main> <footer class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pt-20 pb-4 text-center align-top font-semibold text-gray-600 sm:flex-row sm:justify-between sm:text-xs dark:text-gray-400"> <div class="me-0 text-neutral-400 sm:me-4">
&copy; <span class="text-accent">Eritque Arcus</span> 2020-2025.<br> <span>Powered by <a href="https://astro.build" class="hover:text-gray-700 dark:hover:text-gray-200">Astro</a> | <a href="https://github.com/chrismwilliams/astro-theme-cactus" class="hover:text-gray-700 dark:hover:text-gray-200">cactus</a></span><br> <a href="https://icp.gov.moe/?keyword=20222242" class="flex justify-center gap-1 text-xs hover:text-gray-700 dark:hover:text-gray-200"> <img src="/images/moe-icon120.png" class="h-4 w-4" alt="萌ICP备图标">
萌ICP备20222242号
</a> </div> <nav aria-labelledby="footer_links" class="flex flex-wrap gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500"> <p id="footer_links" class="sr-only">More on this site</p> <a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/archive/"> Archive </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/about/"> About </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/math-notes/"> Notes </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/friends/"> Friends </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/ctf-cheatsheet/"> CTF-QuickRef </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="/music/"> Music </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://photos.ikuyo.dev"> Photos </a><a class="hover:text-global-text px-4 py-2 hover:underline sm:py-0" href="https://www.travellings.cn/go.html"> 开往 </a> </nav> <script defer src="https://4-um4m1.ikuyo.dev/script.js" data-website-id="34e0a647-a8e8-40a8-ad62-742e9d604413" data-domains="ikuyo.dev"></script> <script type="text/javascript">
		(() => {
			const name = "outbound-link-click";
			document.querySelectorAll("a").forEach((a) => {
				if (a.host !== window.location.host && !a.getAttribute("data-umami-event")) {
					a.setAttribute("data-umami-event", name);
					a.setAttribute("data-umami-event-url", a.href);
				}
			});
		})();
	</script> </footer> </body></html> <script type="module">const e=document.getElementById("to-top-btn"),n=document.getElementById("blog-hero");function c(t){t.forEach(o=>{e.dataset.show=(!o.isIntersecting).toString()})}e.addEventListener("click",()=>{document.documentElement.scrollTo({behavior:"smooth",top:0})});const r=new IntersectionObserver(c);r.observe(n);</script>